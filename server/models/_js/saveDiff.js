// Generated by CoffeeScript 1.6.3
(function() {
  var $, Diff, JSON_stringify, cloneData, jsondiffpatch, mongoose;

  mongoose = require("mongoose");

  require('../../models/_js/model_diff.js');

  Diff = mongoose.model('Diff');

  JSON_stringify = require('../../scripts/_js/JSON_stringify.js');

  $ = require('jquery');

  jsondiffpatch = require('jsondiffpatch').create({
    objectHash: function(obj) {
      return obj.name || obj.id || obj._id || obj._id || JSON.stringify(obj);
    }
  });

  cloneData = function(data) {
    return JSON.parse(JSON.stringify(data));
  };

  exports.saveDiff = function(db_name, new_data, old_data) {
    var dfd;
    dfd = new $.Deferred();
    console.info('new', new_data, 'old', old_data);
    new_data._sha1 = JSON_stringify.JSON_stringify(new_data)._sha1;
    console.info("PATCH", jsondiffpatch.diff(new_data.toObject(), old_data));
    dfd.resolve();
    return dfd.promise();
  };

}).call(this);
