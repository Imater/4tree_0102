// Generated by CoffeeScript 1.7.1
(function() {
  var Schema, Task, mongoosastic, mongoose, saveDiff, treeSchema;

  mongoose = require("mongoose");

  saveDiff = require('../../models/_js/saveDiff.js');

  Schema = mongoose.Schema;

  treeSchema = new Schema({
    'tree_id': String,
    'user_id': {
      type: String,
      es_indexed: true
    },
    'del': {
      type: Number,
      "default": 0
    },
    'title': {
      type: String,
      es_indexed: true
    },
    'date1': Date,
    'date2': Date,
    'parent_id': String,
    '_sha1': String,
    '_sync': [
      {
        key: String,
        diff: {
          '_tm': String
        }
      }
    ],
    '_tm': Date
  });

  mongoosastic = require('mongoosastic');

  treeSchema.plugin(mongoosastic);

  Task = module.exports = mongoose.model("Task", treeSchema);

  treeSchema.post('init', function() {
    return this._original = this.toObject();
  });

  treeSchema.pre('save', function(next) {
    return saveDiff.saveDiff(Task, this, this._original).then(function() {
      return next();
    });
  });

}).call(this);

//# sourceMappingURL=model_task.map
