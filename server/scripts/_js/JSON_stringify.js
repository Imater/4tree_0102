// Generated by CoffeeScript 1.6.3
(function() {
  var CryptoJS, copyObjectWithSortedKeys, isArray, isObject, _;

  CryptoJS = require("crypto-js");

  _ = require('underscore');

  isObject = function(a) {
    return Object.prototype.toString.call(a) === "[object Object]";
  };

  isArray = function(a) {
    return Object.prototype.toString.call(a) === "[object Array]";
  };

  copyObjectWithSortedKeys = function(object) {
    var i, key, keysSorted, newObj;
    if (isObject(object)) {
      newObj = {};
      keysSorted = Object.keys(object).sort();
      key = void 0;
      for (i in keysSorted) {
        key = keysSorted[i];
        if (_.has(object, key)) {
          newObj[key] = copyObjectWithSortedKeys(object[key]);
        }
      }
      return newObj;
    } else if (isArray(object)) {
      return object.map(copyObjectWithSortedKeys);
    } else {
      return object;
    }
  };

  exports.JSON_stringify = function(json) {
    var delete_, json2, string, _id, _sha1;
    delete_ = function(key, value) {
      if (key[0] === '_') {
        return void 0;
      } else {
        return value;
      }
    };
    json2 = copyObjectWithSortedKeys(JSON.parse(JSON.stringify(json, delete_)));
    string = JSON.stringify(json2, delete_, 0);
    _id = json != null ? json._id : void 0;
    _sha1 = CryptoJS.SHA1(JSON.stringify(string)).toString().substr(0, 7);
    console.info({
      _id: _id,
      _sha1: _sha1,
      string: string
    });
    return {
      _id: _id,
      _sha1: _sha1,
      string: string
    };
  };

}).call(this);
