#Алгоритм синхронизации

#------Клиент------

send_to_server = {
	'current_time'		: time1 				#Текущее время
	'last_sync_time'	: time2 				#Время последней синхронизации
	'sync_data'			: sync_data				#Данные и высушиваем их по журналу, включаем сюда элементы с отрицательным id
	'confirm_delete'	: confirm_delete
}


#------Сервер------

#Получив данные от клиента:

#вычисляем разницу во времени между клиентом и сервером

#находим в базе все элементы, которые заявлены в данных для синхронизации, сравниваем по времени, всё что новее, 
#обновляем сохряняя резервную копию

#собираем все данные, которые изменились с last_sync_time на сервере, кроме тех, которые клиент отправил только что.

#генерируем новые id из отрицательных, которые дал клиент (? Может id сразу генерировать и потом проверять на коллизии)

#Отправляем клиенту:

send_to_client = {
	'new_id_collision'		: [{old_id: -111, new_id: 567},{old_id: -211, new_id: 897}]
	'id_synced'				: [456, 432, 243, 2444]
	'id_need_delete'		: [654, 323, 234, 342]
	'sync_data_from_server'	: sync_data
}


#------Клиент-------

#Меняем id на предложенные, не забыв поменять parent_id

#Записываем все данные присланные с сервера, заменяя те поля, которые изменились позже нас

#Сохраняем данные в IndexedDB

#Отмечаем, что заметки синхронизированны и записываем время последней синхронизации last_sync_time

#Удаляем все записи, которые присланы в id_need_delete и сохраняем в localStorage, что нужно подтвердить удаление






tree_note = {
	id: 1
	user: {id:11, name: 'John Wezel'}
	share: [
		{id: 12, rights: { write: true, read: true } }
		{id: 18, rights: { write: false, read: true } }
	]
	title: 'Привет'
	tags: [
		'работа'
		'срочно'
		'на сайт'
	]
	comments: [
		{id: 1, title: 'Классная статья!'}
		{id: 2, title: 'Мне тоже нравится'}
		{id: 3, title: 'Отлично написано'}
		{id: 4, title: 'Можно запомнить'}
	]
	likes: [
		{ user_id: 11, name: 'Валентина', avatar: 'img/12.png'}
	]
	options: [
		{ store_to_web: { turn_on: true, link: 's8xd'} }
		{ like: true }
		{ favorit_panel: 'right' }
	]
}

change_journal = [
	{
		id: 1
		changes: {
			'user.id': 1392720725000
			'title': 1392720725000
			'comments.1': 1392720725000
			'options.store_to_web.turn_on': 1392720725010
		}
		change_time: 1392720725000
	}
]

































