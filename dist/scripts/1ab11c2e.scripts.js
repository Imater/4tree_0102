function isArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function isBoolean(a){return"boolean"==typeof a}function isDate(a){return"[object Date]"===Object.prototype.toString.call(a)}function isDefined(a){return"undefined"!=typeof a}function isFunction(a){return"function"==typeof a}function isNull(a){return null===a}function isNumber(a){return"number"==typeof a}function isObject(a){return null!==a&&"object"==typeof a}function isString(a){return"string"==typeof a}function isUndefined(a){return"undefined"==typeof a}function convertToBoolean(a){return isBoolean(a)?a:null!==a&&""!==a&&"false"!==a}function hasProperty(a,b){return a.hasOwnProperty(b)}function isStringEmpty(a){return isNull(a)||isUndefined(a)||isString(a)&&0==a.length}function isStringNonempty(a){return isString(a)&&a.length>0}function upperCaseFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1)}function areEqual(a,b){return angular.equals(a,b)}function min(a,b){return b>a?a:b}function max(a,b){return a>b?a:b}function beginsWith(a,b){return isString(a)&&0==a.lastIndexOf(b,0)}function endsWith(a,b){return isString(a)&&-1!==a.indexOf(b,a.length-b.length)}function copy(a,b){return angular.copy(a,b)}function removeProperty(a,b){delete a[b]}function removeProperties(a,b){for(var c=0;c<b.length;++c)delete a[b[c]]}function forEach(a,b,c){return angular.forEach(a,b,c)}function defineScalyrJsLibrary(a,b){var c=[];if(b instanceof Array)for(var d=0;d<b.length-1;++d)c.push(b[d]);return angular.module(a,c).factory(a,b)}function defineScalyrAngularModule(a,b){return angular.module(a,b)}!function(){"use strict";angular.module("ui-rangeSlider",[]).directive("rangeSlider",["$document","$filter","$log",function(a,b,c){var d=window.PointerEvent?1:window.MSPointerEvent?2:"ontouchend"in document?3:4,e=".rangeSlider",f={disabled:!1,orientation:"horizontal",step:0,decimalPlaces:0,showValues:!0,preventEqualMinMax:!1},g=(1===d?"pointerdown":2===d?"MSPointerDown":3===d?"touchstart":"mousedown")+e,h=(1===d?"pointermove":2===d?"MSPointerMove":3===d?"touchmove":"mousemove")+e,i=(1===d?"pointerup":2===d?"MSPointerUp":3===d?"touchend":"mouseup")+e,j=function(a){try{return[a.clientX||a.originalEvent.clientX||a.originalEvent.touches[0].clientX,a.clientY||a.originalEvent.clientY||a.originalEvent.touches[0].clientY]}catch(b){return["x","y"]}},k=function(a){return 0>a?0:a>100?100:a},l=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};return angular.element("html").addClass(4>d?"ngrs-touch":"ngrs-no-touch"),{restrict:"A",replace:!0,template:['<div class="ngrs-range-slider">','<div class="ngrs-runner">','<div class="ngrs-handle ngrs-handle-min"><i></i></div>','<div class="ngrs-handle ngrs-handle-max"><i></i></div>','<div class="ngrs-join"></div>',"</div>",'<div class="ngrs-value ngrs-value-min" ng-show="showValues">{{filteredModelMin}}</div>','<div class="ngrs-value ngrs-value-max" ng-show="showValues">{{filteredModelMax}}</div>',"</div>"].join(""),scope:{disabled:"=?",min:"=",max:"=",modelMin:"=?",modelMax:"=?",onHandleDown:"&",onHandleUp:"&",orientation:"@",step:"@",decimalPlaces:"@",filter:"@",filterOptions:"@",showValues:"@",pinHandle:"@",preventEqualMinMax:"@"},link:function(d,m,n){function o(a){"min"===a?(angular.element(w[0]).css("display","none"),angular.element(w[1]).css("display","block")):"max"===a?(angular.element(w[0]).css("display","block"),angular.element(w[1]).css("display","none")):(angular.element(w[0]).css("display","block"),angular.element(w[1]).css("display","block"))}function p(a){a?v.addClass("disabled"):v.removeClass("disabled")}function q(){d.min>d.max&&t("min must be less than or equal to max"),angular.isDefined(d.min)&&angular.isDefined(d.max)&&(l(d.min)||t("min must be a number"),l(d.max)||t("max must be a number"),C=d.max-d.min,B=[d.min,d.max],r())}function r(){if(d.modelMin>d.modelMax&&(u("modelMin must be less than or equal to modelMax"),d.modelMin=d.modelMax),(angular.isDefined(d.modelMin)||"min"===d.pinHandle)&&(angular.isDefined(d.modelMax)||"max"===d.pinHandle)){l(d.modelMin)||("min"!==d.pinHandle&&u("modelMin must be a number"),d.modelMin=d.min),l(d.modelMax)||("max"!==d.pinHandle&&u("modelMax must be a number"),d.modelMax=d.max);var a=k((d.modelMin-d.min)/C*100),c=k((d.modelMax-d.min)/C*100);d.modelMin=Math.max(d.min,d.modelMin),d.modelMax=Math.min(d.max,d.modelMax),d.filter?(d.filteredModelMin=b(d.filter)(d.modelMin,d.filterOptions),d.filteredModelMax=b(d.filter)(d.modelMax,d.filterOptions)):(d.filteredModelMin=d.modelMin,d.filteredModelMax=d.modelMax),d.min===d.max&&d.modelMin==d.modelMax?(angular.element(w[0]).css(y,"0%"),angular.element(w[1]).css(y,"100%"),angular.element(x).css(y,"0%").css(z,"0%")):(angular.element(w[0]).css(y,a+"%"),angular.element(w[1]).css(y,c+"%"),angular.element(x).css(y,a+"%").css(z,100-c+"%"),a>95&&angular.element(w[0]).css("z-index",3))}}function s(b){var c=w[b];c.bind(g+"X",function(f){var g=(0===b?"ngrs-handle-min":"ngrs-handle-max")+"-down",l=c.add(a).add("body"),m=(0===b?d.modelMin:d.modelMax)-d.min,n=m/C*100,o=j(f),p=o,q=!1;angular.isFunction(d.onHandleDown)&&d.onHandleDown(),angular.element("body").bind("selectstart"+e,function(){return!1}),d.disabled||(c.addClass("ngrs-down"),v.addClass("ngrs-focus "+g),angular.element("body").addClass("ngrs-touching"),a.bind(h,function(a){a.preventDefault();var e,f,g=j(a),h=d.step/C*100,i=((0===b?d.modelMax:d.modelMin)-d.min)/C*100;"x"!==g[0]&&(g[0]-=o[0],g[1]-=o[1],e=[p[0]!==g[0],p[1]!==g[1]],f=n+100*g[A]/(A?v.height():v.width()),f=k(f),d.preventEqualMinMax&&(0===h&&(h=1/C*100),0===b?i-=h:1===b&&(i+=h)),0===b?f=f>i?i:f:1===b&&(f=i>f?i:f),d.step>0&&100>f&&f>0&&(f=Math.round(f/h)*h),f>95&&0===b?c.css("z-index",3):c.css("z-index",""),e[A]&&f!=q&&(0===b?d.modelMin=parseFloat(f*C/100+d.min).toFixed(d.decimalPlaces):1===b&&(d.modelMax=parseFloat(f*C/100+d.min).toFixed(d.decimalPlaces)),d.$apply(),q=f),p=g)}).bind(i,function(){angular.isFunction(d.onHandleUp)&&d.onHandleUp(),l.off(e),angular.element("body").removeClass("ngrs-touching"),c.removeClass("ngrs-down"),v.removeClass("ngrs-focus "+g)}))})}function t(a){throw d.disabled=!0,new Error("RangeSlider: "+a)}function u(a){c.warn(a)}var v=angular.element(m),w=[m.find(".ngrs-handle-min"),m.find(".ngrs-handle-max")],x=m.find(".ngrs-join"),y="left",z="right",A=0,B=[0,0],C=0;d.filteredModelMin=d.modelMin,d.filteredModelMax=d.modelMax,n.$observe("disabled",function(a){angular.isDefined(a)||(d.disabled=f.disabled),d.$watch("disabled",p)}),n.$observe("orientation",function(a){angular.isDefined(a)||(d.orientation=f.orientation);for(var b,c=d.orientation.split(" "),e=0,g=c.length;g>e;e++)c[e]="ngrs-"+c[e];b=c.join(" "),v.addClass(b),("vertical"===d.orientation||"vertical left"===d.orientation||"vertical right"===d.orientation)&&(y="top",z="bottom",A=1)}),n.$observe("step",function(a){angular.isDefined(a)||(d.step=f.step)}),n.$observe("decimalPlaces",function(a){angular.isDefined(a)||(d.decimalPlaces=f.decimalPlaces)}),n.$observe("showValues",function(a){d.showValues=angular.isDefined(a)?"false"===a?!1:!0:f.showValues}),n.$observe("pinHandle",function(a){d.pinHandle=angular.isDefined(a)&&("min"===a||"max"===a)?a:null,d.$watch("pinHandle",o)}),n.$observe("preventEqualMinMax",function(a){d.preventEqualMinMax=angular.isDefined(a)?"false"===a?!1:!0:f.preventEqualMinMax}),d.$watch("min",q),d.$watch("max",q),d.$watch("modelMin",r),d.$watch("modelMax",r),d.$on("$destroy",function(){v.off(e),angular.element("body").off(e),a.off(e);for(var b=0,c=w.length;c>b;b++)w[b].off(e),w[b].off(e+"X")}),v.bind("selectstart"+e,function(){return!1}).bind("click",function(a){a.stopPropagation()}),s(0),s(1)}}}]),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()}(),angular.module("app.directives",[]).directive("frangTree",["$parse","$animate",function(){return{restrict:"EA",controller:["$scope","$element",function(){this.insertChildren=null,this.init=function(a){this.insertChildren=a}}]}}]).directive("frangTreeRepeat",["$parse","$animate",function(a,b){function c(a){var b,c=typeof a;return"object"==c&&null!==a?"function"==typeof(b=a.$$hashKey)?b=a.$$hashKey():void 0===b&&(b=a.$$hashKey=h()):b=a,c+":"+b}function d(a){if(null==a||e(a))return!1;var b=a.length;return 1===a.nodeType&&b?!0:f(a)||g(a)||0===b||"number"==typeof b&&b>0&&b-1 in a}function e(a){return a&&a.document&&a.location&&a.alert&&a.setInterval}function f(a){return"string"==typeof a}function g(a){return"[object Array]"==s.apply(a)}function h(){for(var a,b=m.length;b;){if(b--,a=m[b].charCodeAt(0),57==a)return m[b]="A",m.join("");if(90!=a)return m[b]=String.fromCharCode(a+1),m.join("");m[b]="0"}return m.unshift("0"),m.join("")}function i(a,b){if("hasOwnProperty"===a)throw r("badname","hasOwnProperty is not a valid {0} name",b)}function j(a){return function(){var b,c,d=arguments[0],e="["+(a?a+":":"")+d+"] ",g=arguments[1],h=arguments,i=function(a){return t(a)?a.toString().replace(/ \{[\s\S]*$/,""):u(a)?"undefined":f(a)?a:JSON.stringify(a)};for(b=e+g.replace(/\{\d+\}/g,function(a){var b,c=+a.slice(1,-1);return c+2<h.length?(b=h[c+2],t(b)?b.toString().replace(/ ?\{[\s\S]*$/,""):u(b)?"undefined":f(b)?b:v(b)):a}),b=b+"\nhttp://errors.angularjs.org/"+angular.version.full+"/"+(a?a+"/":"")+d,c=2;c<arguments.length;c++)b=b+(2==c?"?":"&")+"p"+(c-2)+"="+encodeURIComponent(i(arguments[c]));return new Error(b)}}function k(a){if(a.startNode===a.endNode)return n(a.startNode);var b=a.startNode,c=[b];do{if(b=b.nextSibling,!b)break;c.push(b)}while(b!==a.endNode);return n(c)}function l(a,c,e,f,g,h,j,l,m,r,s){var t=e;a.$watchCollection(h,function(e){var h,u,v,w,x,y,z,A,B,C,D,E,F=c[0],G={},H=[];if(d(e))C=e,B=j||l;else{B=j||m,C=[];for(y in e)e.hasOwnProperty(y)&&"$"!=y.charAt(0)&&C.push(y);C.sort()}for(w=C.length,u=H.length=C.length,h=0;u>h;h++)if(y=e===C?h:C[h],z=e[y],A=B(y,z,h),i(A,"`track by` id"),t.hasOwnProperty(A))D=t[A],delete t[A],G[A]=D,H[h]=D;else{if(G.hasOwnProperty(A))throw o(H,function(a){a&&a.startNode&&(t[a.id]=a)}),q("dupes","Duplicates in a repeater are not allowed. Use 'track by' expression to specify unique keys. Repeater: {0}, Duplicate key: {1}",s,A);H[h]={id:A},G[A]=!1}for(y in t)t.hasOwnProperty(y)&&(D=t[y],E=k(D),b.leave(E),o(E,function(a){a[p]=!0}),D.scope.$destroy());for(h=0,u=C.length;u>h;h++){if(y=e===C?h:C[h],z=e[y],D=H[h],H[h-1]&&(F=H[h-1].endNode),D.startNode){x=D.scope,v=F;do v=v.nextSibling;while(v&&v[p]);D.startNode==v||b.move(k(D),null,n(F)),F=D.endNode}else x=a.$new();x[f]=z,g&&(x[g]=y),x.$index=h,x.$first=0===h,x.$last=h===w-1,x.$middle=!(x.$first||x.$last),x.$odd=!(x.$even=h%2==0),D.startNode||r(x,function(a){a[a.length++]=document.createComment(" end ngRepeat: "+s+" "),b.enter(a,null,n(F)),F=a,D.scope=x,D.startNode=F&&F.endNode?F.endNode:a[0],D.endNode=a[a.length-1],G[D.id]=D})}t=G})}var m=["0","0","0"],n=angular.element,o=angular.forEach,p="$$NG_REMOVED",q=j("ngRepeat"),r=j("ng"),s=Object.prototype.toString,t=angular.isFunction,u=angular.isUndefined,v=angular.toJson;return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,require:"^frangTree",compile:function(b,d,e){return function(b,d,f,g){var h,i,j,k,m,n,o,p,r,s=f.frangTreeRepeat,t=s.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),u={$id:c};if(!t)throw q("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",s);if(n=t[1],o=t[2],h=t[4],h?(i=a(h),j=function(a,c,d){return r&&(u[r]=a),u[p]=c,u.$index=d,i(b,u)}):(k=function(a,b){return c(b)},m=function(a){return a}),t=n.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/),!t)throw q("iidexp","'_item_' in '_item_ in _collection_' should be an identifier or '(_key_, _value_)' expression, but got '{0}'.",n);p=t[3]||t[1],r=t[2];l(b,d,{},p,r,o,j,k,m,e,s),g.init(function(a,b,c){l(a,b,{},p,r,c,j,k,m,e,s)})}}}}]).directive("frangTreeInsertChildren",function(){return{restrict:"EA",require:"^frangTree",link:function(a,b,c,d){var e=document.createComment("treeRepeat");b.append(e),d.insertChildren(a,angular.element(e),c.frangTreeInsertChildren)}}}).directive("frangTreeDrag",["$parse",function(a){return{restrict:"A",require:"^frangTree",link:function(b,c,d,e){var f=c[0],g=a(d.frangTreeDrag);f.draggable=!0,f.addEventListener("dragstart",function(a){return a.stopPropagation&&a.stopPropagation(),a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("Text","nothing"),c.addClass("tree-drag"),e.dragData=g(b),!1},!1),f.addEventListener("dragend",function(a){return a.stopPropagation&&a.stopPropagation(),c.removeClass("tree-drag"),e.dragData=null,!1},!1)}}}]).directive("frangTreeDrop",["$parse",function(a){return{restrict:"A",require:"^frangTree",link:function(b,c,d,e){var f=c[0],g=a(d.frangTreeDrop),h=a(d.frangTreeAllowDrop||"true");f.addEventListener("dragover",function(a){return h(b,{dragData:e.dragData})&&(a.stopPropagation&&a.stopPropagation(),a.dataTransfer.dropEffect="move",c.addClass("tree-drag-over"),a.preventDefault&&a.preventDefault()),!1},!1),f.addEventListener("dragenter",function(a){return h(b,{dragData:e.dragData})&&(a.stopPropagation&&a.stopPropagation(),c.addClass("tree-drag-over"),a.preventDefault&&a.preventDefault()),!1},!1),f.addEventListener("dragleave",function(a){return h(b,{dragData:e.dragData})&&(a.stopPropagation&&a.stopPropagation(),c.removeClass("tree-drag-over")),!1},!1),f.addEventListener("drop",function(a){return h(b,{dragData:e.dragData})&&(a.stopPropagation&&a.stopPropagation(),c.removeClass("tree-drag-over"),b.$apply(function(){g(b,{dragData:e.dragData})}),e.dragData=null,a.preventDefault&&a.preventDefault()),!1},!1)}}}]),function(){"use strict";var a={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,comma:188},b=angular.module("ngTagsInput",[]);b.directive("tagsInput",["$timeout","$document","tagsInputConfig",function(b,c,d){function e(){var a={};return{on:function(b,c){a[b]||(a[b]=[]),a[b].push(c)},trigger:function(b,c){angular.forEach(a[b],function(a){a.call(null,c)})}}}return{restrict:"E",require:"ngModel",scope:{tags:"=ngModel",onTagAdded:"&",onTagRemoved:"&"},replace:!1,transclude:!0,templateUrl:"ngTagsInput/tags-input.html",controller:["$scope","$attrs","$element",function(a,b,c){var f;d.load("tagsInput",a,b,{customClass:[String],placeholder:[String,"Add a tag..."],tabindex:[Number],removeTagSymbol:[String,String.fromCharCode(215)],replaceSpacesWithDashes:[Boolean,!1],minLength:[Number,2],maxLength:[Number],addOnEnter:[Boolean,!0],addOnSpace:[Boolean,!1],addOnComma:[Boolean,!1],addOnBlur:[Boolean,!0],allowedTagsPattern:[RegExp,/^[\@а-яА-Яa-zA-Z0-9\s]/],enableEditingLastTag:[Boolean,!0],minTags:[Number],maxTags:[Number]}),a.events=new e,a.events.on("tag-added",a.onTagAdded),a.events.on("tag-removed",a.onTagRemoved),a.newTag="",a.tags=a.tags||[],a.tryAdd=function(){var b=!1,c=a.newTag;return c.length>=a.options.minLength&&a.options.allowedTagsPattern.test(c)&&(a.options.replaceSpacesWithDashes&&(c=c.replace(/\s/g,"-")),-1===a.tags.indexOf(c)&&(a.tags.push(c),a.events.trigger("tag-added",{$tag:c})),a.newTag="",a.events.trigger("input-change",""),b=!0),b},a.tryRemoveLast=function(){var b=!1;return a.tags.length>0&&(a.options.enableEditingLastTag?a.newTag=a.remove(a.tags.length-1):f?(a.remove(a.tags.length-1),f=!1):f=!0,b=!0),b},a.remove=function(b){var c=a.tags.splice(b,1)[0];return a.events.trigger("tag-removed",{$tag:c}),c},a.getCssClass=function(b){var c=b===a.tags.length-1;return f&&c?"selected":""},a.$watch(function(){return a.newTag.length>0},function(){f=!1}),this.registerAutocomplete=function(){var b=c.find("input");return b.on("keydown",function(b){a.events.trigger("input-keydown",b)}),a.newTagChange=function(){a.events.trigger("input-change",a.newTag)},{tryAddTag:function(b){return a.newTag=b,a.tryAdd()},focusInput:function(){b[0].focus()},getTags:function(){return a.tags},on:function(b,c){return a.events.on(b,c),this}}}}],link:function(d,e,f,g){var h=[a.enter,a.comma,a.space,a.backspace],i=e.find("input");i.on("keydown",function(b){if(!b.isImmediatePropagationStopped||!b.isImmediatePropagationStopped()){var c=b.keyCode,e=b.shiftKey||b.altKey||b.ctrlKey||b.metaKey;e||-1===h.indexOf(c)||(c===a.enter&&d.options.addOnEnter||c===a.comma&&d.options.addOnComma||c===a.space&&d.options.addOnSpace?(d.tryAdd()&&d.$apply(),b.preventDefault()):c===a.backspace&&0===this.value.length&&d.tryRemoveLast()&&(d.$apply(),b.preventDefault()))}}).on("focus",function(){d.hasFocus||(d.hasFocus=!0,d.$apply())}).on("blur",function(){b(function(){var a=angular.element(c[0].activeElement).parent();a[0]!==e[0]&&(d.hasFocus=!1,d.options.addOnBlur&&d.tryAdd(),d.events.trigger("input-blur"),d.$apply())},0,!1)}),e.find("div").on("click",function(){i[0].focus()}),d.$watch("tags.length",function(){g.$setValidity("maxTags",angular.isUndefined(d.options.maxTags)||d.tags.length<=d.options.maxTags),g.$setValidity("minTags",angular.isUndefined(d.options.minTags)||d.tags.length>=d.options.minTags)})}}}]),b.directive("autoComplete",["$document","$timeout","$sce","tagsInputConfig",function(b,c,d,e){function f(a,b){var d,e,f,g={};return e=function(a,b){var c=[];return a.forEach(function(a){-1===b.indexOf(a)&&c.push(a)}),c},g.reset=function(){f=null,g.items=[],g.visible=!1,g.index=-1,g.selected=null,g.query=null,c.cancel(d)},g.show=function(){g.selected=null,g.visible=!0},g.load=function(h,i){return h.length<b.minLength?void g.reset():(c.cancel(d),void(d=c(function(){g.query=h;var b=a({$query:h});f=b,b.then(function(a){b===f&&(g.items=e(a.data||a,i),g.items.length>0?g.show():g.reset())})},b.debounceDelay,!1)))},g.selectNext=function(){g.select(++g.index)},g.selectPrior=function(){g.select(--g.index)},g.select=function(a){0>a?a=g.items.length-1:a>=g.items.length&&(a=0),g.index=a,g.selected=g.items[a]},g.reset(),g}function g(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return{restrict:"E",require:"^tagsInput",scope:{source:"&"},templateUrl:"ngTagsInput/auto-complete.html",link:function(c,h,i,j){var k,l,m,n=[a.enter,a.tab,a.escape,a.up,a.down];e.load("autoComplete",c,i,{debounceDelay:[Number,100],minLength:[Number,3],highlightMatchedText:[Boolean,!0],maxResultsToShow:[Number,10]}),l=j.registerAutocomplete(),k=new f(c.source,c.options),m=c.options.highlightMatchedText?function(a,b){var c=new RegExp(b,"gi");return a.replace(c,"**$&**")}:function(a){return a},c.suggestionList=k,c.addSuggestion=function(){var a=!1;return k.selected&&(l.tryAddTag(k.selected),k.reset(),l.focusInput(),a=!0),a},c.highlight=function(a){return a=m(a,k.query),a=g(a),a=a.replace(/\*\*(.+?)\*\*/g,"<em>$1</em>"),d.trustAsHtml(a)},l.on("input-change",function(a){a?k.load(a,l.getTags()):k.reset()}).on("input-keydown",function(b){var d,e;if(-1!==n.indexOf(b.keyCode)){var f=!1;b.stopImmediatePropagation=function(){f=!0,b.stopPropagation()},b.isImmediatePropagationStopped=function(){return f},k.visible&&(d=b.keyCode,e=!1,d===a.down?(k.selectNext(),e=!0):d===a.up?(k.selectPrior(),e=!0):d===a.escape?(k.reset(),e=!0):(d===a.enter||d===a.tab)&&(e=c.addSuggestion()),e&&(b.preventDefault(),b.stopImmediatePropagation(),c.$apply()))}}).on("input-blur",function(){k.reset()}),b.on("click",function(){k.visible&&(k.reset(),c.$apply())})}}}]),b.directive("tiTranscludeAppend",function(){return function(a,b,c,d,e){e(function(a){b.append(a)})}}),b.directive("tiAutosize",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e,f;e=angular.element('<span class="tag-input"></span>'),e.css("display","none").css("visibility","hidden").css("width","auto"),b.parent().append(e),f=function(a){var c=a;angular.isString(a)&&0===a.length&&(a=b.attr("placeholder")),e.text(a),e.css("display","");try{b.css("width",e.prop("offsetWidth")+5+"px")}finally{e.css("display","none")}return c},d.$parsers.unshift(f),d.$formatters.unshift(f)}}}),b.provider("tagsInputConfig",function(){var a={};this.setDefaults=function(b,c){return a[b]=c,this},this.$get=["$interpolate",function(b){var c={};return c[String]=function(a){return a},c[Number]=function(a){return parseInt(a,10)},c[Boolean]=function(a){return"true"===a.toLowerCase()},c[RegExp]=function(a){return new RegExp(a)},{load:function(d,e,f,g){e.options={},angular.forEach(g,function(g,h){var i=f[h]&&b(f[h])(e.$parent),j=c[g[0]],k=function(b){var c=a[d]&&a[d][b];return angular.isDefined(c)?c:g[1]};e.options[h]=i?j(i):k(h)})}}}]}),b.run(["$templateCache",function(a){a.put("ngTagsInput/tags-input.html",'<div class="ngTagsInput" tabindex="-1" ng-class="options.customClass" ti-transclude-append=""><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list"><li class="tag-item" ng-repeat="tag in tags" ng-class="getCssClass($index)"><span>{{tag}}</span> <button type="button" ng-click="remove($index)">{{options.removeTagSymbol}}</button></li></ul><input class="tag-input" placeholder="{{options.placeholder}}" maxlength="{{options.maxLength}}" tabindex="{{options.tabindex}}" ng-model="newTag" ng-change="newTagChange()" ti-autosize=""></div></div>'),a.put("ngTagsInput/auto-complete.html",'<div class="autocomplete" ng-show="suggestionList.visible"><ul class="suggestion-list"><li class="suggestion-item" ng-repeat="item in suggestionList.items | limitTo:options.maxResultsToShow" ng-class="{selected: item == suggestionList.selected}" ng-click="addSuggestion()" ng-mouseenter="suggestionList.select($index)" ng-bind-html="highlight(item)"></li></ul></div>')}])}(),function(){"use strict";var a=angular.module("pasvaz.bindonce",[]);a.directive("bindonce",function(){var a=function(a){if(a&&0!==a.length){var b=angular.lowercase(""+a);a=!("f"===b||"0"===b||"false"===b||"no"===b||"n"===b||"[]"===b)}else a=!1;return a},b=parseInt((/msie (\d+)/.exec(angular.lowercase(navigator.userAgent))||[])[1],10);isNaN(b)&&(b=parseInt((/trident\/.*; rv:(\d+)/.exec(angular.lowercase(navigator.userAgent))||[])[1],10));var c={restrict:"AM",controller:["$scope","$element","$attrs","$interpolate",function(c,d,e,f){var g=function(b,c,d){var e="show"===c?"":"none",f="hide"===c?"":"none";b.css("display",a(d)?e:f)},h=function(a,b){if(angular.isObject(b)&&!angular.isArray(b)){var c=[];angular.forEach(b,function(a,b){a&&c.push(b)}),b=c}b&&a.addClass(angular.isArray(b)?b.join(" "):b)},i={watcherRemover:void 0,binders:[],group:e.boName,element:d,ran:!1,addBinder:function(a){this.binders.push(a),this.ran&&this.runBinders()},setupWatcher:function(a){var b=this;this.watcherRemover=c.$watch(a,function(a){void 0!==a&&(b.removeWatcher(),b.runBinders())},!0)},removeWatcher:function(){void 0!==this.watcherRemover&&(this.watcherRemover(),this.watcherRemover=void 0)},runBinders:function(){for(;this.binders.length>0;){var c=this.binders.shift();if(!this.group||this.group==c.group){var d=c.scope.$eval(c.interpolate?f(c.value):c.value);switch(c.attr){case"boIf":a(d)&&c.transclude(c.scope.$new(),function(a){var b=c.element.parent(),d=c.element&&c.element[c.element.length-1],e=b&&b[0]||d&&d.parentNode,f=d&&d.nextSibling||null;angular.forEach(a,function(a){e.insertBefore(a,f)})});break;case"boSwitch":var e,i=c.controller[0];(e=i.cases["!"+d]||i.cases["?"])&&(c.scope.$eval(c.attrs.change),angular.forEach(e,function(a){a.transclude(c.scope.$new(),function(b){var c=a.element.parent(),d=a.element&&a.element[a.element.length-1],e=c&&c[0]||d&&d.parentNode,f=d&&d.nextSibling||null;angular.forEach(b,function(a){e.insertBefore(a,f)})})}));break;case"boSwitchWhen":var j=c.controller[0];j.cases["!"+c.attrs.boSwitchWhen]=j.cases["!"+c.attrs.boSwitchWhen]||[],j.cases["!"+c.attrs.boSwitchWhen].push({transclude:c.transclude,element:c.element});break;case"boSwitchDefault":var j=c.controller[0];j.cases["?"]=j.cases["?"]||[],j.cases["?"].push({transclude:c.transclude,element:c.element});break;case"hide":case"show":g(c.element,c.attr,d);break;case"class":h(c.element,d);break;case"text":c.element.text(d);break;case"html":c.element.html(d);break;case"style":c.element.css(d);break;case"src":c.element.attr(c.attr,d),b&&c.element.prop("src",d);break;case"attr":angular.forEach(c.attrs,function(a,b){var d,e;b.match(/^boAttr./)&&c.attrs[b]&&(d=b.replace(/^boAttr/,"").replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),e=c.scope.$eval(c.attrs[b]),c.element.attr(d,e))});break;case"href":case"alt":case"title":case"id":case"value":c.element.attr(c.attr,d)}}}this.ran=!0}};return i}],link:function(a,b,c,d){var e=c.bindonce?a.$eval(c.bindonce):!0;void 0!==e?d.runBinders():(d.setupWatcher(c.bindonce),b.bind("$destroy",d.removeWatcher))}};return c}),angular.forEach([{directiveName:"boShow",attribute:"show"},{directiveName:"boHide",attribute:"hide"},{directiveName:"boClass",attribute:"class"},{directiveName:"boText",attribute:"text"},{directiveName:"boHtml",attribute:"html"},{directiveName:"boSrcI",attribute:"src",interpolate:!0},{directiveName:"boSrc",attribute:"src"},{directiveName:"boHrefI",attribute:"href",interpolate:!0},{directiveName:"boHref",attribute:"href"},{directiveName:"boAlt",attribute:"alt"},{directiveName:"boTitle",attribute:"title"},{directiveName:"boId",attribute:"id"},{directiveName:"boStyle",attribute:"style"},{directiveName:"boValue",attribute:"value"},{directiveName:"boAttr",attribute:"attr"},{directiveName:"boIf",transclude:"element",terminal:!0,priority:1e3},{directiveName:"boSwitch",require:"boSwitch",controller:function(){this.cases={}}},{directiveName:"boSwitchWhen",transclude:"element",priority:800,require:"^boSwitch"},{directiveName:"boSwitchDefault",transclude:"element",priority:800,require:"^boSwitch"}],function(b){var c=200;return a.directive(b.directiveName,function(){var a={priority:b.priority||c,transclude:b.transclude||!1,terminal:b.terminal||!1,require:["^bindonce"].concat(b.require||[]),controller:b.controller,compile:function(a,c,d){return function(a,c,e,f){var g=f[0],h=e.boParent;if(h&&g.group!==h){var i=g.element.parent();g=void 0;for(var j;9!==i[0].nodeType&&i.length;){if((j=i.data("$bindonceController"))&&j.group===h){g=j;break}i=i.parent()}if(!g)throw new Error("No bindonce controller: "+h)}g.addBinder({element:c,attr:b.attribute||b.directiveName,attrs:e,value:e[b.directiveName],interpolate:b.interpolate,group:h,transclude:d,controller:f.slice(1),scope:a})}}};return a})})}(),function(a,b){"use strict";function c(a,b,c){d.directive(a,["$parse","$swipe",function(d,e){var f=75,g=.3,h=30;return function(i,j,k){function l(a){if(!m)return!1;var c=Math.abs(a.y-m.y),d=(a.x-m.x)*b;return n&&f>c&&d>0&&d>h&&g>c/d}var m,n,o=d(k[a]);e.bind(j,{start:function(a){m=a,n=!0},cancel:function(){n=!1},end:function(a,b){l(a)&&i.$apply(function(){j.triggerHandler(c),o(i,{$event:b})})}})}}])}var d=b.module("ngTouch",[]);d.factory("$swipe",[function(){function a(a){var b=a.touches&&a.touches.length?a.touches:[a],c=a.changedTouches&&a.changedTouches[0]||a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]||b[0].originalEvent||b[0];return{x:c.clientX,y:c.clientY}}var b=10;return{bind:function(c,d){var e,f,g,h,i=!1;c.on("touchstart mousedown",function(b){g=a(b),i=!0,e=0,f=0,h=g,d.start&&d.start(g,b)}),c.on("touchcancel",function(a){i=!1,d.cancel&&d.cancel(a)}),c.on("touchmove mousemove",function(c){if(i&&g){var j=a(c);if(e+=Math.abs(j.x-h.x),f+=Math.abs(j.y-h.y),h=j,!(b>e&&b>f))return f>e?(i=!1,void(d.cancel&&d.cancel(c))):(c.preventDefault(),void(d.move&&d.move(j,c)))}}),c.on("touchend mouseup",function(b){i&&(i=!1,d.end&&d.end(a(b),b))})}}}]),d.config(["$provide",function(a){a.decorator("ngClickDirective",["$delegate",function(a){return a.shift(),a}])}]),d.directive("ngClick",["$parse","$timeout","$rootElement",function(a,c,d){function e(a,b,c,d){return Math.abs(a-c)<o&&Math.abs(b-d)<o}function f(a,b,c){for(var d=0;d<a.length;d+=2)if(e(a[d],a[d+1],b,c))return a.splice(d,d+2),!0;return!1}function g(a){if(!(Date.now()-j>n)){var b=a.touches&&a.touches.length?a.touches:[a],c=b[0].clientX,d=b[0].clientY;1>c&&1>d||f(k,c,d)||(a.stopPropagation(),a.preventDefault(),a.target&&a.target.blur())}}function h(a){var b=a.touches&&a.touches.length?a.touches:[a],d=b[0].clientX,e=b[0].clientY;k.push(d,e),c(function(){for(var a=0;a<k.length;a+=2)if(k[a]==d&&k[a+1]==e)return void k.splice(a,a+2)},n,!1)}function i(a,b){k||(d[0].addEventListener("click",g,!0),d[0].addEventListener("touchstart",h,!0),k=[]),j=Date.now(),f(k,a,b)}var j,k,l=5,m=12,n=2500,o=25,p="ng-click-active";return function(c,d,e){function f(){o=!1,d.removeClass(p)}var g,h,j,k,n=a(e.ngClick),o=!1;d.on("touchstart",function(a){o=!0,g=a.target?a.target:a.srcElement,3==g.nodeType&&(g=g.parentNode),d.addClass(p),h=Date.now();var b=a.touches&&a.touches.length?a.touches:[a],c=b[0].originalEvent||b[0];j=c.clientX,k=c.clientY}),d.on("touchmove",function(){f()}),d.on("touchcancel",function(){f()}),d.on("touchend",function(a){var c=Date.now()-h,n=a.changedTouches&&a.changedTouches.length?a.changedTouches:a.touches&&a.touches.length?a.touches:[a],p=n[0].originalEvent||n[0],q=p.clientX,r=p.clientY,s=Math.sqrt(Math.pow(q-j,2)+Math.pow(r-k,2));o&&l>c&&m>s&&(i(q,r),g&&g.blur(),b.isDefined(e.disabled)&&e.disabled!==!1||d.triggerHandler("click",[a])),f()}),d.onclick=function(){},d.on("click",function(a,b){c.$apply(function(){n(c,{$event:b||a})})}),d.on("mousedown",function(){d.addClass(p)}),d.on("mousemove mouseup",function(){d.removeClass(p)})}}]),c("ngSwipeLeft",-1,"swipeleft"),c("ngSwipeRight",1,"swiperight")}(window,window.angular),angular.module("sly",["slyEvaluate","slyRepeat"]),defineScalyrAngularModule("slyEvaluate",["gatedScope"]).directive("slyEvaluateOnlyWhen",["$parse",function(a){return{scope:!0,restrict:"A",compile:function(){return{pre:function(b,c,d){var e=null,f=!1,g=a(d.slyEvaluateOnlyWhen),h=null;if(hasProperty(d,"slyAlwaysEvaluate")&&(h=d.slyAlwaysEvaluate,isStringEmpty(h)))throw new Exception("Empty string is illegal for value of slyAlwaysEvaluate");b.$addWatcherGate(function(){var a=g(b);if(!f)return f=!0,e=a,!0;var c=e!==a;return e=a,c},function(a){return isNull(h)||!(isStringNonempty(a)&&a.indexOf(h)>=0)})}}}}}]).directive("slyAlwaysEvaluate",function(){return{restrict:"A",link:function(){}}}).directive("slyShow",["$animate",function(a){function b(a){if(a&&0!==a.length){var b=""+a;b=isString(b)?b.toLowerCase():b,a=!("f"==b||"0"==b||"false"==b||"no"==b||"n"==b||"[]"==b)}else a=!1;return a}return{restrict:"A",link:function(c,d,e){c.$watch(e.slyShow,function(c){a[b(c)?"removeClass":"addClass"](d,"ng-hide")},!1,"slyShow")}}}]).directive("slyPreventEvaluationWhenHidden",function(){return{restrict:"A",scope:!0,compile:function(){return{pre:function(a,b){a.$addWatcherGate(function(){return!b.hasClass("ng-hide")},function(a,b,c,d){return isDefined(d)&&"slyShow"==d?!1:!0})}}}}}),defineScalyrAngularModule("slyRepeat",["gatedScope"]).directive("slyRepeat",["$animate","$parse",function(a){function b(a){a.scope.$addWatcherGate(function(){return a.isActiveForRepeat})}return{restrict:"A",scope:!0,transclude:"element",priority:1e3,terminal:!0,compile:function(c,d,e){return function(c,d,f){var g=f.slyRepeat,h=g.match(/^\s*(.+)\s+in\s+(.*?)$/);if(!h)throw Error("Expected slyRepeat in form of '_item_ in _collection_' but got '"+g+"'.");var i=h[1],j=h[2];if(h=i.match(/^(?:([\$\w]+))$/),!h)throw Error("'item' in 'item in collection' should be identifier but got '"+lhs+"'.");var k=[],l=[],m=c.$watchCollection(j,function(f){if(!isArray(f))throw Error("'collection' did not evaluate to an array.  expression was "+j);var g=k.length;if(k.length<f.length&&l.length>0){var h=k.length+l.length;h>f.length&&(h=f.length),k=k.concat(l.splice(0,h-k.length))}var m=null,n=[],o=[];if(f.length>k.length){for(var p=k.length;p<f.length;++p){var q={scope:c.$new(),isActiveForRepeat:!0};b(q),q.scope.$index=p,q.scope.$first=0==p,o.push(q)}m=k.concat(o),n=l}else if(f.length<k.length){for(var p=f.length;p<k.length;++p)k[p].isActiveForRepeat=!1;n=k.splice(f.length,k.length-f.length).concat(l),m=k}else m=k,n=l;if(m.length>0){var r=m.length-1,s=m.length-1;g<m.length&&(r=g),r>0&&(r-=1);for(var p=r;s>=p;++p)m[p].scope.$last=p==m.length-1,m[p].scope.$middle=0!=p&&p!=m.length-1,m[p].isActiveForRepeat||(m[p].isActiveForRepeat=!0,m[p].element.css("display",""))
}for(var p=0;p<n.length&&!n[p].isActiveForRepeat;++p)n[p].element.css("display","none");for(var p=0;p<m.length;++p)m[p].scope[i]=f[p];var t=d;k.length>0&&(t=k[k.length-1].element);for(var p=0;p<o.length;++p)e(o[p].scope,function(b){a.enter(b,null,t),t=b,o[p].element=b});k=m,l=n});c.$on("$destroy",function(){m()})}}}}]),defineScalyrAngularModule("gatedScope",[]).config(["$provide",function(a){a.decorator("$rootScope",["$delegate","$exceptionHandler",function(a,b){scopePrototype={};for(var c in a)isFunction(a[c])&&(scopePrototype[c]=a[c]);var d,e=a.constructor,f={};return f.$new=function(a){var b=scopePrototype.$new.call(this,a);return b.$$gatingFunction=this.$$gatingFunction,b.$$shouldGateFunction=this.$$shouldGateFunction,b.$$gatedWatchers=[],b},f.$digestGated=function(a){var c,e,f,g,h,i=this,j=this,k=!1;do{if(f=i.$$gatedWatchers)for(g=f.length;g--;)try{if(c=f[g],c.gatingFunction!==a)continue;c&&(e=c.get(i))!==(last=c.last)&&!(c.eq?areEqual(e,last):"number"==typeof e&&"number"==typeof last&&isNaN(e)&&isNaN(last))&&(k=!0,c.last=c.eq?copy(e):e,c.fn(e,last===d?e:last,i))}catch(l){b(l)}if(!(h=i.$$gatingFunction===a&&i.$$childHead||i!==j&&i.$$nextSibling))for(;i!==j&&!(h=i.$$nextSibling);)i=i.$parent}while(i=h);return k},f.$watch=function(a,b,c,e){if(isNull(this.$$gatingFunction)||!isNull(this.$$shouldGateFunction)&&!this.$$shouldGateFunction(a,b,c,e))return scopePrototype.$watch.call(this,a,b,c);var f=this.$$watchers;this.$$watchers=this.$$gatedWatchers;var g=scopePrototype.$watch.call(this,a,b,c);return this.$$watchers=f,this.$$gatedWatchers[0].gatingFunction=this.$$gatingFunction,d=this.$$gatedWatchers[0].last,g},f.$addWatcherGate=function(a,b){var c=0,d=this,e=!isNull(this.$$gatingFunction),f=null;this.$watch(function(){return a()?d.$digestGated(a)&&++c:e&&isNull(f)&&(f=scopePrototype.$watch.call(d,function(){return a()&&(f(),f=null,d.$digestGated(a)&&++c),c})),c}),isUndefined(b)&&(b=null),this.$$gatingFunction=a,this.$$shouldGateFunction=b},angular.extend(e.prototype,f),angular.extend(a,f),a.$$gatingFunction=null,a.$$shouldGateFunction=null,a.$$gatedWatchers=[],a}])}]),Array.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=b||0;c<this.length;c++)if(this[c]===a)return c;return-1});var Parser=function(a){function b(a){function b(){}return b.prototype=a,new b}function c(a,b,c,d){this.type_=a,this.index_=b||0,this.prio_=c||0,this.number_=void 0!==d&&null!==d?d:0,this.toString=function(){switch(this.type_){case r:return this.number_;case s:case t:case u:return this.index_;case v:return"CALL";default:return"Invalid Token"}}}function d(a,b,c,d){this.tokens=a,this.ops1=b,this.ops2=c,this.functions=d}function e(a){return"string"==typeof a?(w.lastIndex=0,w.test(a)?"'"+a.replace(w,function(a){var b=x[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+a+"'"):a}function f(a,b){return Number(a)+Number(b)}function g(a,b){return a-b}function h(a,b){return a*b}function i(a,b){return a/b}function j(a,b){return a%b}function k(a,b){return""+a+b}function l(a){return-a}function m(a){return Math.random()*(a||1)}function n(a){a=Math.floor(a);for(var b=a;a>1;)b*=--a;return b}function o(a,b){return Math.sqrt(a*a+b*b)}function p(a,b){return"[object Array]"!=Object.prototype.toString.call(a)?[a,b]:(a=a.slice(),a.push(b),a)}function q(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,"-":l,exp:Math.exp},this.ops2={"+":f,"-":g,"*":h,"/":i,"%":j,"^":Math.pow,",":p,"||":k},this.functions={random:m,fac:n,min:Math.min,max:Math.max,pyt:o,pow:Math.pow,atan2:Math.atan2},this.consts={E:Math.E,PI:Math.PI}}var r=0,s=1,t=2,u=3,v=4,w=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,x={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};d.prototype={simplify:function(a){a=a||{};var e,f,g,h,i=[],j=[],k=this.tokens.length,l=0;for(l=0;k>l;l++){h=this.tokens[l];var m=h.type_;if(m===r)i.push(h);else if(m===u&&h.index_ in a)h=new c(r,0,0,a[h.index_]),i.push(h);else if(m===t&&i.length>1)f=i.pop(),e=i.pop(),g=this.ops2[h.index_],h=new c(r,0,0,g(e.number_,f.number_)),i.push(h);else if(m===s&&i.length>0)e=i.pop(),g=this.ops1[h.index_],h=new c(r,0,0,g(e.number_)),i.push(h);else{for(;i.length>0;)j.push(i.shift());j.push(h)}}for(;i.length>0;)j.push(i.shift());return new d(j,b(this.ops1),b(this.ops2),b(this.functions))},substitute:function(a,e){e instanceof d||(e=(new q).parse(String(e)));var f,g=[],h=this.tokens.length,i=0;for(i=0;h>i;i++){f=this.tokens[i];var j=f.type_;if(j===u&&f.index_===a)for(var k=0;k<e.tokens.length;k++){var l=e.tokens[k],m=new c(l.type_,l.index_,l.prio_,l.number_);g.push(m)}else g.push(f)}var n=new d(g,b(this.ops1),b(this.ops2),b(this.functions));return n},evaluate:function(a){a=a||{};var b,c,d,e,f=[],g=this.tokens.length,h=0;for(h=0;g>h;h++){e=this.tokens[h];var i=e.type_;if(i===r)f.push(e.number_);else if(i===t)c=f.pop(),b=f.pop(),d=this.ops2[e.index_],f.push(d(b,c));else if(i===u)if(e.index_ in a)f.push(a[e.index_]);else{if(!(e.index_ in this.functions))throw new Error("undefined variable: "+e.index_);f.push(this.functions[e.index_])}else if(i===s)b=f.pop(),d=this.ops1[e.index_],f.push(d(b));else{if(i!==v)throw new Error("invalid Expression");if(b=f.pop(),d=f.pop(),!d.apply||!d.call)throw new Error(d+" is not a function");f.push("[object Array]"==Object.prototype.toString.call(b)?d.apply(void 0,b):d.call(void 0,b))}}if(f.length>1)throw new Error("invalid Expression (parity)");return f[0]},toString:function(a){var b,c,d,f,g=[],h=this.tokens.length,i=0;for(i=0;h>i;i++){f=this.tokens[i];var j=f.type_;if(j===r)g.push(e(f.number_));else if(j===t)c=g.pop(),b=g.pop(),d=f.index_,g.push(a&&"^"==d?"Math.pow("+b+","+c+")":"("+b+d+c+")");else if(j===u)g.push(f.index_);else if(j===s)b=g.pop(),d=f.index_,g.push("-"===d?"("+d+b+")":d+"("+b+")");else{if(j!==v)throw new Error("invalid Expression");b=g.pop(),d=g.pop(),g.push(d+"("+b+")")}}if(g.length>1)throw new Error("invalid Expression (parity)");return g[0]},variables:function(){for(var a=this.tokens.length,b=[],c=0;a>c;c++){var d=this.tokens[c];d.type_===u&&-1==b.indexOf(d.index_)&&b.push(d.index_)}return b},toJSFunction:function(a,b){var c=new Function(a,"with(Parser.values) { return "+this.simplify(b).toString(!0)+"; }");return c}},q.parse=function(a){return(new q).parse(a)},q.evaluate=function(a,b){return q.parse(a).evaluate(b)},q.Expression=d,q.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:m,fac:n,exp:Math.exp,min:Math.min,max:Math.max,pyt:o,pow:Math.pow,atan2:Math.atan2,E:Math.E,PI:Math.PI};var y=1,z=2,A=4,B=8,C=16,D=32,E=64,F=128,G=256;return q.prototype={parse:function(a){this.errormsg="",this.success=!0;var e=[],f=[];this.tmpprio=0;var g=y|B|A|E,h=0;for(this.expression=a,this.pos=0;this.pos<this.expression.length;)if(this.isOperator())this.isSign()&&g&E?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",h++,this.addfunc(f,e,s)),g=y|B|A|E):this.isComment()||(0===(g&z)&&this.error_parsing(this.pos,"unexpected operator"),h+=2,this.addfunc(f,e,t),g=y|B|A|E);else if(this.isNumber()){0===(g&y)&&this.error_parsing(this.pos,"unexpected number");var i=new c(r,0,0,this.tokennumber);f.push(i),g=z|C|D}else if(this.isString()){0===(g&y)&&this.error_parsing(this.pos,"unexpected string");var i=new c(r,0,0,this.tokennumber);f.push(i),g=z|C|D}else if(this.isLeftParenth())0===(g&B)&&this.error_parsing(this.pos,'unexpected "("'),g&F&&(h+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(f,e,v)),g=y|B|A|E|G;else if(this.isRightParenth()){if(g&G){var i=new c(r,0,0,[]);f.push(i)}else 0===(g&C)&&this.error_parsing(this.pos,'unexpected ")"');g=z|C|D|B|F}else if(this.isComma())0===(g&D)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(f,e,t),h+=2,g=y|B|A|E;else if(this.isConst()){0===(g&y)&&this.error_parsing(this.pos,"unexpected constant");var j=new c(r,0,0,this.tokennumber);f.push(j),g=z|C|D}else if(this.isOp2())0===(g&A)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(f,e,t),h+=2,g=B;else if(this.isOp1())0===(g&A)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(f,e,s),h++,g=B;else if(this.isVar()){0===(g&y)&&this.error_parsing(this.pos,"unexpected variable");var k=new c(u,this.tokenindex,0,0);f.push(k),g=z|C|D|B|F}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg));for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');e.length>0;){var l=e.pop();f.push(l)}return h+1!==f.length&&this.error_parsing(this.pos,"parity"),new d(f,b(this.ops1),b(this.ops2),b(this.functions))},evaluate:function(a,b){return this.parse(a).evaluate(b)},error_parsing:function(a,b){throw this.success=!1,this.errormsg="parse error [column "+a+"]: "+b,new Error(this.errormsg)},addfunc:function(a,b,d){for(var e=new c(d,this.tokenindex,this.tokenprio+this.tmpprio,0);b.length>0&&e.prio_<=b[b.length-1].prio_;)a.push(b.pop());b.push(e)},isNumber:function(){for(var a=!1,b="";this.pos<this.expression.length;){var c=this.expression.charCodeAt(this.pos);if(!(c>=48&&57>=c||46===c))break;b+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(b),a=!0}return a},unescape:function(a,b){for(var c=[],d=!1,e=0;e<a.length;e++){var f=a.charAt(e);if(d){switch(f){case"'":c.push("'");break;case"\\":c.push("\\");break;case"/":c.push("/");break;case"b":c.push("\b");break;case"f":c.push("\f");break;case"n":c.push("\n");break;case"r":c.push("\r");break;case"t":c.push("	");break;case"u":var g=parseInt(a.substring(e+1,e+5),16);c.push(String.fromCharCode(g)),e+=4;break;default:throw this.error_parsing(b+e,"Illegal escape sequence: '\\"+f+"'")}d=!1}else"\\"==f?d=!0:c.push(f)}return c.join("")},isString:function(){var a=!1,b="",c=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){var d=this.expression.charAt(this.pos);if("'"==d&&"\\"!=b.slice(-1)){this.pos++,this.tokennumber=this.unescape(b,c),a=!0;break}b+=this.expression.charAt(this.pos),this.pos++}return a},isConst:function(){var a;for(var b in this.consts){var c=b.length;if(a=this.expression.substr(this.pos,c),b===a)return this.tokennumber=this.consts[b],this.pos+=c,!0}return!1},isOperator:function(){var a=this.expression.charCodeAt(this.pos);if(43===a)this.tokenprio=0,this.tokenindex="+";else if(45===a)this.tokenprio=0,this.tokenindex="-";else if(124===a){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="||"}else if(42===a)this.tokenprio=1,this.tokenindex="*";else if(47===a)this.tokenprio=2,this.tokenindex="/";else if(37===a)this.tokenprio=2,this.tokenindex="%";else{if(94!==a)return!1;this.tokenprio=3,this.tokenindex="^"}return this.pos++,!0},isSign:function(){var a=this.expression.charCodeAt(this.pos-1);return 45===a||43===a?!0:!1},isPositiveSign:function(){var a=this.expression.charCodeAt(this.pos-1);return 43===a?!0:!1},isNegativeSign:function(){var a=this.expression.charCodeAt(this.pos-1);return 45===a?!0:!1},isLeftParenth:function(){var a=this.expression.charCodeAt(this.pos);return 40===a?(this.pos++,this.tmpprio+=10,!0):!1},isRightParenth:function(){var a=this.expression.charCodeAt(this.pos);return 41===a?(this.pos++,this.tmpprio-=10,!0):!1},isComma:function(){var a=this.expression.charCodeAt(this.pos);return 44===a?(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0):!1},isWhite:function(){var a=this.expression.charCodeAt(this.pos);return 32===a||9===a||10===a||13===a?(this.pos++,!0):!1},isOp1:function(){for(var a="",b=this.pos;b<this.expression.length;b++){var c=this.expression.charAt(b);if(c.toUpperCase()===c.toLowerCase()&&(b===this.pos||"_"!=c&&("0">c||c>"9")))break;a+=c}return a.length>0&&a in this.ops1?(this.tokenindex=a,this.tokenprio=5,this.pos+=a.length,!0):!1},isOp2:function(){for(var a="",b=this.pos;b<this.expression.length;b++){var c=this.expression.charAt(b);if(c.toUpperCase()===c.toLowerCase()&&(b===this.pos||"_"!=c&&("0">c||c>"9")))break;a+=c}return a.length>0&&a in this.ops2?(this.tokenindex=a,this.tokenprio=5,this.pos+=a.length,!0):!1},isVar:function(){for(var a="",b=this.pos;b<this.expression.length;b++){var c=this.expression.charAt(b);if(c.toUpperCase()===c.toLowerCase()&&(b===this.pos||"_"!=c&&("0">c||c>"9")))break;a+=c}return a.length>0?(this.tokenindex=a,this.tokenprio=4,this.pos+=a.length,!0):!1},isComment:function(){var a=this.expression.charCodeAt(this.pos-1);return 47===a&&42===this.expression.charCodeAt(this.pos)?(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0):!1}},a.Parser=q,q}("undefined"==typeof exports?{}:exports);!function(){var a,b,c,d;!function(){var e={},f={};a=function(a,b,c){e[a]={deps:b,callback:c}},d=c=b=function(a){function c(b){if("."!==b.charAt(0))return b;for(var c=b.split("/"),d=a.split("/").slice(0,-1),e=0,f=c.length;f>e;e++){var g=c[e];if(".."===g)d.pop();else{if("."===g)continue;d.push(g)}}return d.join("/")}if(d._eak_seen=e,f[a])return f[a];if(f[a]={},!e[a])throw new Error("Could not find module "+a);for(var g,h=e[a],i=h.deps,j=h.callback,k=[],l=0,m=i.length;m>l;l++)k.push("exports"===i[l]?g={}:b(c(i[l])));var n=j.apply(this,k);return f[a]=g||n}}(),a("promise/all",["./utils","exports"],function(a,b){"use strict";function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to all.");return new b(function(b,c){function d(a){return function(b){f(a,b)}}function f(a,c){h[a]=c,0===--i&&b(h)}var g,h=[],i=a.length;0===i&&b([]);for(var j=0;j<a.length;j++)g=a[j],g&&e(g.then)?g.then(d(j),c):f(j,g)})}var d=a.isArray,e=a.isFunction;b.all=c}),a("promise/asap",["exports"],function(a){"use strict";function b(){return function(){process.nextTick(e)}}function c(){var a=0,b=new i(e),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function d(){return function(){j.setTimeout(e,1)}}function e(){for(var a=0;a<k.length;a++){var b=k[a],c=b[0],d=b[1];c(d)}k=[]}function f(a,b){var c=k.push([a,b]);1===c&&g()}var g,h="undefined"!=typeof window?window:{},i=h.MutationObserver||h.WebKitMutationObserver,j="undefined"!=typeof global?global:this,k=[];g="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?b():i?c():d(),a.asap=f}),a("promise/cast",["exports"],function(a){"use strict";function b(a){if(a&&"object"==typeof a&&a.constructor===this)return a;var b=this;return new b(function(b){b(a)})}a.cast=b}),a("promise/config",["exports"],function(a){"use strict";function b(a,b){return 2!==arguments.length?c[a]:void(c[a]=b)}var c={instrument:!1};a.config=c,a.configure=b}),a("promise/polyfill",["./promise","./utils","exports"],function(a,b,c){"use strict";function d(){var a="Promise"in window&&"cast"in window.Promise&&"resolve"in window.Promise&&"reject"in window.Promise&&"all"in window.Promise&&"race"in window.Promise&&function(){var a;return new window.Promise(function(b){a=b}),f(a)}();a||(window.Promise=e)}var e=a.Promise,f=b.isFunction;c.polyfill=d}),a("promise/promise",["./config","./utils","./cast","./all","./race","./resolve","./reject","./asap","exports"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){if(!w(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof j))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],k(a,this)}function k(a,b){function c(a){p(b,a)}function d(a){r(b,a)}try{a(c,d)}catch(e){d(e)}}function l(a,b,c,d){var e,f,g,h,i=w(c);if(i)try{e=c(d),g=!0}catch(j){h=!0,f=j}else e=d,g=!0;o(b,e)||(i&&g?p(b,e):h?r(b,f):a===F?p(b,e):a===G&&r(b,e))}function m(a,b,c,d){var e=a._subscribers,f=e.length;e[f]=b,e[f+F]=c,e[f+G]=d}function n(a,b){for(var c,d,e=a._subscribers,f=a._detail,g=0;g<e.length;g+=3)c=e[g],d=e[g+b],l(b,c,d,f);a._subscribers=null}function o(a,b){var c,d=null;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(v(b)&&(d=b.then,w(d)))return d.call(b,function(d){return c?!0:(c=!0,void(b!==d?p(a,d):q(a,d)))},function(b){return c?!0:(c=!0,void r(a,b))}),!0}catch(e){return c?!0:(r(a,e),!0)}return!1}function p(a,b){a===b?q(a,b):o(a,b)||q(a,b)}function q(a,b){a._state===D&&(a._state=E,a._detail=b,u.async(s,a))}function r(a,b){a._state===D&&(a._state=E,a._detail=b,u.async(t,a))}function s(a){n(a,a._state=F)}function t(a){n(a,a._state=G)}var u=a.config,v=(a.configure,b.objectOrFunction),w=b.isFunction,x=(b.now,c.cast),y=d.all,z=e.race,A=f.resolve,B=g.reject,C=h.asap;u.async=C;var D=void 0,E=0,F=1,G=2;j.prototype={constructor:j,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var c=this,d=new this.constructor(function(){});if(this._state){var e=arguments;u.async(function(){l(c._state,d,e[c._state-1],c._detail)})}else m(this,d,a,b);return d},"catch":function(a){return this.then(null,a)}},j.all=y,j.cast=x,j.race=z,j.resolve=A,j.reject=B,i.Promise=j}),a("promise/race",["./utils","exports"],function(a,b){"use strict";function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to race.");return new b(function(b,c){for(var d,e=0;e<a.length;e++)d=a[e],d&&"function"==typeof d.then?d.then(b,c):b(d)})}var d=a.isArray;b.race=c}),a("promise/reject",["exports"],function(a){"use strict";function b(a){var b=this;return new b(function(b,c){c(a)})}a.reject=b}),a("promise/resolve",["exports"],function(a){"use strict";function b(a){var b=this;return new b(function(b){b(a)})}a.resolve=b}),a("promise/utils",["exports"],function(a){"use strict";function b(a){return c(a)||"object"==typeof a&&null!==a}function c(a){return"function"==typeof a}function d(a){return"[object Array]"===Object.prototype.toString.call(a)}var e=Date.now||function(){return(new Date).getTime()};a.objectOrFunction=b,a.isFunction=c,a.isArray=d,a.now=e}),b("promise/polyfill").polyfill()}(),function(){"use strict";function a(a){if(a)for(var b in j)void 0!==a[b]&&(j[b]=a[b]);return new h(function(a,b){var c=k.open(j.name,j.version);c.onerror=function(){b(c.error.name)},c.onupgradeneeded=function(){c.result.createObjectStore(j.storeName)},c.onsuccess=function(){i=c.result,a()}})}function b(a,b){var c=this;return new h(function(d,e){c.ready().then(function(){var c=i.transaction(j.storeName,"readonly").objectStore(j.storeName),f=c.get(a);f.onsuccess=function(){var a=f.result;void 0===a&&(a=null),b&&b(a),d(a)},f.onerror=function(){e(f.error.name)}})})}function c(a,b,c){var d=this;return new h(function(e,f){d.ready().then(function(){var d=i.transaction(j.storeName,"readwrite").objectStore(j.storeName);void 0===b&&(b=null);var g=d.put(b,a);g.onsuccess=function(){c&&c(b),e(b)},g.onerror=function(){f(g.error.name)}})})}function d(a,b){var c=this;return new h(function(d,e){c.ready().then(function(){var c=i.transaction(j.storeName,"readwrite").objectStore(j.storeName),f=c["delete"](a);f.onsuccess=function(){b&&b(),d()},f.onerror=function(){e(f.error.name)}})})}function e(a){var b=this;return new h(function(c,d){b.ready().then(function(){var b=i.transaction(j.storeName,"readwrite").objectStore(j.storeName),e=b.clear();e.onsuccess=function(){a&&a(),c()},e.onerror=function(){d(e.error.name)}})})}function f(a){var b=this;return new h(function(c,d){b.ready().then(function(){var b=i.transaction(j.storeName,"readonly").objectStore(j.storeName),e=b.count();e.onsuccess=function(){a&&a(e.result),c(e.result)},e.onerror=function(){d(e.error.name)}})})}function g(a,b){var c=this;return new h(function(d,e){return 0>a?(b&&b(null),void d(null)):void c.ready().then(function(){var c=i.transaction(j.storeName,"readonly").objectStore(j.storeName),f=!1,g=c.openCursor();g.onsuccess=function(){var c=g.result;return c?void(0===a?(b&&b(c.key),d(c.key)):f?(b&&b(c.key),d(c.key)):(f=!0,c.advance(a))):(b&&b(null),void d(null))},g.onerror=function(){e(g.error.name)}})})}var h=this.Promise,i=null,j={name:"localforage",storeName:"keyvaluepairs",version:1},k=k||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(k){var l={_driver:"asyncStorage",_initStorage:a,getItem:b,setItem:c,removeItem:d,clear:e,length:f,key:g};"function"==typeof define&&define.amd?define("asyncStorage",function(){return l}):"undefined"!=typeof module&&module.exports?module.exports=l:this.asyncStorage=l}}.call(this),function(){"use strict";function a(a){if(a)for(var b in l)void 0!==a[b]&&(l[b]=a[b]);return k=l.name+"/",m.resolve()}function b(a){var b=this;return new m(function(c){b.ready().then(function(){n.clear(),a&&a(),c()})})}function c(a,b){var c=this;return new m(function(d,e){c.ready().then(function(){try{var c=n.getItem(k+a);c&&(c=g(c)),b&&b(c),d(c)}catch(f){e(f)}})})}function d(a,b){var c=this;return new m(function(d){c.ready().then(function(){var c=n.key(a);c&&(c=c.substring(k.length)),b&&b(c),d(c)})})}function e(a){var b=this;return new m(function(c){b.ready().then(function(){var b=n.length;a&&a(b),c(b)})})}function f(a,b){var c=this;return new m(function(d){c.ready().then(function(){n.removeItem(k+a),b&&b(),d()})})}function g(a){if(a.substring(0,q)!==p)return JSON.parse(a);for(var b=a.substring(C),c=a.substring(q,C),d=new ArrayBuffer(2*b.length),e=new Uint16Array(d),f=b.length-1;f>=0;f--)e[f]=b.charCodeAt(f);switch(c){case r:return d;case s:return new Blob([d]);case t:return new Int8Array(d);case u:return new Uint8Array(d);case v:return new Uint8ClampedArray(d);case w:return new Int16Array(d);case y:return new Uint16Array(d);case x:return new Int32Array(d);case z:return new Uint32Array(d);case A:return new Float32Array(d);case B:return new Float64Array(d);default:throw new Error("Unkown type: "+c)}}function h(a){var b="",c=new Uint16Array(a);try{b=String.fromCharCode.apply(null,c)}catch(d){for(var e=0;e<c.length;e++)b+=String.fromCharCode(c[e])}return b}function i(a,b){var c="";if(a&&(c=a.toString()),a&&("[object ArrayBuffer]"===a.toString()||a.buffer&&"[object ArrayBuffer]"===a.buffer.toString())){var d,e=p;a instanceof ArrayBuffer?(d=a,e+=r):(d=a.buffer,"[object Int8Array]"===c?e+=t:"[object Uint8Array]"===c?e+=u:"[object Uint8ClampedArray]"===c?e+=v:"[object Int16Array]"===c?e+=w:"[object Uint16Array]"===c?e+=y:"[object Int32Array]"===c?e+=x:"[object Uint32Array]"===c?e+=z:"[object Float32Array]"===c?e+=A:"[object Float64Array]"===c?e+=B:b(new Error("Failed to get type for BinaryArray")));var f=h(d);b(null,e+f)}else if("[object Blob]"===c){var g=new FileReader;g.onload=function(){var a=h(this.result);b(null,p+s+a)},g.readAsArrayBuffer(a)}else try{b(null,JSON.stringify(a))}catch(i){window.console&&window.console.error&&window.console.error("Couldn't convert value into a JSON string: ",a),b(i)}}function j(a,b,c){var d=this;return new m(function(e,f){d.ready().then(function(){void 0===b&&(b=null);var d=b;i(b,function(b,g){b?f(b):(n.setItem(k+a,g),c&&c(d),e(d))})})})}var k="",l={name:"localforage"},m=this.Promise,n=null;try{n=this.localStorage}catch(o){return}var p="__lfsc__:",q=p.length,r="arbf",s="blob",t="si08",u="ui08",v="uic8",w="si16",x="si32",y="ur16",z="ui32",A="fl32",B="fl64",C=q+r.length,D={_driver:"localStorageWrapper",_initStorage:a,getItem:c,setItem:j,removeItem:f,clear:b,length:e,key:d};"function"==typeof define&&define.amd?define("localStorageWrapper",function(){return D}):"undefined"!=typeof module&&module.exports?module.exports=D:this.localStorageWrapper=D}.call(this),function(){"use strict";function a(a){if(a)for(var b in o)void 0!==a[b]&&(o[b]="string"!=typeof a[b]?a[b].toString():a[b]);return new l(function(a){n=m(o.name,o.version,o.description,o.size),n.transaction(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS "+o.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){a()},null)})})}function b(a,b){var c=this;return new l(function(d){c.ready().then(function(){n.transaction(function(c){c.executeSql("SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[a],function(a,c){var e=c.rows.length?c.rows.item(0).value:null;e&&(e=i(e)),b&&b(e),d(e)},null)})})})}function c(a,b,c){var d=this;return new l(function(e,f){d.ready().then(function(){void 0===b&&(b=null);var d=b;j(b,function(b,g){b?f(b):n.transaction(function(b){b.executeSql("INSERT OR REPLACE INTO "+o.storeName+" (key, value) VALUES (?, ?)",[a,g],function(){c&&c(d),e(d)},null)})})})})}function d(a,b){var c=this;return new l(function(d){c.ready().then(function(){n.transaction(function(c){c.executeSql("DELETE FROM "+o.storeName+" WHERE key = ?",[a],function(){b&&b(),d()},null)})})})}function e(a){var b=this;return new l(function(c){b.ready().then(function(){n.transaction(function(b){b.executeSql("DELETE FROM "+o.storeName,[],function(){a&&a(),c()},null)})})})}function f(a){var b=this;return new l(function(c){b.ready().then(function(){n.transaction(function(b){b.executeSql("SELECT COUNT(key) as c FROM "+o.storeName,[],function(b,d){var e=d.rows.item(0).c;a&&a(e),c(e)},null)})})})}function g(a,b){var c=this;return new l(function(d){c.ready().then(function(){n.transaction(function(c){c.executeSql("SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[a+1],function(a,c){var e=c.rows.length?c.rows.item(0).key:null;b&&b(e),d(e)},null)})})})}function h(a){var b,c=new Uint8Array(a),d="";for(b=0;b<c.length;b+=3)d+=k[c[b]>>2],d+=k[(3&c[b])<<4|c[b+1]>>4],d+=k[(15&c[b+1])<<2|c[b+2]>>6],d+=k[63&c[b+2]];return c.length%3===2?d=d.substring(0,d.length-1)+"=":c.length%3===1&&(d=d.substring(0,d.length-2)+"=="),d}function i(a){if(a.substring(0,q)!==p)return JSON.parse(a);var b,c,d,e,f,g=a.substring(C),h=a.substring(q,C),i=.75*g.length,j=g.length,l=0;"="===g[g.length-1]&&(i--,"="===g[g.length-2]&&i--);var m=new ArrayBuffer(i),n=new Uint8Array(m);for(b=0;j>b;b+=4)c=k.indexOf(g[b]),d=k.indexOf(g[b+1]),e=k.indexOf(g[b+2]),f=k.indexOf(g[b+3]),n[l++]=c<<2|d>>4,n[l++]=(15&d)<<4|e>>2,n[l++]=(3&e)<<6|63&f;switch(h){case r:return m;case s:return new Blob([m]);case t:return new Int8Array(m);case u:return new Uint8Array(m);case v:return new Uint8ClampedArray(m);case w:return new Int16Array(m);case y:return new Uint16Array(m);case x:return new Int32Array(m);case z:return new Uint32Array(m);case A:return new Float32Array(m);case B:return new Float64Array(m);default:throw new Error("Unkown type: "+h)}}function j(a,b){var c="";if(a&&(c=a.toString()),a&&("[object ArrayBuffer]"===a.toString()||a.buffer&&"[object ArrayBuffer]"===a.buffer.toString())){var d,e=p;a instanceof ArrayBuffer?(d=a,e+=r):(d=a.buffer,"[object Int8Array]"===c?e+=t:"[object Uint8Array]"===c?e+=u:"[object Uint8ClampedArray]"===c?e+=v:"[object Int16Array]"===c?e+=w:"[object Uint16Array]"===c?e+=y:"[object Int32Array]"===c?e+=x:"[object Uint32Array]"===c?e+=z:"[object Float32Array]"===c?e+=A:"[object Float64Array]"===c?e+=B:b(new Error("Failed to get type for BinaryArray")));var f=h(d);b(null,e+f)}else if("[object Blob]"===c){var g=new FileReader;g.onload=function(){var a=h(this.result);b(null,p+s+a)},g.readAsArrayBuffer(a)}else try{b(null,JSON.stringify(a))}catch(i){window.console&&window.console.error&&window.console.error("Couldn't convert value into a JSON string: ",a),b(i)}}var k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=this.Promise,m=this.openDatabase,n=null,o={description:"",name:"localforage",size:4980736,storeName:"keyvaluepairs",version:"1.0"},p="__lfsc__:",q=p.length,r="arbf",s="blob",t="si08",u="ui08",v="uic8",w="si16",x="si32",y="ur16",z="ui32",A="fl32",B="fl64",C=q+r.length;if(m){var D={_driver:"webSQLStorage",_initStorage:a,getItem:b,setItem:c,removeItem:d,clear:e,length:f,key:g};"function"==typeof define&&define.amd?define("webSQLStorage",function(){return D}):"undefined"!=typeof module&&module.exports?module.exports=D:this.webSQLStorage=D}}.call(this),function(){"use strict";var a=this.Promise,b=1,c=2,d=3,e=d;"function"==typeof define&&define.amd?e=b:"undefined"!=typeof module&&module.exports&&(e=c);var f,g=g||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB,h=this.openDatabase,i=this,j={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage",config:{},driver:function(){return this._driver||null},_ready:a.reject(new Error("setDriver() wasn't called")),setDriver:function(d,f){var k=new a(function(a,f){if(!g&&d===j.INDEXEDDB||!h&&d===j.WEBSQL)return void f(j);if(j._ready=null,e===b)return void require([d],function(b){j._extend(b),a(j)});if(e===c){var k;switch(d){case j.INDEXEDDB:k=require("localforage/src/drivers/indexeddb");break;case j.LOCALSTORAGE:k=require("localforage/src/drivers/localstorage");break;case j.WEBSQL:k=require("localforage/src/drivers/websql")}j._extend(k)}else j._extend(i[d]);a(j)});return k.then(f,f),k},ready:function(a){return null===this._ready&&(this._ready=this._initStorage(this.config)),this._ready.then(a,a),this._ready},_extend:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}};f=g&&null===g.open("_localforage_spec_test",1).onupgradeneeded?j.INDEXEDDB:h?j.WEBSQL:j.LOCALSTORAGE,this.localForageConfig&&(j.config=this.localForageConfig),j.setDriver(f),e===b?define(function(){return j}):e===c?module.exports=j:this.localforage=j}.call(this),function(){"use strict";angular.module("ngSocket",[]).factory("$socket",["$rootScope",function(a){var b,c,d,e,f,g,h,i;return"undefined"==typeof i&&(i=io.connect()),d=function(b){return function(){var c;b&&(c=arguments,a.$apply(function(){b.apply(i,c)}))}},b=function(a,b,c){2===arguments.length&&(b=null,c=arguments[1]),i.addListener(a,d(c)),null!==b&&b.$on("$destroy",function(){h(a,c)})},c=function(a,b){i.once(a,d(b))},h=function(a,b){i.removeListener(a,d(b))},g=function(a){i.removeAllListeners(a)},e=function(a,b,c){i.emit(a,b,d(c))},f=function(){return i.socket.connected},{is_online:f,addListener:b,on:b,once:c,removeListener:h,removeAllListeners:g,emit:e}}])}.call(this),angular.module("Decorators",[]).config(["$provide",function(a){a.decorator("$rootScope",function(a,b){function c(a){return a&&a.document&&a.location&&a.alert&&a.setInterval}function d(a){if(null==a||c(a))return!1;var b=a.length;return 1===a.nodeType&&b?!0:angular.isString(a)||angular.isArray(a)||0===b||"number"==typeof b&&b>0&&b-1 in a}var e=Object.getPrototypeOf(a),f=angular.isObject,g=angular.noop;return e.$watchCollection=function(a,c){function e(){var a,b,c,e;if(j=m(k),i=q,e=0,f(j))if(d(j)){if(a=j.length,q!==n)e++;else if(p!==a)e++;else for(c=0;a>c;c++)if(q[c]!==j[c]){e++;break}if(e)for(q=n=[],q.length=p=a,c=0;a>c;c++)q[c]=j[c]}else{if(q!==o)e++;else{a=0;for(b in j)if(j.hasOwnProperty(b)&&(a++,!q.hasOwnProperty(b)||q[b]!==j[b])){e++;break}p!==a&&e++}if(e){q=o={},p=0;for(b in j)j.hasOwnProperty(b)&&(p++,q[b]=j[b])}}else q!==j&&(q=j,e++);return e&&(l=1-l,i===g&&(i=j)),l}function h(){c(j,i,k)}var i,j,k=this,l=0,m=b(a),n=[],o={},p=0,q=g;return this.$watch(e,h)},a})}]),function(){function a(a){var c=!1;return function(){if(c)throw new Error("Callback was already called.");c=!0,a.apply(b,arguments)}}var b,c,d={};b=this,null!=b&&(c=b.async),d.noConflict=function(){return b.async=c,d};var e=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},f=function(a,b){if(a.map)return a.map(b);var c=[];return e(a,function(a,d,e){c.push(b(a,d,e))}),c},g=function(a,b,c){return a.reduce?a.reduce(b,c):(e(a,function(a,d,e){c=b(c,a,d,e)}),c)},h=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b};"undefined"!=typeof process&&process.nextTick?(d.nextTick=process.nextTick,d.setImmediate="undefined"!=typeof setImmediate?function(a){setImmediate(a)
}:d.nextTick):"function"==typeof setImmediate?(d.nextTick=function(a){setImmediate(a)},d.setImmediate=d.nextTick):(d.nextTick=function(a){setTimeout(a,0)},d.setImmediate=d.nextTick),d.each=function(b,c,d){if(d=d||function(){},!b.length)return d();var f=0;e(b,function(e){c(e,a(function(a){a?(d(a),d=function(){}):(f+=1,f>=b.length&&d(null))}))})},d.forEach=d.each,d.eachSeries=function(a,b,c){if(c=c||function(){},!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c(null):e())})};e()},d.forEachSeries=d.eachSeries,d.eachLimit=function(a,b,c,d){var e=i(b);e.apply(null,[a,c,d])},d.forEachLimit=d.eachLimit;var i=function(a){return function(b,c,d){if(d=d||function(){},!b.length||0>=a)return d();var e=0,f=0,g=0;!function h(){if(e>=b.length)return d();for(;a>g&&f<b.length;)f+=1,g+=1,c(b[f-1],function(a){a?(d(a),d=function(){}):(e+=1,g-=1,e>=b.length?d():h())})}()}},j=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[d.each].concat(b))}},k=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[i(a)].concat(c))}},l=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[d.eachSeries].concat(b))}},m=function(a,b,c,d){var e=[];b=f(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d,b(c)})},function(a){d(a,e)})};d.map=j(m),d.mapSeries=l(m),d.mapLimit=function(a,b,c,d){return n(b)(a,c,d)};var n=function(a){return k(a,m)};d.reduce=function(a,b,c,e){d.eachSeries(a,function(a,d){c(b,a,function(a,c){b=c,d(a)})},function(a){e(a,b)})},d.inject=d.reduce,d.foldl=d.reduce,d.reduceRight=function(a,b,c,e){var g=f(a,function(a){return a}).reverse();d.reduce(g,b,c,e)},d.foldr=d.reduceRight;var o=function(a,b,c,d){var e=[];b=f(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c&&e.push(a),b()})},function(){d(f(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};d.filter=j(o),d.filterSeries=l(o),d.select=d.filter,d.selectSeries=d.filterSeries;var p=function(a,b,c,d){var e=[];b=f(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c||e.push(a),b()})},function(){d(f(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};d.reject=j(p),d.rejectSeries=l(p);var q=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(){d()})};d.detect=j(q),d.detectSeries=l(q),d.some=function(a,b,c){d.each(a,function(a,d){b(a,function(a){a&&(c(!0),c=function(){}),d()})},function(){c(!1)})},d.any=d.some,d.every=function(a,b,c){d.each(a,function(a,d){b(a,function(a){a||(c(!1),c=function(){}),d()})},function(){c(!0)})},d.all=d.every,d.sortBy=function(a,b,c){d.map(a,function(a,c){b(a,function(b,d){b?c(b):c(null,{value:a,criteria:d})})},function(a,b){if(a)return c(a);var d=function(a,b){var c=a.criteria,d=b.criteria;return d>c?-1:c>d?1:0};c(null,f(b.sort(d),function(a){return a.value}))})},d.auto=function(a,b){b=b||function(){};var c=h(a);if(!c.length)return b(null);var f={},i=[],j=function(a){i.unshift(a)},k=function(a){for(var b=0;b<i.length;b+=1)if(i[b]===a)return void i.splice(b,1)},l=function(){e(i.slice(0),function(a){a()})};j(function(){h(f).length===c.length&&(b(null,f),b=function(){})}),e(c,function(c){var i=a[c]instanceof Function?[a[c]]:a[c],m=function(a){var g=Array.prototype.slice.call(arguments,1);if(g.length<=1&&(g=g[0]),a){var i={};e(h(f),function(a){i[a]=f[a]}),i[c]=g,b(a,i),b=function(){}}else f[c]=g,d.setImmediate(l)},n=i.slice(0,Math.abs(i.length-1))||[],o=function(){return g(n,function(a,b){return a&&f.hasOwnProperty(b)},!0)&&!f.hasOwnProperty(c)};if(o())i[i.length-1](m,f);else{var p=function(){o()&&(k(p),i[i.length-1](m,f))};j(p)}})},d.waterfall=function(a,b){if(b=b||function(){},a.constructor!==Array){var c=new Error("First argument to waterfall must be an array of functions");return b(c)}if(!a.length)return b();var e=function(a){return function(c){if(c)b.apply(null,arguments),b=function(){};else{var f=Array.prototype.slice.call(arguments,1),g=a.next();f.push(g?e(g):b),d.setImmediate(function(){a.apply(null,f)})}}};e(d.iterator(a))()};var r=function(a,b,c){if(c=c||function(){},b.constructor===Array)a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.each(h(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}};d.parallel=function(a,b){r({map:d.map,each:d.each},a,b)},d.parallelLimit=function(a,b,c){r({map:n(b),each:i(b)},a,c)},d.series=function(a,b){if(b=b||function(){},a.constructor===Array)d.mapSeries(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},b);else{var c={};d.eachSeries(h(a),function(b,d){a[b](function(a){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),c[b]=e,d(a)})},function(a){b(a,c)})}},d.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},d.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var s=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]),b(a)})},function(a){d(a,e)})};d.concat=j(s),d.concatSeries=l(s),d.whilst=function(a,b,c){a()?b(function(e){return e?c(e):void d.whilst(a,b,c)}):c()},d.doWhilst=function(a,b,c){a(function(e){return e?c(e):void(b()?d.doWhilst(a,b,c):c())})},d.until=function(a,b,c){a()?c():b(function(e){return e?c(e):void d.until(a,b,c)})},d.doUntil=function(a,b,c){a(function(e){return e?c(e):void(b()?c():d.doUntil(a,b,c))})},d.queue=function(b,c){function f(a,b,f,g){b.constructor!==Array&&(b=[b]),e(b,function(b){var e={data:b,callback:"function"==typeof g?g:null};f?a.tasks.unshift(e):a.tasks.push(e),a.saturated&&a.tasks.length===c&&a.saturated(),d.setImmediate(a.process)})}void 0===c&&(c=1);var g=0,h={tasks:[],concurrency:c,saturated:null,empty:null,drain:null,push:function(a,b){f(h,a,!1,b)},unshift:function(a,b){f(h,a,!0,b)},process:function(){if(g<h.concurrency&&h.tasks.length){var c=h.tasks.shift();h.empty&&0===h.tasks.length&&h.empty(),g+=1;var d=function(){g-=1,c.callback&&c.callback.apply(c,arguments),h.drain&&h.tasks.length+g===0&&h.drain(),h.process()},e=a(d);b(c.data,e)}},length:function(){return h.tasks.length},running:function(){return g}};return h},d.cargo=function(a,b){var c=!1,g=[],h={tasks:g,payload:b,saturated:null,empty:null,drain:null,push:function(a,c){a.constructor!==Array&&(a=[a]),e(a,function(a){g.push({data:a,callback:"function"==typeof c?c:null}),h.saturated&&g.length===b&&h.saturated()}),d.setImmediate(h.process)},process:function i(){if(!c){if(0===g.length)return void(h.drain&&h.drain());var d="number"==typeof b?g.splice(0,b):g.splice(0),j=f(d,function(a){return a.data});h.empty&&h.empty(),c=!0,a(j,function(){c=!1;var a=arguments;e(d,function(b){b.callback&&b.callback.apply(null,a)}),i()})}},length:function(){return g.length},running:function(){return c}};return h};var t=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(b?console.error&&console.error(b):console[a]&&e(c,function(b){console[a](b)}))}]))}};d.log=t("log"),d.dir=t("dir"),d.memoize=function(a,b){var c={},d={};b=b||function(a){return a};var e=function(){var e=Array.prototype.slice.call(arguments),f=e.pop(),g=b.apply(null,e);g in c?f.apply(null,c[g]):g in d?d[g].push(f):(d[g]=[f],a.apply(null,e.concat([function(){c[g]=arguments;var a=d[g];delete d[g];for(var b=0,e=a.length;e>b;b++)a[b].apply(null,arguments)}])))};return e.memo=c,e.unmemoized=a,e},d.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}},d.times=function(a,b,c){for(var e=[],f=0;a>f;f++)e.push(f);return d.map(e,b,c)},d.timesSeries=function(a,b,c){for(var e=[],f=0;a>f;f++)e.push(f);return d.mapSeries(e,b,c)},d.compose=function(){var a=Array.prototype.reverse.call(arguments);return function(){var b=this,c=Array.prototype.slice.call(arguments),e=c.pop();d.reduce(a,c,function(a,c,d){c.apply(b,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d(a,b)}]))},function(a,c){e.apply(b,[a].concat(c))})}};var u=function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();return a(b,function(a,b){a.apply(c,d.concat([b]))},e)};if(arguments.length>2){var d=Array.prototype.slice.call(arguments,2);return c.apply(this,d)}return c};d.applyEach=j(u),d.applyEachSeries=l(u),d.forever=function(a,b){function c(d){if(d){if(b)return b(d);throw d}a(c)}c()},"undefined"!=typeof define&&define.amd?define([],function(){return d}):"undefined"!=typeof module&&module.exports?module.exports=d:b.async=d}();var ObjectId=function(){function a(){return this instanceof ObjectId?void("object"==typeof arguments[0]?(this.timestamp=arguments[0].timestamp,this.machine=arguments[0].machine,this.pid=arguments[0].pid,this.increment=arguments[0].increment):"string"==typeof arguments[0]&&24==arguments[0].length?(this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))):4==arguments.length&&null!=arguments[0]?(this.timestamp=arguments[0],this.machine=arguments[1],this.pid=arguments[2],this.increment=arguments[3]):(this.timestamp=Math.floor((new Date).valueOf()/1e3),this.machine=d,this.pid=c,this.increment=b++,b>16777215&&(b=0))):new ObjectId(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}var b=0,c=Math.floor(32767*Math.random()),d=Math.floor(16777216*Math.random());if("undefined"!=typeof localStorage){var e=parseInt(localStorage.mongoMachineId);e>=0&&16777215>=e&&(d=Math.floor(localStorage.mongoMachineId)),localStorage.mongoMachineId=d,document.cookie="mongoMachineId="+d+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}else{var f=document.cookie.split("; ");for(var g in f){var h=f[g].split("=");if("mongoMachineId"==h[0]&&h[1]>=0&&h[1]<=16777215){d=h[1];break}}document.cookie="mongoMachineId="+d+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}return a}();ObjectId.prototype.getDate=function(){return new Date(1e3*this.timestamp)},ObjectId.prototype.toArray=function(){var a,b=this.toString(),c=[];for(a=0;12>a;a++)c[a]=parseInt(b.slice(2*a,2*a+2),16);return c},ObjectId.prototype.toString=function(){var a=this.timestamp.toString(16),b=this.machine.toString(16),c=this.pid.toString(16),d=this.increment.toString(16);return"00000000".substr(0,8-a.length)+a+"000000".substr(0,6-b.length)+b+"0000".substr(0,4-c.length)+c+"000000".substr(0,6-d.length)+d},function(a){var b="undefined";!function(a,b){"undefined"!=typeof module?module.exports=b():"function"==typeof define&&"object"==typeof define.amd?define(b):this[a]=b()}("__log",function(){function c(c){return typeof console===b?l:console[c]===a?console.log!==a?d(console,"__log"):l:d(console,c)}function d(b,c){var d=b[c];if(d.bind!==a)return b[c].bind(b);if(Function.prototype.bind===a)return e(d,b);try{return Function.prototype.bind.call(b[c],b)}catch(f){return e(d,b)}}function e(a,b){return function(){Function.prototype.apply.apply(a,[b,arguments])}}function f(a){for(var b=0;b<m.length;b++)k[m[b]]=a(m[b])}function g(){return typeof window!==b&&window.document!==a&&window.document.cookie!==a}function h(){try{return typeof window!==b&&window.localStorage!==a}catch(c){return!1}}function i(a){var b,c=!1;for(var d in k.levels)if(k.levels.hasOwnProperty(d)&&k.levels[d]===a){b=d;break}if(h())try{window.localStorage.loglevel=b}catch(e){c=!0}else c=!0;c&&g()&&(window.document.cookie="loglevel="+b+";")}function j(){var b;if(h()&&(b=window.localStorage.loglevel),b===a&&g()){var c=n.exec(window.document.cookie)||[];b=c[1]}k.levels[b]===a&&(b="WARN"),k.setLevel(k.levels[b])}var k={},l=function(){},m=["trace","debug","info","warn","error"],n=/loglevel=([^;]+)/;return k.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},k.setLevel=function(d){if("number"==typeof d&&d>=0&&d<=k.levels.SILENT){if(i(d),d===k.levels.SILENT)return void f(function(){return l});if(typeof console===b)return f(function(a){return function(){typeof console!==b&&(k.setLevel(d),k[a].apply(k,arguments))}}),"No console available for logging";f(function(a){return d<=k.levels[a.toUpperCase()]?c(a):l})}else{if("string"!=typeof d||k.levels[d.toUpperCase()]===a)throw"log.setLevel() called with invalid level: "+d;k.setLevel(k.levels[d.toUpperCase()])}},k.enableAll=function(){k.setLevel(k.levels.TRACE)},k.disableAll=function(){k.setLevel(k.levels.SILENT)},j(),k})}(),function(){var a;moment.lang("ru"),angular.module("4treeApp",["ngCookies","ngResource","app.directives","ngRoute","pasvaz.bindonce","pascalprecht.translate","sun.scrollable","ui.scroll","angular-redactor","ui-rangeSlider","$strap","$strap.directives","ngSanitize","ngBootstrap","ngTagsInput","sly","ngClipboard","ngSocket","drahak.hotkeys","route-segment","view-segment","ngRoute"]),angular.module("4treeApp").config(["$translateProvider","$locationProvider","$routeProvider","$routeSegmentProvider",function(a,b,c,d){var e,f;return d.options.autoLoadTemplates=!0,d.when("/home","home").when("/login","login").segment("home",{templateUrl:"views/main.html",controller:"MainCtrl"}).segment("login",{templateUrl:"views/main/login.html",controller:"MainCtrl"}),c.otherwise({redirectTo:"/home"}),a.translations("en",{TREE:"Tree",CALENDAR:"Calendar",EDITOR:"Editor",PLANOFDAY:"Plan of the day",ADD:"Add task...",TASKS:"Tasks",POMIDOR:"Timer Pomodorro",ENCRYPT:{JSON_ERROR:"Error in JSON parse of encrypted data",PASS_ERROR:"Wrong password"},POMIDORS_TITLE:{0:"Click and work for 25 minutes",1:"Work for 25 minutes",2:"Ok. Take a rest for 5 minutes",3:"Work for 25 minutes",4:"Ok. Take a rest for 5 minutes",5:"Work for 25 minutes",6:"Ok. Take a rest for 5 minutes",7:"Work for 25 minutes",8:"Good. Take a rest for 15 minutes"},MONTH:{1:"jan",2:"feb",3:"mar",4:"apr",5:"may",6:"jun",7:"jul",8:"aug",9:"sept",10:"oct",11:"nov",12:"dec"},WEEKDAY:{0:"sun",1:"mon",2:"tue",3:"wed",4:"thu",5:"fri",6:"sat",7:"sun"}}),a.translations("ru",{TREE:"Дерево",CALENDAR:"Календарь",EDITOR:"Редактор",PLANOFDAY:"План на день",POMIDOR:"Таймер Pomodorro",ADD:"Добавить...",TASKS:"Дела",ENCRYPT:{JSON_ERROR:"Ошибка расшифровки, так как данные не в формате JSON",PASS_ERROR:"Неверный пароль"},POMIDORS_TITLE:{0:"Нажмите, и работайте 25 минут",1:"Работайте не отвлекаясь 25 минут",2:"Отлично. Отдохните 5 минут",3:"Работайте не отвлекаясь 25 минут",4:"Супер. Отдохните 5 минут",5:"Работайте не отвлекаясь 25 минут",6:"Так держать. Отдохните 5 минут",7:"Работайте не отвлекаясь 25 минут",8:"Вы заслужили отдых 15 минут"},MONTH:{1:"янв.",2:"февр.",3:"марта",4:"апр.",5:"мая",6:"июня",7:"июля",8:"авг.",9:"сент.",10:"окт.",11:"нояб.",12:"дек."},MONTH_FULL:{1:"Январь",2:"Февраль",3:"Март",4:"Апрель",5:"Май",6:"Июнь",7:"Июль",8:"Август",9:"Сентябрь",10:"Октябрь",11:"Ноябрь",12:"Декабрь"},WEEKDAY:{0:"вс",1:"пн",2:"вт",3:"ср",4:"чт",5:"пт",6:"сб",7:"вс"}}),f=window.navigator.userLanguage||window.navigator.language,e="en",(-1!==f.indexOf("ru")||-1!==f.indexOf("ukr"))&&(e="ru"),a.preferredLanguage(e)}]),angular.module("4treeApp").directive("clickAnywhereButHere",["$document",function(a){var b;return{link:b=function(b,c,d){var e;e=function(a){var e,f,g;e=c.has(a.target).length>0,g=c[0]===a.target,f=e||g,f||b.$apply(d.clickAnywhereButHere)},b.$watch(d.isActive,function(b,c){b!==c&&b===!0?a.bind("click",e):b!==c&&b===!1&&a.unbind("click",e)})}}}]),a=function(a,b,c){return _.reduce(a,function(d,e,f){return d[f]=b.call(c,e,f,a),d},{},c)},_.recursive={all:function(a,b,c){var d;return d=function(a,b,e,f,g){var h;if(h=[],g>c)throw new Error("Depth of object being parsed exceeds maxDepth ().  Maybe it links to itself?");return null!==b&&e&&(h=e.slice(0),h.push(b)),_.isObject(a)?_.all(a,function(a,b){return d(a,b,h,f,g+1)}):f(a,h)},_.isObject(a)?(c=c||50,d(a,null,[],b,0)):!0},extend:function(b,c){return _.extend(b,a(c,function(a,c){var d;return d=b[c],_.isArray(a)||!_.isObject(a)||_.isArray(d)||!_.isObject(d)?a||d:_.recursive.extend(d,a)}))},defaults:function(b,c){return _.extend(b,a(c,function(a,c){var d;return d=b[c],_.isArray(a)||!_.isObject(a)||_.isArray(d)||!_.isObject(d)?d||a:_.recursive.extend(d,a)}))}}}.call(this),function(){angular.module("4treeApp").service("calendarBox",["$translate","db_tree","$rootScope",function(a,b,c){var d,e;return{_calendar_container:function(){for(e=[],d=1;5e3>=d;d++)e.push(d);return e}.apply(this),datasource:function(){var a,b;return function(){for(b=[],a=1;5e3>=a;a++)b.push(a);return b}.apply(this)},constructor:function(a){return this.$timeout=a,this.color="grey"},getDate:function(){return 1},jsDateDiff:function(a,b){var c,d,e,f,g,h,i,j;return c={text:"","class":"nodate",image:""},a?"0000-00-00 00:00:00"===a?c:(a=new Date(a),c["class"]="",h=new Date,b&&(h.setHours(0),h.setMinutes(0),h.setSeconds(0),a=new Date(a),a.setHours(0),a.setMinutes(0),a.setSeconds(0)),e=a.getTime()-h,e>0&&(e+=1e3),0>e&&(e-=1e3),d=parseInt(e/864e5,10),g=parseInt(e/6e4,10),b&&0===d&&(g=0),0===d?(g>59||-59>g?(f=parseInt(e/36e5*10,10)/10,c.text=(g>0?"+":"")+f+" ч."):c.text=(g>0?"+":"")+g+" м.",b&&(c.text="сегодня")):c.text=(d>0?"+":"")+d+" дн.",0===d?(0>g&&(c["class"]="datetoday past",i=-g/480*100,i>80&&(i=80),j="#d7d7d7",a.did||(c.image="background-image: -webkit-gradient(linear, left top, right top, color-stop("+(i-25)+"%, "+j+"), color-stop("+(i+25)+"%, rgba(0,0,0,0)));")),g>=0&&(c["class"]="datetoday")):0>g&&(c["class"]="datepast"),c):c},getDates:function(a){return this.getDate(a.today)},getDateBox:_.memoize(function(b){var c,d,e,f,g,h,i,j,k;return this.current_month||(this.current_month=(new Date).getMonth()),e=b.getDate().toString(),h=b.getMonth(),k=b.getFullYear().toString().substr(2,4),f=b,j=a("WEEKDAY."+b.getDay()),g=a("MONTH."+(h+1)),i="week_"+b.getDay(),b<new Date&&(i+=" past"),b.toString()===(new Date).toString()&&(i+=" today"),this.current_month%2&&(c=1),d={day:e,month:g,year:k,week_day:j,myclass:i,fulldate:f}}),getDays:_.memoize(function(a,b){return this.jsDateDiff(a,b)},function(a,b){return a+b}),getCalendarForIndex:function(a){var d,e,f;return a+=c.$$childHead.set.from_today_index,d=new Date((new Date).getTime()+24*(a-3)*60*60*1e3),e=this.getDateBox(d),f=moment(e.fulldate).format("YYYY-MM-DD"),e.tasks=b.getView("tasks","tasks_by_date").result[f],_.each(e.tasks,function(a){var b;return b=moment(a.date2).format("HH:MM"),a._time=b}),e.tasks=_.sortBy(e.tasks,function(a){return a._time}),e},getToDoForIndex:function(a){var c,d,e;return c=new Date(a),d={},e=moment(c).format("YYYY-MM-DD"),d.tasks=b.getView("tasks","tasks_by_date").result[e],_.each(d.tasks,function(a){var b;return b=moment(a.date2).format("HH:MM"),a._time=b}),d.tasks=_.sortBy(d.tasks,function(a){return a._time}),d},getDateOfWeek:function(a,b){var c;return c=1+7*(a-1),new Date(b,0,c)},getDateOfISOWeek:function(a,b){var c,d,e;return e=new Date(b,0,1+7*(a-1)),d=e.getDay(),c=e,c.setDate(4>=d?e.getDate()-e.getDay()+1:e.getDate()+8-e.getDay()),c},getWeek:function(a){var b;return b=new Date(a.getFullYear(),0,1),Math.ceil(((a-b)/864e5+b.getDay()+1)/7)},getWeekByMonth:function(a){var b,c;return b=new Date,c=this.getWeek(b),b.setMonth(a-1),this.getWeek(b)-c-4},getWeekByYear:function(a){var b,c;return b=new Date,c=this.getWeek(b),b.setYear(a),this.getWeek(b)-c-4},getWeekCalendarForIndex:_.memoize(function(b){var c,d,e,f,g,h,i;return f=this,h=new Date,e=new Date(h.getFullYear(),h.getMonth(),0),g=f.getWeek(new Date(e)),i=[{},{},{},{},{},{}],c=[6,0,1,2,3,4,5],d=f.getDateOfISOWeek(b+g-2,h.getFullYear()),_.each([1,2,3,4,5,6,7],function(){var b,e,g,j;g=f.getToDoForIndex(d),e=(d.getMonth()+(h.getMonth()%2?1:0))%2?"odd":"even",moment(d).format("YYYY-MM-DD")===moment(h).format("YYYY-MM-DD")&&(e+=" today"),j=c[d.getDay()],e+=j>=5?" weekend":"",b=d.getDate(),1===d.getDate()&&(b+=" "+a("MONTH."+(d.getMonth()+1))),i[j]={date:b,tasks:g,myclass:e},d=new Date(d.getTime()+864e5)}),i})}}]),angular.module("4treeApp").controller("WeekCalendarController",["$scope","calendarBox","db_tree","$translate",function(a,b,c,d){return a.$on("position.first",function(c,e,f,g){var h,i;return h=b.getDateOfISOWeek(f+g-4,(new Date).getFullYear()),i=h.getMonth()+1,a.this_month=d("MONTH_FULL."+i),a.this_year=h.getFullYear(),a.isWeek=!0,a.monthes=[{title:"Январь!","goto":b.getWeekByMonth(1)},{title:"Февраль","goto":b.getWeekByMonth(2)},{title:"Март","goto":b.getWeekByMonth(3)},{title:"Апрель","goto":b.getWeekByMonth(4)},{title:"Май","goto":b.getWeekByMonth(5)},{title:"Июнь","goto":b.getWeekByMonth(6)},{title:"Июль","goto":b.getWeekByMonth(7)},{title:"Август","goto":b.getWeekByMonth(8)},{title:"Сентябрь","goto":b.getWeekByMonth(9)},{title:"Октябрь","goto":b.getWeekByMonth(10)},{title:"Ноябрь","goto":b.getWeekByMonth(11)},{title:"Декабрь","goto":b.getWeekByMonth(12)}],a.goTo=function(b){return a.$$childHead.$emit("goto_index",b+1)}})}]),angular.module("4treeApp").controller("bigCalendarController",["$scope","calendarBox","db_tree","$translate",function(a,b,c,d){return a.$on("position.first",function(b,c,e,f){var g,h;return g=new Date((new Date).getTime()+24*(c+f+1)*60*60*1e3),h=g.getMonth()+1,a.this_month=d("MONTH_FULL."+h),a.this_year=g.getFullYear(),a.monthes=[{title:"Январь","goto":0},{title:"Февраль","goto":0},{title:"Март","goto":0},{title:"Апрель","goto":0},{title:"Май","goto":0},{title:"Июнь","goto":0},{title:"Июль","goto":0},{title:"Август","goto":0},{title:"Сентябрь","goto":0},{title:"Октябрь","goto":0},{title:"Ноябрь","goto":0},{title:"Декабрь","goto":0}],a.goTo=function(b){return a.$$childHead.$emit("goto_index",b-8)}})}])}.call(this),function(){angular.module("4treeApp").service("oAuth2Api",["$q","$http","$rootScope","settingsApi",function(a,b,c,d){return{jsCheckTokenExpired:function(a){var b;return b=a,b.expire_time?new Date(b.expire_time)<=new Date?(__log.warn("token is expired"),b):!1:(__log.warn("token none"),!1)},jsGetToken:function(){var b,c,e,f,g,h;return b=a.defer(),c=this,f=function(a){return a.expire_time=new Date((new Date).getTime()+1e3*a.expires_in),d.set.oAuth2=a,b.resolve(a.access_token)},e=d.set.oAuth2,!e||e&&(h=this.jsCheckTokenExpired(e))?h?(__log.info("Получаю token из хранилища ",h),this.jsGetRemoteTokenByRefreshToken(h.refresh_token).then(f)):(__log.info("Получаю token из пароля",h),this.jsGetRemoteTokenByPassword().then(f)):(g=e,b.resolve(g.access_token)),b.promise},jsGetRemoteTokenByRefreshToken:function(c){var e;return e=a.defer(),__log.warn("REFRESH TOKEN = ",c),console.info("start"),b({url:d.set.server+"/api/v2/oauth/token",method:"POST",isArray:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},params:{},data:$.param({grant_type:"refresh_token",client_id:d.set.user_info.client_id,client_secret:d.set.user_info.client_secret,refresh_token:c})}).then(function(a){return console.info({result:a}),e.resolve(a.data)}),e.promise},jsGetRemoteTokenByPassword:function(){var c,e;return c=a.defer(),e=b({url:d.set.server+"/api/v2/oauth/token",method:"POST",isArray:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},params:{},data:$.param({grant_type:"password",client_id:d.set.user_info.client_id,client_secret:d.set.user_info.client_secret,username:d.set.user_info.username,password:d.set.user_info.password})}).error(function(a,b){return 400===b?document.location.hash="#/login/":void 0}).then(function(a){return c.resolve(a.data)}),c.promise}}}])}.call(this),function(){angular.module("4treeApp").factory("datasourceTree",["$timeout","db_tree","$rootScope",function(a,b){return{watchList:[],get:function(a,c,d){var e,f,g,h;for(__log.info(a),a>b._db.tree.length&&d([]),f=[],e=g=a,h=a+c-1;h>=a?h>=g:g>=h;e=h>=a?++g:--g)b._db.tree[e]&&f.push(b._db.tree[e]);return d(f)}}}]),angular.module("4treeApp").factory("datasource",["$timeout","$rootScope",function(a,b){return{get:function(a,b,c){var d,e,f,g;for(e=[],d=f=a,g=a+b-1;g>=a?g>=f:f>=g;d=g>=a?++f:--f)e.push("{i}");return c(e)},scope2:b}}]),angular.module("4treeApp").service("db_tree",["$translate","$http","$q","$rootScope","oAuth2Api","$timeout","$socket","$location","settingsApi",function(a,b,c,d,e,f,g,h,i){return{_db:{texts:{}},_tmp:{_diffs:{}},_cache:{},salt:function(){return"Salt is a mineral substance composed"},pepper:function(){return" primarily of sodium chloride (NaCl)"},constructor:function(){var a;return a=this,d.$on("jsFindAndSaveDiff",function(b,c,d){return d&&d._id?a.saveDiff(c,d._id):void 0}),d.$on("my-sorted",function(b,c){return f(function(){var b,e,g;return __log.info("SORTED",c),b=a.jsFind(c.from_id),g=_.clone(b),b.parent_id=c.to_id,e=b,d.$emit("jsFindAndSaveDiff","tree",e,g),a.refreshParentsIndex(),f(function(){return $("ul > .tree_tmpl").remove()})})}),d.$on("my-created",function(a,b){return __log.info("CREATED",b)}),this.loadTasks(),this._cache||(this._cache={}),this._db.tree?void 0:(this._db.tree={},this.refreshParentsIndex())},clearCache:function(){return _.each(this,function(a){return a?a.cache={}:void 0}),_.each(d.$$childTail.fn.service.calendarBox,function(a){return a?a.cache={}:void 0})},getTreeFromeWebOrLocal:function(){var a,b;return b=this,this.dbInit(),a=$.Deferred(),this.ydnLoadFromLocalStorage(b).then(function(c){return c.tree&&0!==Object.keys(c.tree).length?(__log.info("ALL DATA FROM LOCAL"),a.resolve(c)):(__log.info("NEED DATA FROM NET"),b.getTreeFromWeb().then(function(d){var e;return e={},async.each(Object.keys(d),function(a,f){return c=d[a],e[a]=c,b.ydnSaveToLocal(a,c).then(function(){return f()})},function(){return a.resolve(e)})}))}),a.promise()},setMainTimeout:null,setMain:function(a){var b;return d.$$childTail.db.main_node[i.tmp.focus]=a,this.setTab(a),(null!=a?a._id:void 0)&&(b=""+a._id.substr(a._id.length-5,a._id.length)),this.setMainTimeout&&f.cancel(this.setMainTimeout),this.setMainTimeout=f(function(){return h.hash(b)},5e3)},setTab:function(a){var b;return b=_.find(i.set.tabs,function(b){return a._id===b.tab_id}),b?void 0:i.set.tabs.push({tab_id:a._id,tm:new Date})},getTreeFromNet:function(){var a,b;return b=this,a=c.defer(),console.time("ALL DATA LOADED"),this.getTreeFromeWebOrLocal().then(function(c){var e;return _.each(c,function(a,c){var d;return d=-1===b.dont_store_to_memory.indexOf(c),d?b._db[c]=a:void 0}),b.refreshParentsIndex(),i.tmp.tree_loaded=new Date,d.$$childTail.db.main_node=[],d.$broadcast("tree_loaded"),d.$$childTail.db.main_node[i.tmp.focus]||(e=_.find(b._db.tree,function(a){return"_НОВОЕ"===a.title}),b.setMain(e)),b.clearCache(),console.timeEnd("ALL DATA LOADED!"),a.resolve()}),a.promise},getTreeFromWeb:function(){var a,d;return a=c.defer(),d=this,e.jsGetToken().then(function(c){return b({url:i.set.server+"/api/v2/tree",method:"GET",params:{user_id:"5330ff92898a2b63c2f7095f",access_token:c,machine:i.set.machine}}).then(function(b){return a.resolve(b.data)})}),a.promise},db:void 0,jsSaveElementToLocal:function(a,b){var c;return c=$.Deferred(),b&&b.$$hashKey&&delete b.$$hashKey,this.db.put(a,b).done(function(){return c.resolve()}),c.promise()},store_schema:[{name:"tree",keyPath:"_id",autoIncrement:!1},{name:"tasks",keyPath:"_id",autoIncrement:!1},{name:"texts",keyPath:"_id",autoIncrement:!1},{name:"_diffs",keyPath:"_id",autoIncrement:!1}],dont_store_to_memory:["texts"],dbInit:function(){var a,b;b={stores:this.store_schema},a={},this.db=new ydn.db.Storage("_db.tree",b,a)},ydnSaveToLocal:function(a,b){var c,d;return c=$.Deferred(),this.dbInit(),d=this,d._tmp._diffs={},this.db.clear("_diffs").done(function(){return d.db.clear(a).done(function(){return async.eachLimit(Object.keys(b),200,function(c,e){var f;return f=b[c],f.$$hashKey&&delete f.$$hashKey,d.jsSaveElementToLocal(a,f).then(function(){return e()})},function(){return c.resolve()})})}),c.promise()},ydnLoadFromLocalStorage:function(a){var b,c;return this.dbInit(),b=$.Deferred(),__log.show_time_long&&console.time("load_local"),c={},a.db.values("_diffs",null,999999999).done(function(d){return _.each(d,function(b){return a._tmp._diffs[b._id]=b}),async.each(a.store_schema,function(b,e){var f;return f=b.name,-1===a.dont_store_to_memory.indexOf(f)?a.db.values(f,null,999999999).done(function(b){var g;return d&&_.each(d,function(c){var d;return d=_.find(b,function(a){return a._id===c._id}),d&&f===c.db_name?d=a.diff.patch(d,c.patch):void 0}),g={},_.each(b,function(a){return(null!=a?a._id:void 0)?g[a._id]=a:void 0}),c[f]=g,e()}):e()},function(){return __log.show_time_long&&console.timeEnd("load_local"),b.resolve(c),c=void 0})}),b.promise()},refreshParentsIndex:function(a){var b,c,d,e,f,g;b=i.tmp.focus,g=this,a?g.db_parents["n"+a]=[]:g.db_parents={},c=_.find(this._db.tree,function(a){return"main"===a.folder}),c&&(0===i.set.main_parent_id.length&&(i.set.main_parent_id[0]=c._id,i.set.main_parent_id[1]=c._id,i.set.main_parent_id[2]=c._id,i.set.main_parent_id[3]=c._id),i.set.top_parent_id=c._id),_.each(this._db.tree,function(b){var c,d;return a&&b.parent_id!==a?!0:(c=[{title:"шагов",cnt_today:20,days:[{d:"2013-03-01",cnt:12},{d:"2013-03-02",cnt:10},{d:"2013-03-03",cnt:8},{d:"2013-03-05",cnt:15},{d:"2013-03-12",cnt:21}]},{title:"прошёл км.",cnt_today:30,days:[{d:"2013-03-01",cnt:12},{d:"2013-03-02",cnt:10},{d:"2013-03-03",cnt:8},{d:"2013-03-05",cnt:15},{d:"2013-03-12",cnt:21}]},{title:"отжиманий",cnt_today:19,days:[{d:"2013-03-01",cnt:12},{d:"2013-03-02",cnt:10},{d:"2013-03-03",cnt:8},{d:"2013-03-05",cnt:15},{d:"2013-03-12",cnt:21}]}],b._id&&1!==b._id&&(b._path=g.jsGetPath(b._id)),b.importance=b.importance?b.importance:50,b.tags=b.tags?b.tags:[],b.counters||(b.counters=c),b._panel||(b._panel=[{_open:!1},{_open:!1},{_open:!1},{_open:!1}]),d="n"+b.parent_id,g.db_parents[d]||(g.db_parents[d]=[]),g.db_parents[d].push(b),!0)}),_.each(g._db.tree,function(a){var b;return b="n"+a._id,g.db_parents[b]?a._childs=g.db_parents[b].length:(a._childs=0,a._open=!1),!0}),g.clearCache(),d=function(a,b){return a.text&&-1!==a.text.indexOf("жопа")?b(a.date,a.title,a):void 0},e=function(a,b){return((null!=a?a.date2:void 0)||(null!=a?a.date1:void 0))&&(null!=a?a.date_on:void 0)&&!(null!=a?a.hide_in_todo:void 0)?b(a.date1,a,a):void 0},f=function(a,b){var c,d,e,f,g,h;if(g=b.key,g=moment(b.key),g=g.format("YYYY-MM-DD"),d=new Date(b.value.date1).getTime(),e=new Date(b.value.date2).getTime(),f=(e-d)/864e5,f>0){for(h=[];f-->0;)c=d+24*f*60*60*1e3,g=moment(new Date(c)),g=g.format("YYYY-MM-DD"),a[g]||(a[g]=[]),h.push(b.value?a[g].push(b.value):void 0);return h}},this.newView("tasks","tasks_by_date",e,f),e=function(a,b){return(null!=a?a.tree_id:void 0)?b(a.tree_id,a,a):void 0},f=function(a,b){var c,d;return c=b.key,a[c]||(a[c]={tasks:[],next_action:[],cnt:0}),b.value&&a[c].tasks.push(b.value),a[c].tasks&&(a[c].cnt=a[c].tasks.length),a[c].cnt>0&&(d=g.sortTasks(a[c].tasks)),a[c].tasks=d,a[c].next_action=g.getNextAction(d)},g.newView("tasks","tasks_by_tree_id",e,f)},getTree:function(){return this._db.tree},jsFindByParent:_.memoize(function(a){var b;return b=_.sortBy(this.db_parents["n"+a],function(a){return a.pos}),b=_.filter(b,function(a){return 1!==a.del})},function(a){return a+" "+i.tmp.tree_loaded}),web_tags:[{id:1,parent:0,title:"Кулинария",cnt:1},{id:5,parent:1,title:"Супы",cnt:6},{id:7,parent:5,title:"Диетические",cnt:1},{id:8,parent:5,title:"Фруктовые",cnt:3},{id:6,parent:1,title:"Каши",cnt:3},{id:2,parent:0,title:"Рукоделие",cnt:1},{id:9,parent:2,title:"Холодный фарфор",cnt:2},{id:10,parent:2,title:"Тильда",cnt:0},{id:10,parent:2,title:"Скрапбукинг",cnt:1},{id:10,parent:2,title:"Канзаши",cnt:3},{id:10,parent:2,title:"Бисероплетение",cnt:211},{id:10,parent:2,title:"Вязание",cnt:1},{id:3,parent:0,title:"Мои новости",cnt:8},{id:4,parent:0,title:"Я в лицах",cnt:11}],tree_tags:[{id:1,parent:0,title:"GTD",cnt:0},{id:4,parent:1,title:"Входящие",cnt:12},{id:2,parent:1,title:"Следующие действия",cnt:4},{id:3,parent:1,title:"Когда-нибудь",cnt:24},{id:5,parent:1,title:"Календарь",cnt:120},{id:6,parent:1,title:"Ожидание",cnt:8},{id:7,parent:1,title:"Проект",cnt:3},{id:8,parent:0,title:"Рабочие дела",cnt:4},{id:9,parent:0,title:"Домашние дела",cnt:8},{id:10,parent:0,title:"Мой сайт",cnt:18},{id:11,parent:0,title:"Чтение",cnt:0},{id:12,parent:11,title:"Почитать",cnt:2},{id:13,parent:11,title:"Прочитано",cnt:243}],jsFindByParentWeb:function(a){return _.filter(this.web_tags,function(b){return b.parent_id===a
})},jsFindByParentTags:function(a){return _.filter(this.tree_tags,function(b){return b.parent_id===a})},first_element:{title:"4tree",parent_id:"0",_path:["2"]},jsFind:function(a){var b,c,d;return 1===a?this.first_element:((null!=(c=this._db)&&null!=(d=c.tree)?d[a]:void 0)&&(b=this._db.tree[a]),void 0===a?void 0:b)},jsGetPath:_.memoize(function(a){var b,c,d;if(1===a||0===a)return["100"];for(c=[],d=1e3;(b=this.jsFind(a))&&d--;)a=b.parent_id,b.parent_id&&c.push(b._id);return c.push(i.set.top_parent_id),c.reverse()}),jsView:function(){return this._cache},newView:function(a,b,c,d){var e;return e=this,e._cache[a]||(e._cache[a]={}),e._cache[a].views||(e._cache[a].views={}),e._cache[a].views[b]?void 0:e._cache[a].views[b]={rows:[],invalid:[],map:c,reduce:d}},getView:function(a,b){var c;return c=this._cache[a].views[b],c&&c.rows?c.rows.length&&0===c.invalid.length?c:c.invalid.length>0&&c.rows.length>0?(this.generateView(a,b,c.invalid),c):(this.generateView(a,b),c):void console.info("NOT FOUND VIEW",a,b)},generateView:function(a,b,c){var d,e,f,g;return g=this._cache[a].views[b],0===(null!=c?c[0]:void 0)&&(c=!1),c?(f=[_.find(this._db[a],function(a){return-1!==c.indexOf(a._id)})],g.rows=_.filter(g.rows,function(a){return-1===c.indexOf(a._id)})):f=this._db[a],e={},d=function(a,b,d){return g.rows||(g.rows=[]),g.rows.push({_id:d._id,key:a,value:b}),!c&&g.reduce?g.reduce(e,{key:a,value:b}):void 0},_.each(f,function(a){var b;return b=g.map(a,d)}),c&&g.reduce&&_.each(g.rows,function(a){return g.reduce(e,{key:a.key,value:a.value})}),g.rows=_.sortBy(g.rows,function(a){return a.key}),g.invalid=[],g.result=e},refreshView:function(a,b){var c;return c=this,_.each(b,function(b){var d;return _.each(null!=(d=c._cache[a])?d.views:void 0,function(a){return a.invalid.push(b)})}),this.clearCache()},loadTasks:function(){return!0},clearCache2:function(){return _.each(this,function(a){return a&&a.cache?a.cache={}:void 0})},getTasks:function(){return this._db.tasks},calcWeight:function(a){var b,c,d,e,f,g,h,j,k;return b=this,c=function(a){return Math.round(parseInt(100*a))/100},f=i.set.weight.date,g=i.set.weight.importance,d={},d.tree_id=null!=(h=b._db)&&null!=(j=h.tree)&&null!=(k=j[a.tree_id])?k.importance:void 0,d.did=0,d.created=(new Date(a.created).getTime()-i.set.today_date_time)/864e6,a.did&&(d.did=-5e4),a.date2?d.date1=(new Date(a.date2).getTime()-i.set.today_date_time)/864e5:(d.date1=-500,d.importance=(a.importance?a.importance:50)*g),e=_.reduce(d,function(a,b){return a+b}),{weights:d,weight:e}},pad:function(a,b){return a=a.toString(),a.length<b?pad("0"+a,b):a},sortTasks:function(a,b){var c;return null==b&&(b="by_priority_and_date"),c=this,"by_priority_and_date"===b&&(a=_.sortBy(a,function(a){var b;return b=c.calcWeight(a),-b.weight})),a},getNextAction:function(a){var b,c,d,e,f,g;return f=new Date,b=[],c=[],d=[],_.each(a,function(a){var e,g,h;return!a.did&&(c.length||a.date1||(c=[a]),b.length||(b=[a]),e=new Date(a.date1),g=new Date(null!=b&&null!=(h=b[0])?h.date1:void 0),a.date1&&g>e&&f>=e&&(b=[a]),a.date1&&g>e&&e>f)?d=[a]:void 0}),e=new Date(null!=b&&null!=(g=b[0])?g.date1:void 0),(!b.length||b.length&&e>f)&&c.length&&(b=c),b},jsExpand:function(a,b){var c;return __log.show_time_long&&console.time("expand"),c=i.tmp.focus,_.each(this._db.tree,function(d){d._path&&-1!==d._path.indexOf(a)&&(b===!0&&d._childs>50?d._open=void 0:d._childs>0&&(d._panel[c]._open=b))}),__log.show_time_long?console.timeEnd("expand"):void 0},tree_template:function(){return{title:"",parent_id:"",_id:""}},task_template:function(){return{title:"",parent_id:"",_id:""}},getIcon:function(a){return a.icon?a.icon:"icon-heart-empty"},diffForSort:function(a){var b,c,d;return c=this.db_parents["n"+a.parent_id],c=_.sortBy(c,function(a){return a.pos}),b=_.find(c,function(b){return b.pos>a.pos}),b&&b.pos?(__log.info("POS = ",b.pos,a.pos),d=parseInt(1e12*(b.pos-a.pos)/1.1)/1e12):1},jsAddNote:function(a,b){var c,d;return c=i.tmp.focus,__log.info("AddNote",a),d=new this.tree_template,d.title=i.set.new_title,d._id=(new ObjectId).toString(),d._new=!0,d._focus_me=!0,d.user_id=i.set.user_id,d.pos=a.pos+this.diffForSort(a),this._db.tree[d._id]=d,b?(d.parent_id=a._id,this.refreshParentsIndex(),a._open=!0):(d.parent_id=a.parent_id,this.refreshParentsIndex(a.parent_id)),this.main_node(d),this.clearCache()},jsAddTask:function(a,b,c){var e,f,g,h,j;return a.stopPropagation(),a.preventDefault(),e=d.$$childTail.fn.service.db_tree,__log.info("add_task",a,b,c),j=b.db.main_node[b.tmp.focus_edit]._id,j?(f=new e.task_template,f._id=(new ObjectId).toString(),f.tree_id=j,f.parent_id=j,f._new=!0,f.created=new Date,f.importance=50,f.user_id=i.set.user_id,h=_.clone(f),f.title=b.new_task_title,e._db.tasks[f._id]||(e._db.tasks[f._id]=f),__log.info("pushed new task",f),b.new_task_title="",e.clearCache(),g=f,d.$emit("jsFindAndSaveDiff","tasks",g,h)):void 0},jsEnterPress:function(a){return a.target.blur()},jsBlur:function(a,b,c){},jsFindPreviusParent:function(a){var b,c;return c=d.$$childTail.fn.service.db_tree.db_parents["n"+a.parent_id],c=_.sortBy(c,function(a){return a.pos}),b=_.filter(c,function(b){return b.pos<a.pos}),b=b[b.length-1]},jsEscPress:function(a,b){var c,e;return c=i.tmp.focus,e=d.$$childTail.fn.service.db_tree.jsFindPreviusParent(b.tree),b.tree._new&&(b.tree.del=1),e&&this.setMain(e),a.target.blur()},findMaxPos:function(a){var b;return b=d.$$childTail.fn.service.db_tree.db_parents["n"+a],b=_.sortBy(b,function(a){return a.pos}),b.length?b[b.length-1].pos+1:1},jsTabPress:function(a){var b,c,e,f,g,h;if(c=i.tmp.focus,b=d.$$childTail.fn.service.db_tree,b.jsIsTree())if(a.stopPropagation(),a.preventDefault(),e=d.$$childTail.db.main_node[c],__log.info(e),h=a.shiftKey){if(f=b.jsFind(e.parent_id),__log.info({parent_note:f}),f&&"main"!==f.folder)return e.parent_id=f.parent_id,e.pos=f.pos+b.diffForSort(f),e._focus_me=!0,b.refreshParentsIndex()}else if(g=b.jsFindPreviusParent(e))return g._panel[c]._open=!0,e.parent_id=g._id,e.pos=b.findMaxPos(g._id),e._focus_me=!0,b.refreshParentsIndex()},jsFindNext:function(a,b){var c,e,f,g,h,j;return e=i.tmp.focus,c=d.$$childTail.fn.service.db_tree,a&&a._panel[e]._open&&!b?(c.db_parents["n"+a._id]&&(f=c.db_parents["n"+a._id][0]),f):(j=c.db_parents["n"+a.parent_id],j=_.sortBy(j,function(a){return a.pos}),g=0,f=_.find(j,function(b,c){return b._id===a._id&&(g=c),b._id===a._id}),f=j[g+1],f||(__log.info("need_to_parent"),h=c.jsFind(a.parent_id),h&&(f=c.jsFindNext(h,"ignore_open"))),f)},jsFindPrev:function(a,b,c){var e,f,g,h,j;return f=i.tmp.focus,e=d.$$childTail.fn.service.db_tree,a&&a._open2&&!b||c?(j=e.db_parents["n"+a._id],g=j[j.length-1],c&&g._open?e.jsFindPrev(g,"true","last_and_deep"):g):(j=e.db_parents["n"+a.parent_id],j=_.sortBy(j,function(a){return a.pos}),h=0,g=_.find(j,function(b,c){return b._id===a._id&&(h=c),b._id===a._id}),g=j[h-1],g&&g._panel[f]._open&&(g=e.jsFindPrev(e.jsFind(g._id),"ignore_open","last_and_deep")),g||b||c||a.parent_id!==i.set.main_parent_id[f]&&(g=e.jsFind(a.parent_id)),g)},jsIsTree:function(){var a,b;return a=i.tmp.focus,b=i.set._panel[a].active,-1!==[0].indexOf(b)?!0:!1},jsUpPress:function(a){var b,c,e;return c=i.tmp.focus,b=d.$$childTail.fn.service.db_tree,b.jsIsTree()&&(a.stopPropagation(),a.preventDefault(),e=b.jsFindPrev(d.$$childTail.db.main_node[c]))?this.setMain(e):void 0},jsDownPress:function(a){var b,c,e;return c=i.tmp.focus,b=d.$$childTail.fn.service.db_tree,b.jsIsTree()&&(a.stopPropagation(),a.preventDefault(),e=b.jsFindNext(d.$$childTail.db.main_node[c]))?this.setMain(e):void 0},jsLeftPress:function(a){var b,c;return c=i.tmp.focus,b=d.$$childTail.fn.service.db_tree,b.jsIsTree()?(a.stopPropagation(),a.preventDefault(),d.$$childTail.db.main_node[c]._panel[c]._open?d.$$childTail.db.main_node[c]._panel[c]._open=!1:!0):void 0},jsRightPress:function(a){var b,c;return c=i.tmp.focus,b=d.$$childTail.fn.service.db_tree,b.jsIsTree()?(a.stopPropagation(),a.preventDefault(),d.$$childTail.db.main_node[c]._panel[c]._open?!0:d.$$childTail.db.main_node[c]._panel[c]._open=!0):void 0},jsFocus1:function(){return i.tmp.focus=0},jsFocus2:function(){return i.tmp.focus=1},jsFocus3:function(){return i.tmp.focus=2},jsFocus4:function(){return i.tmp.focus=3},searchString:function(a,c){var d;return d=new $.Deferred,__log.info("search",a),e.jsGetToken().then(function(e){return b({url:i.set.server+"/api/v1/search",method:"GET",params:{user_id:"5330ff92898a2b63c2f7095f",access_token:e,search:a,machine:i.set.machine,dont_need_highlight:c}}).then(function(a){return d.resolve(a.data)})}),d.promise()},jsTreeToDiary:function(a){return a.diary=new Date},diaryFind:_.memoize(function(a){var b,c,d,e,f;return f=this,d=function(a,b){return(null!=a?a.diary:void 0)?b(a.diary,a,a):void 0},e=function(a,b){var c;return c=b.key,c=moment(b.key),c=c.format("YYYY-MM-DD"),a[c]||(a[c]=[]),b.value?a[c].push(b.value):void 0},this.newView("tree","diary_by_date",d,e),c=moment(a).format("YYYY-MM-DD"),b=f.getView("tree","diary_by_date").result[c],b&&__log.info(b,a,b.text),b}),diff:jsondiffpatch.create({objectHash:function(a){return a.name||a.id||a._id||a._id||JSON.stringify(a)},textDiff:{minLength:3}}),dfdTextLater:c.defer(),getTextLater:_.throttle(function(a){var b;return b=this,f(function(){return b.getText(a).then(function(a){return a?b.dfdTextLater.resolve(a):(__log.info("text_not_found"),b.dfdTextLater.resolve())})},1e3),b.dfdTextLater.promise},3e3),getTextFromDB:function(a){var b,d,e;d=this,b=c.defer(),e=d._tmp._diffs[a],d.db.get("texts",a).done(function(c){var f;c?(e&&(f=d.diff.patch({txt:c.text},e.patch)),f&&(c.text=f.txt.toString()),b.resolve(c)):d.getTextLater(a).then(function(a){return b.resolve(a)})})},getText:function(a){var b,d;return d=this,b=c.defer(),this.getElement("texts",a).then(function(a){return b.resolve(a)}),b.promise},setText:function(a,b){var c,d,e;return e=this,d=this._db.texts[a],d?(d.text=b,e.saveDiff("texts",a)):a&&b.length?(c={_id:a,_tm:new Date,db_name:"trees",text:b,user_id:i.set.user_id,del:0,_new:!0},c._sha1=e.JSON_stringify(c)._sha1,this._db.texts[a]=c,e.db.put("texts",c).done(function(){return __log.info("text "+a+" saved",c)})):void 0},jsStartSyncInWhile:_.debounce(function(){return i.set.autosync_on?this.syncDiff():void 0},1e3),jsStartSyncRightNow:_.debounce(function(){return i.set.autosync_on?this.syncDiff():void 0},10),saveDiff:_.throttle(function(a,b){var d,e;return e=this,d=c.defer(),this.getElement(a,b).then(function(c){e.getElementFromLocal(a,b).then(function(f){var g,h;if(c&&f){if(h=e.diff.diff(f,c),h&&h._sha1&&delete h._sha1,h&&h._tm&&delete h._tm,h&&_.each(Object.keys(h),function(a){return!h[a]||"_"!==a[0]&&"$"!==a[0]?void 0:delete h[a]}),g={_id:b,patch:h,db_name:a,_sha1:f._sha1,user_id:i.set.user_id,machine:i.set.machine,_tm:(new Date).getTime()},h&&!_.isEmpty(h))return e._tmp._diffs[g._id]=g,e.db.put("_diffs",g).done(function(){return d.resolve(),e.jsStartSyncInWhile(),$(".sync").addClass("need_sync"),e.refreshView(a,[c._id])})}else if(c&&c._new===!0)return d.resolve(),e.jsStartSyncInWhile(),$(".sync").addClass("need_sync"),e.refreshView(a,[c._id])})}),d.promise},50),getElementFromLocalPlusDiffs:function(a,b){var d,e;return d=c.defer(),e=this,this.getElementFromLocal(a,b).then(function(c){var f;f=e._tmp._diffs[b],f&&f._id&&f.db_name===a?(c=e.diff.patch(c,f.patch),d.resolve(c)):d.resolve(c)}),d.promise},getElementFromLocal:function(a,b){var d,e;return e=this,d=c.defer(),this.db.get(a,b).done(function(a){return d.resolve(a)}),d.promise},getElement:function(a,b){var d,e,f,g,h;return f=this,d=c.defer(),b?(e=null!=(g=this._db)&&null!=(h=g[a])?h[b]:void 0,!e&&b?f.getElementFromLocalPlusDiffs(a,b).then(function(b){return b&&(f._db[a][b._id]=b),d.resolve(b)}):d.resolve(e),d.promise):(d.resolve(),d.promise)},tmp_set:function(a){var b,d;return d=this,b=c.defer(),d.getElement("texts",a).then(function(c){return d._db.texts[a].text=c.text+"<p>"+Math.round(100*Math.random())+"</p>",__log.info("ADDED ",d._db.texts[a].text),d.saveDiff("texts",a).then(function(){return b.resolve()})}),b.promise},copyObject:function(a,b){var c,d;d=a;for(c in b)d[c]=b[c];return d},syncApplyResults:function(a){var b,e;return b=c.defer(),e=this,__log.debug("syncApply","Начинаю применять результаты синхронизации",{}),e.before_sync&&e.before_sync.length&&__log.debug("syncApply","Есть сохранённые бекапы элементов",{before_sync:e.before_sync}),e.clearCache(),_.each(Object.keys(a),function(c){var g;return g=a[c],g&&_.isObject(g.not_found)&&_.each(Object.keys(g.not_found),function(a){var b;return b=g.not_found[a],console.error("NEED RESEND ALL ELEMENT NEXT TIME",a,b),e._tmp._send_doc_next_time||(e._tmp._send_doc_next_time={}),e._tmp._send_doc_next_time[c]||(e._tmp._send_doc_next_time[c]={}),e._tmp._send_doc_next_time[c][a]=b}),g&&_.isObject(g.confirm)?_.each(Object.keys(g.confirm),function(a){var h;return h=g.confirm[a],__log.debug("syncApply","Применяю первое подтверждение для "+a,{confirm_element:h}),__log.debug("syncApply","Мне прислали _sha1 = "+h._sha1,{}),e.getElement(c,a).then(function(g){var j,k,l,m,n,o,p,q,r,s,t;if(g){if(__log.debug("syncApply","В своей базе (+patch) я нашёл _sha1 = "+g._sha1,{doc:g}),g._new&&(g._new=!1,__log.debug("syncApply","Элемент в базе был новым, я его отметил старым",{})),n=e.JSON_stringify(g)._sha1,__log.debug("syncApply","Вычислил актуальный _sha1 = "+n,{doc:g}),n===h._sha1)return __log.debug("syncApply","_sha1 "+n+" совпали, всё в порядке",{}),g._sha1=h._sha1,__log.debug("syncApply","_sha1 совпали, присваиваю doc._sha1 = "+h._sha1,{confirm_element:h,doc:g}),g._tm=h._tm,__log.debug("syncApply","_sha1 совпали, обновил _tm и sha1 и сохраняю в базу",{doc:g}),e.db.put(c,g).done(function(a){return __log.info("new data applyed",a,g),__log.debug("syncApply","_sha1 совпали. Сохранил в базу данных "+g._sha1,{err:a,doc:g})}),__log.debug("syncApply","_sha1 совпали. Удалил локальные дифы. ",{}),e._tmp._diffs[a]&&delete e._tmp._diffs[a],(null!=(o=e._tmp)&&null!=(p=o._send_doc_next_time)&&null!=(q=p[c])?q[a]:void 0)&&delete e._tmp._send_doc_next_time[c][a],e.db.remove("_diffs",a).done(function(a){return __log.debug("syncApply","_sha1 совпали. Удалил дифы в базе ",{err:a}),b.resolve()});if(__log.debug("syncApply","!= _sha1 sha1 в базе не совпадает с присланным с сервера "+n+" != (сервер)"+h._sha1,{doc:g,confirm_element:h}),l=e.before_sync[g._id],l&&__log.debug("syncApply","!= Нашел элемент в бекапе _sha1 = "+(null!=l?l._sha1:void 0),{old_doc:l}),__log.debug("EMPTY DOC RECIEVED!!! STRANGE"),h._doc?(g=h._doc,__log.debug("syncApply","!= С сервера прислали документ целиком, беру его. _sha1 = "+g._sha1,{doc:g}),(!l||h.merged)&&(__log.debug("Прислали документ с мерджем!",h),k=i.set.machine,h.merged&&"7829517"===k&&alert("merged"),e._tmp._diffs[a]&&delete e._tmp._diffs[a],(null!=(r=e._tmp)&&null!=(s=r._send_doc_next_time)&&null!=(t=s[c])?t[a]:void 0)&&delete e._tmp._send_doc_next_time[c][a],e.db.remove("_diffs",a).done(function(a){return __log.debug("syncApply","_sha1 не совпали. Удалил дифы в базе, так как мне прислали новый элемент ",{err:a})}),e.copyObject(e._db[c][a],g),__log.debug("syncApply","!= Есть данные в бекапе, сохраняю в память _sha1 = "+g._sha1,{doc:g}),e.db.put(c,g).done(function(){return __log.debug("syncApply","!= Есть данные в бекапе, сохранил в базу _sha1 = "+g._sha1,{doc:g}),f(function(){return d.$emit("refresh_editor"),__log.warn("syncApply","!= Попросил редактор обновиться ",{doc:g})},100)}))):__log.warn("Документ целиком не прислали, просто подтвердили старое изменение, нужно удалить дифы до нового изменения"),l&&!h.merged&&g)return __log.warn("syncApply","Данные есть в кеше, но sha1 другой!!!!!!!!!!!!!!!!",{old_doc:l,doc:g}),m=e.diff.diff(JSON.parse(JSON.stringify(l)),g),__log.warn("BUG: ",{old_doc:l,doc:g,patch:m}),m&&m._sha1&&delete m._sha1,m&&m._tm&&delete m._tm,__log.warn("PATCH = ",m),m&&(j={_id:a,patch:m,db_name:c,_sha1:l._sha1,user_id:i.set.user_id,machine:i.set.machine,_tm:(new Date).getTime()},__log.warn("!!!!!!!!!!!SHA1!!!!!!",g._sha1,g),e.saving_diff_busy=!0,e._tmp._diffs[j._id]=j),e._db[c][a]=g,e.db.put(c,l).done(function(){return __log.warn("old_saved _Sha1 = ",l._sha1),e.db.put("_diffs",j).done(function(){return f(function(){return d.$emit("refresh_editor"),__log.warn("syncApply","!= Попросил редактор обновиться SHA1 ERROR",{doc:g})},100),e.saving_diff_busy=!1})})}else if(h._doc)return e.clearCache(),e._db[c][h._doc._id]=h._doc,e.db.put(c,h._doc).done(function(a){return __log.info("saved_to_db ",a)})})}):void 0}),b.resolve(),b.promise},getLastSyncTime:function(){var a,b,d,e,f;return a=c.defer(),d=new Date(2013,3,1),b=new Date(2013,3,1),e=this,f={},async.each(e.store_schema,function(a,c){var g;return g=a.name,"_"!==g[0]?(__log.info({db_name:g}),b=_.max(e._db[g],function(a){return a._new&&(f[g]||(f[g]={}),f[g][a._id]=a),a._tm?new Date(a._tm):0}),new Date(b._tm)>d&&(d=new Date(b._tm)),c()):c()},function(){return a.resolve({last_sync_time:d,new_db_elements:f})}),a.promise},jsSyncJournalCount:function(){return this._tmp._diffs?Object.keys(this._tmp._diffs).length:0},sync_now:!1,sync_later:void 0,last_sync_time:"не проводилась",syncDiff:function(){var a,b,d;return a=c.defer(),b=this,b.sync_now?(clearTimeout(b.sync_later),b.sync_later=setTimeout(function(){return b.syncDiff(),__log.warn("SyncAgain...")},500),__log.warn("cant sync now, already syncing...................")):($(".sync_indicator").addClass("active"),setTimeout(function(){return $(".sync_indicator").removeClass("active")},950),b.sync_now=!0,__log.show_time_long&&console.time("sync_long"),d=Math.round(100*Math.random()),__log.info("("+d+") New syncing..."),this.getDiffsForSync().then(function(c){return b.sendDiffToWeb(c).then(function(c){return b.syncApplyResults(c).then(function(){var c;return b.refreshParentsIndex(),b.sync_now=!1,a.resolve(),__log.info("sha1 applyed"),__log.info("("+d+") STOP syncing..."),__log.show_time_long&&console.time("sync_long"),$(".sync").removeClass("need_sync"),c=new moment,b.last_sync_time=c.format("HH:mm:ss")})})})),a.promise},sendDiffToWeb:function(a){var d,f,g;return __log.info("Sending: ",null!=(g=JSON.stringify(a))?g.length:void 0),d=c.defer(),f=this,f.getLastSyncTime().then(function(c){var g,h,j;return g=c.last_sync_time,h=c.new_db_elements,j=i.set.machine+f.JSON_stringify({diffs:a,new_db_elements:h})._sha1,e.jsGetToken().then(function(c){return b({url:i.set.server+"/api/v2/sync",method:"POST",isArray:!0,params:{access_token:c,machine:i.set.machine,last_sync_time:g},data:{diffs:a,new_db_elements:h,sha1_sign:j,user_id:i.set.user_id}}).then(function(a){return d.resolve(a.data)})}),d.promise})},before_sync:{},getDiffsForSync:function(){var a,b,d,e;return a=c.defer(),e=this,b=e._tmp._diffs,d=i.set.machine,"7829517"===d&&b&&Object.keys(b).length&&alert("stop!"),e.before_sync={},b?async.each(Object.keys(b),function(a,c){var d;return d=b[a],__log.info("dif = ",d),e.getElement(d.db_name,d._id).then(function(a){var b,f;return a&&(e.before_sync[d._id]=JSON.parse(JSON.stringify(a)),e.before_sync[d._id]._sha1=e.JSON_stringify(e.before_sync[d._id])._sha1,__log.warn("backup = ",e.before_sync[d._id])),(null!=(b=e._tmp._send_doc_next_time)&&null!=(f=b[d.db_name])?f[d._id]:void 0)?e.getElementFromLocal(d.db_name,d._id).then(function(a){var b,f;return a._sha1===(null!=(b=e._tmp._send_doc_next_time)&&null!=(f=b[d.db_name])?f[d._id]:void 0)?(d._doc=a,c()):(console.error("strange, sha1 of local not equal"),c())}):c()})},function(){return a.resolve(b)}):a.resolve(),a.promise},TestJson:function(){var a;return a=this,f(function(){return __log.info("start test JSON"),__log.show_time_long&&console.time("JSON_test"),_.each(["tree","tasks","texts"],function(b){var c;return c=0,_.each(a._db[b],function(b){var d;return d=a.JSON_stringify(b),d._sha1!==b._sha1?(__log.info("SHA1 error ["+c+"]",b,d),c++):void 0}),0===c?__log.info("Congratulations.. "+b+" is equal..."):void 0}),__log.show_time_long?console.timeEnd("JSON_test"):void 0},3e3)},JSON_stringify:function(a){var b,c,d,e,f,g,h,i;return e=function(a){return"[object Object]"===Object.prototype.toString.call(a)},d=function(a){return"[object Array]"===Object.prototype.toString.call(a)},b=function(a){var c,f,g,h;if(e(a)){h={},g=Object.keys(a).sort(),f=void 0;for(c in g)f=g[c],_.has(a,f)&&(h[f]=b(a[f]));return h}return d(a)?a.map(b):a},c=function(a,b){var c;return"_"===(c=a[0])||"$"===c?void 0:b},f=b(JSON.parse(JSON.stringify(a,c))),g=JSON.stringify(f,c,0),h=null!=a?a._id:void 0,i=CryptoJS.SHA1(JSON.stringify(g)).toString().substr(0,7),{_id:h,_sha1:i,string:g}}}}])}.call(this),function(){angular.module("4treeApp").service("db_tasks",["$translate","$http","$q",function(){return{constructor:function(a){return this.$timeout=a,this.db_tasks=[{id:0,tree_id:1034,date1:new Date(2014,4,11),date2:new Date(2014,4,11),title:"Записаться в бассейн, это очень важно и нужно это сделать очень срочно, потомучто плавать это круто и всем нравится и это очень даже прикольно"},{id:1,tree_id:1034,date1:new Date(2014,2,3),date2:new Date(2014,2,3),title:"Начало сериала на ТНТ про дружбу народов",did:new Date},{id:2,tree_id:1034,date1:new Date(2013,2,3),date2:new Date(2014,2,3),title:"Как жизнь? написать письмо",did:new Date},{id:3,tree_id:1034,date1:new Date(2014,2,2),date2:new Date(2014,2,2),title:"Урал край голубых озёр - написать статью"},{id:4,tree_id:1034,date1:new Date((new Date).getTime()-132e5),date2:new Date(2014,2,3),title:"Двадцать минут назад я тут был :)"},{id:5,tree_id:1034,date1:"",date2:new Date(2014,2,3),title:"Как жизнь? написать письмо"},{id:8,tree_id:1034,date1:"",date2:new Date(2014,2,3),title:"Нужно купить Мартини"},{id:6,tree_id:1034,date1:new Date((new Date).getTime()+12e5),date2:new Date((new Date).getTime()+12e5),title:"Через 20 минут выходим"},{id:-1,tree_id:2138,date1:new Date(2014,2,1),date2:new Date(2014,2,1),title:"Очень важное дело, которое нужно сделать сегодня"}]},clearCache:function(){return _.each(this,function(a){return a?a.cache={}:void 0})},getTasks:function(){return this.db_tasks},getTasksByTreeId:_.memoize(function(a,b){var c,d;return c=_.filter(this.db_tasks,function(b){return b.tree_id===a}),c=_.sortBy(c,function(a){return a.date1}),b===!0?(d=_.find(c,function(a){return a.date1&&!a.did}),d||(d=_.find(c,function(a){return!a.did})),c=d?[d]:void 0):c=_.sortBy(c,function(a){var b;return a.date1?(b=-a.date1.getTime(),b+=1e14):(b=(new Date).getTime(),b+=2e14),a.did&&(b+=5e14),b}),c?c:[]},function(a,b){return a+b})}}])}.call(this),function(){angular.module("4treeApp").service("syncApi",["$translate","db_tree","$q","$http","oAuth2Api","diffApi","$rootScope","$timeout","$socket",function(a,b,c,d,e,f,g,h,i){return{autosync_on:!0,sync_journal:{},last_sync_time:"не проводилась",gen:1,jsGetGen:function(){return this.gen++},jsFindChangesForSync:function(a,b){var c;return c=this,this.jsDeepEach(a,function(d,e){var f;return f=c.jsGetByKeys(b,e)[e[e.length-1]],!_.isEqual(d,f)&&e[0]&&"_"!==e[0][0]?(c.jsAddToSyncJournal(a._id,e),console.info(a._id+" changed "+e.join("."))):void 0}),this.sync_journal},jsAddToSyncJournal:function(a,b){var c,d,e,f;return e=(new Date).getTime(),c=this.jsGetGen(),this.sync_journal[a]?(this.sync_journal[a]._tm=e,this.sync_journal[a]._gen=c):this.sync_journal[a]={_tm:e,_gen:c,changes:{}},d=b.join("."),f={_tm:e,_gen:c},this.sync_journal[a].changes[d]||(this.sync_journal[a].changes[d]={}),this.sync_journal[a].changes[d]=f,this.jsStartSyncInWhile()},jsDeepEach:function(a,b,c){var d;return null==c&&(c=[]),d=this,_.each(a,function(a,e){var f,g;return _.isObject(a)&&_.isArray(a)?(f=c.slice(0),f.push(e),d.jsDeepEach(a,b,f)):(f=c.slice(0),f.push(e),"$"!==(g=e[0])&&"+"!==g?b.call(this,a,f):void 0)})},jsGetByKeys:function(a,b){var c;return c=a,_.each(b,function(b){return c=a,a[b]?a=a[b]:void 0}),c},jsStartSyncInWhile:_.debounce(function(){console.info("wait 5 sec...")},1e3),jsHideSyncIndicator:_.debounce(function(){return $(".sync_indicator").removeClass("active")},1e3),jsStartSync:function(){return b.syncDiff(),!0},jsPostSync:function(a){var b;return b=c.defer(),console.info(e),e.jsGetToken().then(function(c){return d({url:"/api/v1/sync",method:"POST",isArray:!0,params:{access_token:c},data:{sync_data_to_send:a}}).then(function(a){return console.info("SYNC_RESULT = ",a),b.resolve(a.data)})}),b.promise},jsSyncJournalCount:function(){return Object.keys(this.sync_journal).length},diff_journal:{},sync_now:!1,constructor:function(){var a;return a=this,g.$on("jsFindAndSaveDiff2",function(c,d,e,g){var h;return console.info("watch",a.sync_now),g&&e&&!a.sync_now?(h=f.diff(g,e,(new Date).getTime()),_.each(h,function(b){var c;"_"!==b.key[0][0]&&"$"!==b.key[b.key.length-1][0]&&"_"!==b.key[b.key.length-1][0]&&"_tm"!==b.key[0]&&(c=b.type+":"+b.key.join("."),a.diff_journal[d]||(a.diff_journal[d]={}),a.diff_journal[d][g._id]||(a.diff_journal[d][g._id]={}),a.diff_journal[d][g._id][c]=b)}),h.length&&(b.refreshView(d,[g._id],e,g),a.jsStartSyncInWhile()),b.jsSaveElementToLocal(d,e).then(function(){return console.info("saved_local")})):void 0})},getLastSyncTime:function(){var a;return a=_.max(b._db.tree,function(a){return a._tm?new Date(a._tm):0}),a._tm},dfd_sync:c.defer(),syncThrough:function(a,b){var g;return g=this,g.dfd_sync=c.defer(),f.logJson("sending data through ["+a+"]",b),"http"===a&&e.jsGetToken().then(function(a){return d({url:"/api/v1/sync_db",method:"POST",isArray:!0,params:{access_token:a},data:b}).then(function(a){return g.jsUpdateDb(a.data).then(function(){return g.dfd_sync.resolve(a.data)})})}),"websocket"===a&&i.emit("sync_data",b,function(a){return console.info("ANSWER = ",a)}),g.dfd_sync.promise},syncToServer:function(){var a,d,e;return a=c.defer(),d=this,e={},async.each(b.store_schema,function(a,c){var d,f;return d=a.name,f=_.filter(b._db[d],function(a){return a._new===!0}),_.each(f,function(a){return e[d]||(e[d]={}),e[d][a._id]=a}),c()},function(){var b;return console.timeEnd("load_local"),b={diff_journal:d.diff_journal,last_sync_time:d.getLastSyncTime(),user_instance:g.$$childTail.set.user_instance,user_id:g.$$childTail.set.user_id,new_elements:e},i.is_online()?d.syncThrough("websocket",b).then(function(){return console.info("sync_socket_ended"),a.resolve()}):d.syncThrough("http",b).then(function(){return console.info("sync_http_ended"),a.resolve()})}),a.promise},jsUpdateDb:function(a){var b,c,d;return b=$.Deferred(),c=[],d=this,_.each(a,function(a,b){return c.push(d.jsUpdateDbOne(a,b))}),$.when.apply(null,c).then(function(){return b.resolve()}),b.promise()},jsUpdateDbOne:function(a,c){var d,e,f,g,i,j;return console.info("ONE = ",a),i=a.new_data,j=a.sync_confirm_id,console.info("confirm = ",j,"new_data = ",i),e=$.Deferred(),g=this,g.sync_now=!0,d=function(a,b){var c,d;d=a;for(c in b)d[c]=b[c];return d},f=!1,_.each(i,function(a){var e;return e=_.find(b._db[c],function(b){return b._id===a._id}),e?(d(e,a),f=!0,console.info("new = ",e)):(console.info("need_to_create!",a),b._db[c].push(a),f=!0),!0}),_.each(j,function(a){var d,e,h;return d=_.find(b._db[c],function(b){return b._id===a._id}),d&&(console.info("confirm_times",d._tm,a._tm,g.sync_now),f=!0,d._tm=a._tm,d._new=!1,null!=(e=g.diff_journal)&&null!=(h=e[c])?h[a._id]:void 0)?delete g.diff_journal[c][a._id]:void 0}),f&&b.refreshParentsIndex(),e.resolve(),h(function(){return g.sync_now=!1}),e.promise()}}}])}.call(this),function(){angular.module("4treeApp").service("diffApi",["db_tree",function(){return{diff:function(a,b,c){var d,e,f;return f=function(a){return"put"===a.type&&void 0===a.value&&(a.type="del",delete a.value),a},e=function(a,b,c,d){var g,h,i,j,k,l;return g=[],null===b||null===c||"object"!=typeof b||_.isDate(b)?b!==c&&g.push(f({type:"put",key:a,value:c,tm:d})):(k=Object.keys(b),i=Object.keys(c),l=_.intersection(k,i),l.forEach(function(f){var h;h=e(a.concat(f),b[f],c[f],d),g=g.concat(h)}),h=_.difference(k,i),h.forEach(function(b){g.push({type:"del",key:a.concat(b),tm:d})}),j=_.difference(i,k),j.forEach(function(b){g.push(f({type:"put",key:a.concat(b),value:c[b],tm:d}))})),g},d=[],d=d.concat(e([],a,b,c))},apply:function(a,b,c){var d,e;if(e=void 0,c)e=b;else try{e=JSON.parse(JSON.stringify(b))}catch(f){d=f,e=void 0}return a.forEach(function(a){var b,c,d;switch(d=void 0,b=void 0,c=void 0,a.type){case"put":return d=e,b=a.key,c=b.length,c?b.forEach(function(b,e){b in d||(d[b]={}),c-1>e?d=d[b]:d[b]=a.value}):e=a.value;case"del":return d=e,b=a.key,c=b.length,c?b.forEach(function(a,b){a in d||(d[a]={}),c-1>b?d=d[a]:delete d[a]}):e=null}}),e},logJson:function(a,b,c){var d,e,f,g;return g=new Date,d=g.getHours(),e=g.getMinutes(),f=g.getSeconds(),console.info("["+d+":"+e+":"+f+"] "+a+" = "+JSON.stringify(b,!1,c?void 0:"  "))}}}])}.call(this),function(){angular.module("4treeApp").service("cryptApi",["$translate","$rootScope",function(a){return{methods:{0:"AES",1:"DES",2:"TripleDES",3:"Rabbit",4:"RC4Drop"},pass_salt:"salt",password:"flz5Nep/ENESzbcK7QySBklo6vJb6NYN4RBu9P7jYMJssdnzi6hXS",pass:"qIyhc3JmAeqwmFUvwJ7HsRjovRB8rdthk3Bd1UjbV1cTR/qs8+Cil3iGyCGr6VX",reminder:"Crypted "+(new Date).toString(),constructor:function(){return console.time("start"),console.timeEnd("start")},encrypt:function(a,b){var c,d,e,f;return f=this.sha3("_"+1e8*Math.random()).substr(0,5),e=this.methods[b]?this.methods[b]:"AES",console.time("encrypt start "+e),d=CryptoJS[e]?CryptoJS[e].encrypt(a,this.pass+f).toString():a,c={memo:this.reminder,data:d,method:e,salt:f},console.timeEnd("encrypt start "+e),JSON.stringify(c)},decrypt:function(b){var c,d,e;e=null;try{b=JSON.parse(b)}catch(f){d=f,e=a("ENCRYPT.JSON_ERROR")}return CryptoJS[b.method]&&(c=CryptoJS[b.method].decrypt(b.data,this.pass+b.salt),c.sigBytes<=0&&(e=a("ENCRYPT.PASS_ERROR")),c=c.toString(CryptoJS.enc.Utf8)),{text:c,err:e}},sha3:function(a){return CryptoJS.SHA3(a,{outputLength:64}).toString()}}}])}.call(this),function(){angular.module("4treeApp").service("settingsApi",["$translate","$http","$q","$rootScope","$timeout","$socket","$location","cryptApi",function(a,b,c,d,e,f,g,h){var i,j,k,l;return l={tick_today_date:new Date,tick_today_date_time:(new Date).getTime(),focus:1,focus_edit:1,tree_loaded:!1},k={v:0,user_info:{client_id:"4tree_client",client_secret:"4tree_secret",username:"",password:""},user_id:"5330ff92898a2b63c2f7095f",machine:localStorage.getItem("mongoMachineId"),autosync_on:!0,server:"",today_date:new Date,today_date_time:(new Date).getTime(),tabs:[],header_panel_opened:!0,p_left_side_open:!1,p_right_side_open:!0,p_plan_of_day_open:!0,top_parent_id:"no parent",main_parent_id:[],show_path_panel:!1,show_pomidor_timer:!1,show_right_menu:!0,new_title:"Новая заметка",calendar_box_template:"views/subviews/view_calendar_box.html",weight:{date:1,importance:1},panel:[{active:7},{active:0},{active:5},{active:0}],from_today_index:0,side_views_menu:[{title:"План дня",icon:"icon-calendar",template:"views/subviews/view_side/view_plan_of_day.html"},{title:"To-do",icon:"icon-check",template:"views/subviews/view_side/view_side_todo.html"},{title:"Новости",icon:"icon-rss",template:"views/subviews/view_side/view_side_news.html"},{title:"Мой сайт",icon:"glyphicon glyphicon-globe",template:"views/subviews/view_side/view_side_myweb.html"},{title:"Контакты",icon:"glyphicon glyphicon-user",template:"views/subviews/view_side/view_side_contacts.html"},{title:"Теги",icon:"glyphicon glyphicon-tag",template:"views/subviews/view_side/view_side_tags.html"},{title:"Обзор",icon:"icon-eye",template:"views/subviews/view_side/view_side_review.html"},{title:"Поиск",icon:"icon-search",template:"views/subviews/view_side/view_side_search.html"}],main_views_menu:[{title:"Дерево",icon:"icon-flow-cascade",template:"views/subviews/view_main/view_tree.html"},{title:"Карточки",icon:"icon-th-1",template:"views/subviews/view_main/view_cards.html"},{title:"Mindmap",icon:"glyphicon glyphicon-record",template:"views/subviews/view_main/view_mindmap.html"},{title:"divider"},{title:"Календарь",icon:"icon-calendar-2",template:"views/subviews/view_main/view_calendar.html"},{title:"Редактор",icon:"icon-pencil-neg",template:"views/subviews/view_main/view_text.html"},{title:"— — —",off:!0,icon:"icon-cancel-circle",template:""},{title:"Неделя",icon:"icon-calendar",template:"views/subviews/view_main/view_week_calendar.html"}],refresh:0,ms_show_icon_limit:36,mini_settings_btn_active:0,mini_settings_show:!1,mini_tasks_hide:!1,mini_settings_btn:[{id:0,title:"Оформление",icon:"icon-brush"},{id:1,title:"Проект",icon:"icon-target"},{id:2,title:"Обзор",icon:"icon-eye"},{id:3,title:"Счётчики",icon:"icon-chart-area"},{id:4,title:"Поделиться",icon:"icon-export-1"}]},j=function(){var a;
return a=h.encrypt(JSON.stringify(k),4),localStorage.setItem("settings",a),console.info("SAVED")},i=function(){var a,b,c;return b=localStorage.getItem("settings"),b&&(a=h.decrypt(b).text)?(c=JSON.parse(a),c.v===k.v?(k=c,console.info("loaded",k)):console.info("version changed")):void 0},i(),d.$watch(function(){return k},function(a,b){return _.isEqual(a,b)?void 0:j()},!0),{set:k,tmp:l,save:j}}])}.call(this),function(){var a;a=function(){function a(a,b){var c;this.timeout=a,this.q=b,console.info("constructor textDB did"),c=this,_.each(this.textToLoad,function(a,b){var d;return console.info("sha of txt = ",b),d=c.sha(a),c.textDB[b]={text:a,sha:d}})}return a.$inject=["$timeout","$q"],a.prototype.textToLoad={"5353a5a9265932b16f11ff24":"South America (Spanish: América del Sur, Sudamérica or  \nSuramérica; Portuguese: América do Sul; Quechua and Aymara:  \nUrin Awya Yala; Guarani: Ñembyamérika; Dutch: Zuid-Amerika;  \nFrench: Amérique du Sud) is a continent situated in the  \nWestern Hemisphere, mostly in the Southern Hemisphere, with  \na relatively small portion in the Northern Hemisphere.  \nThe continent is also considered a subcontinent of the  \nAmericas.[2][3] It is bordered on the west by the Pacific  \nOcean and on the north and east by the Atlantic Ocean;  \nNorth America and the Caribbean Sea lie to the northwest.  \nIt includes twelve countries: Argentina, Bolivia, Brazil,  \nChile, Colombia, Ecuador, Guyana, Paraguay, Peru, Suriname,  \nUruguay, and Venezuela. The South American nations that  \nborder the Caribbean Sea—including Colombia, Venezuela,  \nGuyana, Suriname, as well as French Guiana, which is an  \noverseas region of France—are also known as Caribbean South  \nAmerica. South America has an area of 17,840,000 square  \nkilometers (6,890,000 sq mi). Its population as of 2005  \nhas been estimated at more than 371,090,000. South America  \nranks fourth in area (after Asia, Africa, and North America)  \nand fifth in population (after Asia, Africa, Europe, and  \nNorth America). The word America was coined in 1507 by  \ncartographers Martin Waldseemüller and Matthias Ringmann,  \nafter Amerigo Vespucci, who was the first European to  \nsuggest that the lands newly discovered by Europeans were  \nnot India, but a New World unknown to Europeans."},a.prototype.diff=jsondiffpatch.create({objectHash:function(a){return console.info("!!!",a),a.name||a.id||a._id||a._id||JSON.stringify(a)}}),a.prototype.textDB={},a.prototype.getText=function(a){var b;return console.info("getText",a),b=this.q.defer(),b.resolve(this.textDB[a]),b.promise},a.prototype.setText=function(a,b){var c;return c=this,this.getText(a).then(function(d){var e,f,g;return e=null!=d?d.text:void 0,f=c.diff.diff({txt:e},{txt:b}),e.length&&(c.textDB[a].diff=f),f&&(c.textDB[a].length=JSON.stringify(f).length),console.info("DIFF SAVED = ",d),console.info("RESTORE",c.diff.patch({txt:e},f)),g=c.diff.reverse(f),console.info("RESTORE-REVERS",c.diff.patch({txt:b},g))})},a.prototype.sha=function(a){return CryptoJS.SHA3(a,{outputLength:256}).toString()},a}(),angular.module("4treeApp").service("textDB",a)}.call(this),function(){var a,b;angular.module("4treeApp").controller("MainCtrl",["$translate","$scope","calendarBox","db_tree","$interval","syncApi","db_tasks","$q","$timeout","$rootScope","diffApi","cryptApi","$socket","oAuth2Api","settingsApi",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p;return __log.show_time_long=!1,__log.setLevel("error"),m.on("who_are_you",b,function(){return m.emit("i_am_user",{_id:b.set.user_id,machine:j.$$childTail.set.machine})}),m.on("file_loaded",b,function(a){return __log.info("File Loaded",a)}),m.on("need_sync",b,function(a,b){return b("success"),__log.info("sync_data",a),f.jsUpdateDb(a)}),m.on("need_sync_now",b,function(){return d.jsStartSyncRightNow()}),m.on("sync_answer",b,function(a){return f.jsUpdateDb(a).then(function(){return f.dfd_sync.resolve()})}),b.send=function(a){return m.emit("hello",a)},e(function(){return o.tmp.tick_today_date=new Date,o.tmp.tick_today_date_time=(new Date).getTime()},3e4),b.set=o.set,b.tmp=o.tmp,j.$on("tree_loaded",function(){}),b.fn={service:{db_tasks:g,db_tree:d,calendarBox:c,syncApi:f,settingsApi:o},jsOpenTree:function(a,b){return a._panel||(a._panel={}),a._panel[b]||(a._panel[b]={}),a._panel[b]._open=!a._panel[b]._open},getFormId:function(a){return a+"_"+(new ObjectId).toString()},datediff:_.memoize(function(a){var b,c;return b=new moment(a.startDate),c=new moment(a.endDate),c.diff(b,"days")+1},function(a){return a.startDate+a.endDate}),tags:["@gtd","@срочно","@завтра","@быстро","@на сайт","@общее","@Вецель","@когда-нибудь"],scrollTop:function(){return $("#p_right_wrap .content").scrollTop(5e4)},jsCopyClipboard:function(a){return a},jsCopyClipboardConfirm:function(a){var b;return b="Ссылка: "+a+" в буфере обмена"},jsDateRewind:function(a,b){var c;return c=new Date,c.setDate(new Date(a.today_date).getDate()+b),a.today_date=c},loadTags:function(a){var b;return b=h.defer(),__log.info(a),b.resolve(_.filter(this.tags,function(b){return-1!==b.indexOf(a)})),b.promise},changeLanguage:function(c){return a.uses(c).then(function(){return b.db.calendar_boxes=[],b.fn.setCalendarBox()})},setCalendarBox:function(){var a,d;return _(function(){for(d=[],a=-500;500>=a;a++)d.push(a);return d}.apply(this)).each(function(a){var d;return d=new Date((new Date).getTime()+24*a*60*60*1e3),b.db.calendar_boxes.push(c.getDateBox(d))})},calendar_box_click:function(a){return b.db.box_active!==a?(b.set.p_plan_of_day_open=!0,b.db.box_active=a):(b.db.box_active=null,b.set.p_plan_of_day_open=!1),b.set.today_date=c.getCalendarForIndex(a).fulldate},addNote:function(){return b.db.db_tree.push({id:0,title:"Hi!!!!!!!!!!!"})},jsFindByParent:function(a){return d.jsFindByParent(a)},jsTreeFocus:function(a){return b.set.main_parent_id[b.tmp.focus]=a,__log.info("focus ",a),b.db.tree_path=d.jsGetPath(a)},jsClosePomidor:function(){return b.set.show_pomidor_timer&&(b.set.show_pomidor_timer=!1),__log.info("close")},jsGetTimeRest:function(a){var b,c;return b=parseInt(a/6e4),c=parseInt(a/1e3-60*b),("0"+b).slice(-2)+":"+("0"+c).slice(-2)},jsStartPomidorInterval:function(){return b.db.pomidors.timer=e(function(){var a,c,d,f;return a=b.db.pomidors.finish_time-(new Date).getTime(),b.db.pomidors.procent=3+100*(1-a/(60*b.db.pomidors.how_long*1e3)),b.db.pomidors.btn_text=b.fn.jsGetTimeRest(a),b.db.pomidors.procent>=100&&(b.db.pomidors.finish_time=0,e.cancel(b.db.pomidors.timer),-1!==[2,4,6].indexOf(b.db.pomidors.now)&&(f=new Notification("Таймер Pomodorro",{tag:"notify-pomidor"+b.db.pomidors.now+new Date,body:"Отдохнули? Чтобы начать следующую помидорку на 25 минут, нажмите сюда.",icon:"images/pomidor.png"}),f.onclick=function(){return b.fn.jsStartPomidor({id:1}),this.cancel()}),-1!==[1,3,5,7].indexOf(b.db.pomidors.now))?(b.fn.jsStartPomidor({id:1}),c="5 минут...",7===b.db.pomidors.now&&(c="15 минут..."),d=new Notification("Таймер Pomodorro",{tag:"notify-pomidor"+b.db.pomidors.now+new Date,body:"Отлично поработали, теперь отдохните "+c,icon:"images/pomidor.png"}),setTimeout(function(){return d.cancel()},1e4),d.onclick=function(){return window.focus(),this.cancel()}):void 0},1e3)},jsStartPomidor:function(a){return _.each(b.db.pomidors.list,function(b){return b.active=b.id===a.id?!0:!1}),b.db.pomidors.procent=0,b.db.pomidors.now<8?(b.db.pomidors.now+=1,-1!==[1,3,5,7].indexOf(b.db.pomidors.now)&&(b.db.pomidors.how_long=25),-1!==[2,4,6].indexOf(b.db.pomidors.now)&&(b.db.pomidors.how_long=5),-1!==[8].indexOf(b.db.pomidors.now)&&(b.db.pomidors.how_long=15),b.db.pomidors.finish_time=(new Date).getTime()+60*b.db.pomidors.how_long*1e3,localStorage.setItem("set_pomidors",JSON.stringify(b.db.pomidors)),e.cancel(b.db.pomidors.timer),b.fn.jsStartPomidorInterval()):(b.db.pomidors.now=0,e.cancel(b.db.pomidors.timer),b.db.pomidors.btn_text="25:00",void localStorage.clear("set_pomidors"))}},b.scrollModel={},b.db={main_text:"Текст",calendar_boxes:[],mystate:void 0,tree_path:[],main_node:[{},{},{},{}],pomidors:{active:!1,procent:100,finish_time:0,how_long:25,btn_text:"25:00",now:0,timer:0,list:[{id:1,active:!0,did:2},{id:3,active:!1,did:2},{id:5,active:!1,did:2},{id:7,active:!1,did:1}]},today_do:[{title:"Записаться в бассейн",myclass:"done",time:"11:00"},{title:"Ехать за деньгами",myclass:"future",time:"12:30"},{title:"Мыть машину",myclass:"future",time:"16:20"},{title:"Ехать в театр",myclass:"future",time:"17:00"}],nodate_do:[{title:"Найти интересную книжку",myclass:"done",time:""},{title:"Навести порядок",myclass:"done",time:""},{title:"Прогуляться на улице",myclass:"future",time:""},{title:"Заехать к родителям",myclass:"future",time:""}],news_changes:[{title:"Изменил заметку 'АС_ЭТД'",myclass:"done",time:""},{title:"Добавил комментарий в 'Дневник': 'Ты когда собираешься домой, всегда проверяй — взял ли ты ключи с собой'",myclass:"done",time:""},{title:"Удалил заметку 'Контроль кол-ва показателей в спорте'",myclass:"future",time:""},{title:"Выложил в интернет 'Интересная статья об оптимизации Angulare'",myclass:"future",time:""}],news_comments:[{title:"Отличный фильм, нужно пересмотреть его на английском языке (Курьер)",myclass:"done",time:""},{title:"Валь, не забудь пожалуйста взять с собой очиститель ржавчины. Пора уже залить в замок, а то мы его потеряем. (Починить дверь)",myclass:"done",time:""},{title:"Сегодня отжался 20 раз (Отжимания)",myclass:"future",time:""},{title:"Есть отличный плагин LiveReload (Инструменты программирования)",myclass:"future",time:""}],reward_do:[{title:"Помидорок: 6",myclass:"done",time:""},{title:"Добавлено дел: 18",myclass:"done",time:""},{title:"Дел лягушек: 4",myclass:"future",time:""}],frends:["Alexandr Perevezentsev","Pavel Podd","Tati Polonskaya","Айдэн Мамедов","Александр Галинский","Алексей Владимирович","Алексей Колганов","Алексей Пушников","Алексей Цепелев","Алёна Швабауэр","Анастасия Тюленева","Анатолий Вецель","Анатолий Соловьев","Андрей Винников","Андрей Худорошков","Антон Баранов","Армен Петросян","Артем Бурнатов","Вадим Аверенков","Валентина Курган","Валерия Бузуева","Валерия Мунтанина","Виталий Нефёдов","Владимир Дребнев","Владимир Терехов","Владимир Шевченко","Владислав Гречкосеев","Галина Романова","Денис Черепанов","Евгений Мищенков","Екатерина Исаева","Екатерина Подбельная","Елена Морозова","Елена Трубеева","Иван Сёмин","Игорь Шимов","Игорь Шинкарев","Ира Никитина","Ирина Черкасова","Константин Швецов","Кристина Харламова","Любовь Апалькова","Митька Тополянский","Надежда Божко","Наталья Вецель","Наталья Подкорытова","Николай Модонов","Оксана Сулейманова","Ольга Волшебница","Ольга Егорова","Ольга Кузьминых","Павел Баганов","Руслан Юмагужин","Салават Ялалов","Свелана Вецель","Станислав Колеватов","Танюша Полонская","Татьяна Кондюрина","Татьяна Седова","Эльвира Нуртдинова","Юлия Прохорова","Ігор Ребега"],icons_collection:["icon-progress-0","icon-progress-1","icon-progress-2","icon-progress-3","icon-dot","icon-dot-2","icon-dot-3","icon-thumbs-up-1","icon-thumbs-down","icon-minus","icon-plus","icon-star-empty","icon-star","icon-heart-empty","icon-heart","icon-lock-open","icon-lock","glyphicon glyphicon-eye-close","glyphicon glyphicon-eye-open","icon-phone","glyphicon glyphicon-phone-alt","icon-home-2","icon-stop","icon-cloud","glyphicon glyphicon-unchecked","icon-ok-1","icon-check","glyphicon glyphicon-ok-sign","icon-flash","icon-flight","icon-pencil-alt","icon-help-circle","icon-help","icon-wallet","icon-mail-2","icon-tree","icon-comment-inv","icon-chat-2","icon-article-alt","icon-rss","icon-volume","icon-aperture-alt","icon-layers","icon-emo-happy","icon-emo-wink","icon-emo-laugh","icon-emo-sunglasses","icon-emo-sleep","icon-emo-unhappy","icon-skiing","icon-twitter-bird","icon-gift","icon-basket","icon-dollar","icon-floppy","icon-doc-text","icon-calendar-2","icon-book-open","icon-camera","icon-search-1","icon-wrench-1","icon-umbrella","icon-music","icon-record","icon-feather","icon-calculator","icon-address","icon-pin","icon-basket-1","icon-steering-wheel","icon-bicycle","icon-swimming","icon-leaf","icon-mic","icon-target-1","icon-user","icon-monitor","icon-cd","icon-download","icon-link","icon-wrench","icon-clock","icon-at","icon-pause","icon-moon","icon-flag","icon-key","icon-users-1","icon-adjust","icon-eye","icon-print","icon-inbox","icon-flow-cascade","icon-college","icon-fast-food","icon-coffee","icon-palette","icon-top-list","icon-bag","icon-attach-1","icon-info","icon-home-1","icon-hourglass","icon-attention","icon-scissors","icon-pencil-neg","icon-tint","icon-chart-area","glyphicon glyphicon-stats","icon-chart-pie","icon-guidedog","icon-tag","icon-archive","icon-flow-line","icon-terminal","icon-eyedropper","icon-glass","icon-lamp","icon-folder-1","icon-doc-1","icon-doc-2","icon-book","icon-signal","icon-bookmark","glyphicon glyphicon-asterisk","glyphicon glyphicon-film","glyphicon glyphicon-remove","glyphicon glyphicon-off","glyphicon glyphicon-road","glyphicon glyphicon-headphones","glyphicon glyphicon-facetime-video","glyphicon glyphicon-map-marker","glyphicon glyphicon-play","glyphicon glyphicon-pause","glyphicon glyphicon-stop","glyphicon glyphicon-exclamation-sign","glyphicon glyphicon-gift","glyphicon glyphicon-fire","glyphicon glyphicon-magnet","glyphicon glyphicon-bullhorn","glyphicon glyphicon-certificate","glyphicon glyphicon-globe","glyphicon glyphicon-tasks","glyphicon glyphicon-filter","glyphicon glyphicon-dashboard","glyphicon glyphicon-phone","glyphicon glyphicon-usd","glyphicon glyphicon-euro","glyphicon glyphicon-gbp","glyphicon glyphicon-record","glyphicon glyphicon-send","glyphicon glyphicon-cutlery","glyphicon glyphicon-compressed","glyphicon glyphicon-tower","glyphicon glyphicon-tree-conifer"],icons_collection_colors:[{color:"#265e12",icon_color:"#b0ff8d"},{color:"#198603",icon_color:"#b0ff8d"},{color:"#ffaf10",icon_color:"#9a6113"},{color:"#f0cb09",icon_color:"#9a6113"},{color:"#993333",icon_color:"#FFF"},{color:"#e0292b",icon_color:"#000"},{color:"#CC6699",icon_color:"#fff"},{color:"#ff0080",icon_color:"#fff"},{color:"#008AB8",icon_color:"#fff"},{color:"#3F5D7D",icon_color:"#fff"},{color:"gray",icon_color:"#dedede"},{color:"#000",icon_color:"#FFF"}]},d.constructor(),g.constructor(),b.db.tasks=g.getTasks(),d.getTreeFromNet().then(function(){return b.set.main_parent=d.jsFindByParent(1)}),b.db.tree_path=d.jsGetPath(1),b.fn.setCalendarBox(),f.constructor(),b.myname="Huper...",(p=localStorage.getItem("set_pomidors"))&&(b.db.pomidors=JSON.parse(p)),0!==b.db.pomidors.now?b.fn.jsStartPomidorInterval():void 0}]),a=function(a,b){return __log.info(a+b)},angular.module("4treeApp").value("fooConfig",{config1:!0,config2:"Default config2 but it can changes"}),b=function(a,b,c){var d,e;return b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join(""),e=/<\/?([a-z][a-z0-9]*)\b[^>]*>/g,d=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/g,a.replace(d,c).replace(e,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})}}.call(this),function(){var a;a=function(){function a(a,b,c){var d;this.timeout=a,this.scope=b,this.q=c,d=this,_.each(this.textToLoad,function(a){var b;return b=d.sha(a),console.info("sha of txt = ",b),d.textDB[b]=a}),this.scope.txt="Пусто",this.scope.$watch("tree",function(a,b){var c;return a!==b&&(console.info("watch",b),null!=(c=d.scope.tree)?c.text_id:void 0)?d.getTextByShaId(d.scope.tree.text_id).then(function(a){return d.scope.txt=a}):void 0}),console.info("DB = ",this.textDB)}return a.$inject=["$timeout","$scope","$q"],a.prototype.textToLoad={"":"Мама мыла раму"},a.prototype.textDB={},a.prototype.getTextByShaId=function(a){var b,c;return console.info("!!!",this.q),b=this.q.defer(),c=this,this.textDB?this.timeout(function(){return b.resolve(c.textDB[a])},3e3):b.resolve(),b.promise},a.prototype.sha=function(a){return CryptoJS.SHA3(a,{outputLength:256}).toString()},a}(),angular.module("4treeApp").controller("textController",a)}.call(this),function(){angular.module("4treeApp").controller("LoginCtrl",["$translate","$scope","$q","$timeout","$rootScope","oAuth2Api","cryptApi","settingsApi",function(a,b,c,d,e,f,g,h){var i,j;return b.tab="login",b.pass_type="password",b.pass_placeholder="пароль",b.$watch("show_password",function(a,c){return c!==a?(b.show_password?(b.pass_type="text",b.pass_placeholder="пароль виден"):(b.pass_type="password",b.pass_placeholder="пароль"),i(a,c)):void 0}),b.$watch("tab",function(a,c){var d;return i(a,c),(null!=(d=b.email)?d.length:void 0)?$("input:eq(1)").focus():$("input:first").focus()}),j=h.set.user_info.username,j&&(b.email=g.decrypt(j).text),b.$watch("email",function(a,b){var c;return b!==a?(i(a,b),c=g.encrypt(a,4),h.set.user_info.username=c,console.info(c)):void 0}),i=function(a,c){var d,e,f,g;return a!==c?b.all_ok=("login"===b.tab||b.show_password)&&(null!=(d=b.email)?d.length:void 0)&&(null!=(e=b.pas1)?e.length:void 0)>2||!b.show_password&&(null!=(f=b.email)?f.length:void 0)&&(null!=(g=b.pas1)?g.length:void 0)>2&&b.pas1===b.pas2?!0:!1:void 0},b.$watch("pas1",i),b.$watch("pas2",i),b.loginOrReg=function(){return"login"===b.tab?(h.set.user_info.username=b.email,h.set.user_info.password=b.pas1,e.$emit("save_settings"),f.jsGetRemoteTokenByPassword().then(function(){return f.jsGetToken().then(function(){return document.location.hash="#/home"})})):void 0}}])}.call(this),function(){angular.module("4treeApp").controller("save_tree_db_editor",["$scope","syncApi","db_tree","$rootScope",function(a,b,c,d){return a.$watch("db.main_node[tmp.focus_edit]",function(a,b){return!_.isEqual(a,b)&&a&&b&&a._id===b._id?d.$emit("jsFindAndSaveDiff","tree",a,b):void 0},!0)}]),angular.module("4treeApp").controller("save_tree_db",["$scope","syncApi","db_tree","$rootScope",function(a,b,c,d){var e;return e=a.db.main_node[a.tmp.focus_edit],a.save_scroll=function(){return console.info(a.scrollValues)},a.$watch("tree",function(a,b){return _.isEqual(a,b)||a._id!==b._id?void 0:d.$emit("jsFindAndSaveDiff","tree",a,b)},!0)}]),angular.module("4treeApp").controller("save_task_db",["$scope","syncApi","db_tree","$rootScope",function(a,b,c,d){return a.$watch("task.date_on",function(b,c){return c||b!==!0||(a.task.date1||(a.task.date1=new Date),a.task.date2)?void 0:a.task.date2=new Date}),a.$watchCollection("set.set_task",function(a,b){return _.isEqual(a,b)?void 0:d.$emit("jsFindAndSaveDiff","tasks",a,b)})}]),angular.module("4treeApp").controller("save_task_db_simple",["$scope","syncApi","db_tree","$rootScope",function(a,b,c,d){return a.$watchCollection("task",function(a,b){return _.isEqual(a,b)?void 0:d.$emit("jsFindAndSaveDiff","tasks",a,b)})}]),angular.module("4treeApp").controller("editor_tasks",["$scope","db_tree","$rootScope",function(a,b){return a.$watch("task.importance",function(a,c){return a!==c?b.clearCache():void 0}),a.getTasks=function(){return a.set.mini_tasks_hide?a.tasks_by_id.next_action:a.tasks_by_id.tasks}}]),angular.module("4treeApp").controller("searchController",["$scope","syncApi","db_tree","$rootScope","$sce","$timeout",function(a,b,c,d,e,f){var g,h;return a.search_notes_result={},a.calc_history=["2*2 = 4"],a.show_calc=!1,a.init=function(b){return a.dont_need_highlight=b.dont_need_highlight},a.trust=function(a){return a&&(a=strip_tags(a,"<em>"," ")),a?e.trustAsHtml(a):void 0},h=_.debounce(function(b,c){return a.fn.service.db_tree.searchString(b,c).then(function(b){return _.each(Object.keys(b),function(c){var d,e;return a.search_notes_result[c]=[],a.search_notes_result[c]=null!=(d=b[c])&&null!=(e=d.hits)?e.hits:void 0})})},600),g=this,d.$on("sync_ended",function(){return __log.info("hello, im change"),a.dont_need_highlight?void 0:f(function(){return h(a.search_box,a.dont_need_highlight)},500)}),a.$watch("search_box",function(b,c){var d,f,g,i;if(b!==c){b&&a.dont_need_highlight&&$(".header_search_form .btn-group").addClass("open"),b.length||(a.search_notes_result={},a.show_calc=!1),i=function(a){var b,c;return c=(""+a).split("."),b=(""+c[0]).replace(/\B(?=(\d{3})+(?!\d))/g," "),c[1]&&(b+="."+c[1]),b},-1!==["-","=","+","/","*"," "].indexOf(b[b.length-1])&&(b=b.substr(0,b.length-1),__log.info("s",{new_value:b}));try{if(-1===b.indexOf("+")&&-1===b.indexOf("-")&&-1===b.indexOf("/")&&-1===b.indexOf("*"))throw __log.info("error!!!"),"dont calculate!";return d=Parser.evaluate(b.replace(/,/gi,".").replace(/\s/gi,"")),d=Math.round(1e5*d)/1e5,g=b.replace(/\+/gi," + ").replace(/\-/gi," - ").replace(/\*/gi," * ").replace(/\//gi," / "),a.calc_history[0]=e.trustAsHtml(g+" = <b>"+i(d)+"</b>"),a.show_calc=!0}catch(j){return f=j,__log.info({error:f}),h(b,a.dont_need_highlight),a.show_calc=!1}}})}]),angular.module("4treeApp").controller("top_tabs_ctrl",["$scope","$rootScope","db_tree","settingsApi","$window","$timeout",function(a,b,c,d,e,f){return a.window_width=e.innerWidth,a.params={menu_open_index:void 0},a.getTabWidth=function(){var a;return a=100/parseInt(d.set.tabs.length),a>20&&(a=20),"width:"+a+"%"},a.$on("my-tab-sorted",function(a,b){return Array.prototype.move=function(a,b){var c;if(b>=this.length)for(c=b-this.length;c--+1;)this.push(void 0);return this.splice(b,0,this.splice(a,1)[0]),this},b&&b.from>=0&&b.to>=0&&b.from!==b.to-1&&b.from_id?f(function(){return console.info("before moved",JSON.stringify(d.set.tabs)),d.set.tabs=_.cloneDeep(d.set.tabs).move(b.from,b.to-1),console.info("moved",JSON.stringify(d.set.tabs))}):void 0}),a.getTab=function(a){return c.jsFind(a.tab_id)},a.clickTab=function(e){var f;return a.params.menu_open_index=void 0,f=c._db.tree[e.tab_id],f&&d.tmp.focus?(b.$$childTail.db.main_node[d.tmp.focus]=f,b.$$childTail.db.main_node[d.tmp.focus_edit]=f):void 0},a.closeTab=function(b,c){var e;return a.params.menu_open_index=void 0,e=void 0,d.set.tabs=_.filter(d.set.tabs,function(a,d){return c?"other"===c?a.tab_id===b.tab_id:"left"===c?(console.info({tmp:e,key:d}),a.tab_id===b.tab_id&&(e=d),e&&d>=e):"right"===c?(console.info({tmp:e,key:d}),a.tab_id===b.tab_id&&(e=d),!e||e===d):void 0:a.tab_id!==b.tab_id})}}])}.call(this),function(){angular.module("4treeApp").directive("jqShowEffect",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){var e,f,g,h,i,j,k,l;k=b.$eval(d.jqOptions),j={type:"fade",duration:200,delay:0,hideImmediately:!1,callback:null},$.extend(j,k),l=j.type,g=j.duration,e=j.callback,f=j.delay,h=j.hideImmediately,i=$(c),b.$watch(d.jqShowEffect,function(b){h&&!b?i.hide(0,e):a(function(){"fade"===l?b?i.fadeIn(g,e):i.fadeOut(g,e):"slide"===l?b?i.slideDown(g,e):i.slideUp(g,e):b?i.show(g,e):i.hide(g,e)},f)})}}}])}.call(this),function(){"use strict";angular.module("4treeApp").directive("odometer",function(){return{restrict:"E",require:"ngModel",scope:{model:"=ngModel"},link:function(a,b,c,d){var e;return e=new Odometer({auto:!1,el:b[0],value:a.model,format:"",duration:100}),d.$render=function(){return e.update(d.$viewValue)}}}})}.call(this),function(){angular.module("angular-redactor",[]).directive("smartRedactor",["$timeout","$rootScope","db_tree",function(a,b,c){return{restrict:"A",require:"ngModel",link:function(d,e,f,g){var h,i,j,k,l,m,n,o;return o=function(a){return d.$apply(function(){var b;return b=g.$viewValue,b?c.setText(b,a):void 0})},m=_.debounce(function(){return $(e).parents(".content").scroll()},100),$(window).resize(function(){return m()}),l={boldTag:"b",changeCallback:_.debounce(function(a){return o(a)},3),imageUpload:"/api/v1/uploadImage/?id="+b.$$childTail.set.user_id,clipboardUploadUrl:"/api/v1/uploadImage/?id="+b.$$childTail.set.user_id},i=f.smartRedactor?d.$eval(f.smartRedactor):{},j=void 0,h=angular.element(e),angular.extend(l,i),a(function(){return j=h.redactor(l),g.$render()},10),k=function(){var a,b,c,d;for(d=[],c=$(h.redactor("getParent")),b=c,a=$(h.redactor("getCurrent")),d.push({element:c,index:c.index()});c&&c.length&&!c.hasClass("redactor_editor");)c=c.parent(),c.length&&(d.push({element:c,index:c.index()}),console.info("?".parent));return{first_parent:b,current:a,path:d}},n=function(a){var b;return b=a.path.reverse(),e=$("body"),_.each(b,function(a){var b,c,d;return e=a.element&&(null!=(b=a.element[0])?b.length:void 0)?e.find(a.element[0]):$(a.element[0]).hasClass("redactor_editor")?$(a.element[0]):e.find((null!=(c=a.element)&&null!=(d=c[0])?d.localName:void 0)+":eq("+a.index+")")}),e},b.$on("refresh_editor",_.debounce(function(){return c.getText(g.$viewValue).then(function(a){var b,c,d;if((null!=a?a.text:void 0)!==h.redactor("get")&&(d=k(),b=d.first_parent&&d.first_parent.length?h.redactor("getCaretOffset",d.first_parent[0]):0,h.redactor("set",(null!=a?a.text:void 0)||"",!1),c=n(d),c&&c.html())){b>c.html().length&&(b=c.html().length);try{if(c.length)return h.redactor("setCaret",c,b)}catch(e){return console.info("error of caret")}}})},1)),g.$render=function(){return angular.isDefined(j)?c.getText(g.$viewValue).then(function(a){return h.redactor("set",(null!=a?a.text:void 0)||"",!1)}):void 0}}}}])}.call(this),function(){angular.module("4treeApp").directive("taskSettings",function(){return{templateUrl:"views/subviews/task_settings.html",transclude:!0,restrict:"E",require:"?ngModel",link:function(a,b,c,d){a.show={visible:!1},a.close=function(){return a.show.visible=!1,a.set.set_task=void 0},a.$watch("task",function(b,c){return b&&c&&b._id!==c._id?(d.$setViewValue=c,a.show.visible=!0):void 0},!0),d.$render=function(){return d.$viewValue?(a.task=d.$viewValue,a.show.visible=!0):(a.show.visible=!1,d.$setViewValue=void 0)}}}})}.call(this),function(){angular.module("4treeApp").directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){var e;return e=function(){var a;return a=b.html(),c.stripBr&&"<br>"===a&&(a=""),d.$setViewValue(a)},d?(d.$render=function(){return b.html(d.$viewValue||"")},b.on("blur keyup change",function(){return a.$apply(e)})):void 0}}})}.call(this),function(){"use strict";angular.module("4treeApp").directive("miniDate",["$rootScope","settingsApi",function(a,b){var c,d;return d=function(a,b){return"background-image: -webkit-gradient(linear, left top, right top, color-stop("+(a-0)+"%, "+b+"), color-stop("+(a+0)+"%, rgba(0,0,0,0)));"},c=function(a,b){var c,d,e,f,g,h,i,j;return c={text:"","class":"nodate",image:""},a?"0000-00-00 00:00:00"===a?c:(a=new Date(a),c["class"]="",h=new Date,b&&(h.setHours(0),h.setMinutes(0),h.setSeconds(0),a=new Date(a),a.setHours(0),a.setMinutes(0),a.setSeconds(0)),e=a.getTime()-h,e>0&&(e+=1e3),0>e&&(e-=1e3),d=parseInt(e/864e5,10),g=parseInt(e/6e4,10),b&&0===d&&(g=0),0===d?(g>59||-59>g?(f=parseInt(e/36e5*10,10)/10,c.text=(g>0?"+":"")+f+" ч."):c.text=(g>0?"+":"")+g+" м.",b&&(c.text="сегодня")):c.text=(d>0?"+":"")+d+" дн.",0===d?(0>g&&(c["class"]="datetoday past",i=-g/480*100,i>80&&(i=80),j="#d7d7d7",a.did||(c.image="background-image: -webkit-gradient(linear, left top, right top, color-stop("+(i-25)+"%, "+j+"), color-stop("+(i+25)+"%, rgba(0,0,0,0)));")),g>=0&&(c["class"]="datetoday")):0>g&&(c["class"]="datepast"),c):c},{restrict:"A",require:"ngModel",scope:{model:"=ngModel"},link:function(a,d,e,f){var g;return a.$watch(function(){var a;return a=Math.round(b.tmp.tick_today_date_time/3e4),a+f.$modelValue.date1+f.$modelValue.date2+f.$modelValue.did},function(a,b){return a!==b?g():void 0}),g=function(){var a,e,g,h,i,j,k,l,m;return a=f.$viewValue.date1?c(f.$viewValue.date1):{text:" ","class":"nodate"},f.$viewValue.date2&&(e=c(f.$viewValue.date2)),m='<div class="myprogress"></div>',(null!=a?a.text:void 0)&&(m+='<div class="txt"></div><span  class="date1">'+a.text+"</span>"),(null!=e?e.text:void 0)&&(m+='<span class="date2">'+e.text+"</span></div>"),m+="",h=new Date(f.$viewValue.date1).getTime(),i=new Date(f.$viewValue.date2).getTime(),g=b.tmp.tick_today_date_time,d.html(m),k=d.find(".myprogress"),l="",g>=h&&i>=g?(j=100/(i-h)*(g-h),k.removeClass("red")):g>=i&&(j=100/(i-h)*(g-i),j>100&&(j=100),k.width(j+"%"),l="red",k.addClass("red")),h||i||(l="nodate"),f.$viewValue.did&&(l="did",j=0),k.width(j+"%"),d.attr("class","task_date "+l)},f.$render=g}}}])}.call(this),function(){var a,b,c,d;c=_.debounce(function(){var b;return b=Object.keys(a).length,b>20&&jsPlumb.setSuspendDrawing(!0,!0),console.info("Length",b),_.each(a,function(b,c){return b&&b.apply(),delete a[c]}),b>20&&jsPlumb.setSuspendDrawing(!1,!0),!1},0),d=_.debounce(function(){return!1},120),b=_.debounce(function(a){return a.parents("li").each(function(a,b){var c;return c=$(b).find("._jsPlumb_endpoint_anchor_:first"),console.info("repaint = ",c[0].id),jsPlumb.repaint(c[0].id)})},2),a={},angular.module("4treeApp").directive("plumbConnect",["$timeout",function(){return{replace:!0,require:"?ngModel",link:function(e,f,g){var h;h=$(f).parents("li:first").parents("li:first").find(".col3"),c(),jsPlumb.Defaults.DragOptions={cursor:"pointer",zIndex:2e3},jsPlumb.Defaults.PaintStyle={lineWidth:1,strokeStyle:"#888"},jsPlumb.Defaults.Connector=["Bezier",{curviness:30}],jsPlumb.Defaults.Endpoint=["Blank",{radius:5}],jsPlumb.Defaults.EndpointStyle={fillStyle:"#567567"},e.$watch("tree.title",function(a,c){return c!==a?(console.info("title_changed"),b(f)):void 0}),h.length&&(a[g.id+200*Math.random()]=function(){return jsPlumb.Defaults.Container=$(h).parents("li:first"),jsPlumb.connect({source:h,target:f,paintStyle:{lineWidth:1,strokeStyle:"#888"},anchors:[[1,1,1,0,-1,-1],[0,1,-1,0,1,-1]]}),b(f),d()}),f.on("$destroy",function(){return c(),jsPlumb.detachAllConnections(f),b($(f).parents("li:first").parents("li:first")),d()})}}}])}.call(this),function(){var a;angular.module("4treeApp").directive("windowDraggable",function(){return{link:function(a,b){b.draggable({appendTo:"#w_main",distance:10,handle:".drag-handle",stop:function(a,b){return console.info("draggable stop",b)}})}}}),angular.module("4treeApp").directive("myDraggable",function(){return{link:function(a,b,c){b.draggable({connectToSortable:c.myDraggable,helper:"clone",appendTo:"#w_main",distance:10,handle:".handle, .col2",stop:function(a,b){return console.info("draggable stop",b)}})}}}),a='<div class="tree_tmpl" my-draggable=".sortable" data-id="{{tree._id}}" render-time> <div ng-controller="save_tree_db" class="tree_wrap" ng-class="{open:tree.panel[panel_id]._open, folder:tree._childs, active:(db.main_node[panel_id]._id==tree._id)}" ng-click="db.main_node[panel_id] = tree"> <div class="col1"> <div class="is_folder" ng-click="tree.panel[panel_id]._open=!tree.panel[panel_id]._open"></div> </div> <div class="col2" title="{{tree._childs}}" ng-click="set.main_parent_id[panel_id] = tree._id" style="background:{{tree.color}};" ng-class="{tree_new:tree._new}"> <i class="{{fn.service.db_tree.getIcon(tree)}}" style="color: {{tree.icon_color}};"></i> </div> <div class="col3"> <div class="title"> <span contenteditable="true" class="contenteditable" ng-model="tree.title" focus-me="tree._focus_me" hotkey="{\'Enter\':fn.service.db_tree.jsEnterPress,\'Esc\':fn.service.db_tree.jsEscPress}" ng-blur="fn.service.db_tree.jsBlur($event, undefined, tree)" tabindex="-1"></span> <span class="cnt" ng-if="tree._childs">({{tree._childs}})</span> </div> </div> <div class="col4" ng-click="fn.service.db_tree.jsAddNote(tree); $event.stopPropagation();"> <div class="col4table"> <i class="icon-plus"></i> </div> </div> </div> </div>',angular.module("4treeApp").directive("oneNote",function(){return{restrict:"E",scope:!1,templateUrl:"views/subviews/view_one_line0.html"}}),angular.module("4treeApp").directive("renderNote",["$timeout","db_tree",function(){return{restrict:"E",require:"?ngModel",template:"",link:function(a,b,c,d){return d.$render=function(){var a;return a=d.$viewValue.title,b.html(a||"")}}}}]),angular.module("4treeApp").directive("renderTime",["$timeout",function(a){return{link:function(){return __log.show_time_long&&console.time("renderTimeALL"),a(function(){return __log.show_time_long?console.timeEnd("renderTimeALL"):void 0})}}}]),angular.module("4treeApp").directive("mySortable",function(){return{require:"?ngModel",link:function(a,b){b.sortable({revert:!1,distance:10,handle:".handle, .col2",cancel:".contenteditable,.title"}),b.on("sortstart",function(a,b){return console.info("start",b.item[0].dataset.id),$(this).data().sort_id=b.item[0].dataset.id,$(".tree_tmpl[data-id='"+$(this).data().sort_id+"']").addClass("drag_now")
}),b.on("sortbeforestop",function(c,d){var e,f,g,h;c.stopPropagation(),c.preventDefault(),f=$(this).data().sort_id,$(".tree_tmpl[data-id='"+$(this).data().sort_id+"']").removeClass("drag_now"),e=angular.element(d.item).scope().$index,g=b.children().index(d.item),g=angular.element(c.target).children("[data-id='"+f+"']").index(),h=angular.element(this).attr("data-parent-id"),console.info("FROM",f,"TO",h),g>=0&&a.$apply(function(){console.info("sorted",{to:g,from:e},angular.element(d.item).scope().tree),a.$emit("my-sorted",{from:e,to:g,from_id:f,to_id:h})})})}}}),angular.module("4treeApp").directive("mySortableTab",function(){return{require:"?ngModel",link:function(a,b){console.info("tab sort",b),b.sortable({revert:!1,helper:"clone",placeholder:"tab-state-highlight"}),b.disableSelection(),b.on("sortstart",function(a,b){return console.info("start",b.item[0].dataset.id),$(this).data().sort_id=b.item[0].dataset.id,$(".tree_tmpl[data-id='"+$(this).data().sort_id+"']").addClass("drag_now")}),b.on("sortbeforestop",function(c,d){var e,f,g,h;c.stopPropagation(),c.preventDefault(),f=$(this).data().sort_id,$(".tree_tmpl[data-id='"+$(this).data().sort_id+"']").removeClass("drag_now"),e=angular.element(d.item).scope().$index,g=b.children().index(d.item),g=angular.element(c.target).children("[data-id='"+f+"']").index(),h=angular.element(this).attr("data-parent-id"),console.info("FROM",f,"TO",h),g>=0&&a.$apply(function(){console.info("sorted",{to:g,from:e},angular.element(d.item).scope().tree),a.$emit("my-tab-sorted",{from:e,to:g,from_id:f,to_id:h})})})}}})}.call(this),function(){angular.module("4treeApp").directive("focusMe",["$timeout",function(a){return{scope:{trigger:"=focusMe"},link:function(b,c){b.$watch("trigger",function(d){d===!0&&(a(function(){return c[0].focus(),document.execCommand("selectAll",!1,null)}),b.trigger=!1)})}}}])}.call(this),function(){angular.module("4treeApp").directive("dateTimeInput",["$timeout","$compile",function(a){return{restrict:"E",require:"?ngModel",scope:{},template:function(){return' <div class="datetimeinput"><div class="dt_wrap"><i class="icon-up-dir"></i><input class="day" size="2" only-digits><i class="icon-down-dir"></i></div><div class="dt_wrap"><i class="icon-up-dir"></i><input class="month" size="5"><i class="icon-down-dir"></i></div><div class="dt_wrap"><i class="icon-up-dir"></i><input class="year" size="4"><i class="icon-down-dir"></i></div><div class="dt_wrap"><i class="icon-up-dir"></i><input class="hours" size="2"><i class="icon-down-dir"></i></div><div class="dt_wrap"><i class="icon-up-dir"></i><input class="minutes" size="2"><i class="icon-down-dir"></i></div></div>'},link:function(b,c,d,e){var f,g,h,i;return g={key_code:{up:38,down:40},month_names:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],keys:[8,9,19,20,27,33,34,35,36,37,38,39,40,45,46,144,145]},i=function(a,b){var c;return c=new Date(b),a.find(".day").val(c.getDate()||""),a.find(".month").val(g.month_names[c.getMonth()]||""),a.find(".year").val(c.getFullYear()||""),a.find(".hours").val(c.getHours()||""),a.find(".minutes").val(c.getMinutes()||"")},e.$render=function(){return i(c,e.$modelValue)},b.$watch(function(){return e.$modelValue},function(){return i(c,e.$modelValue)}),h=function(a){var b,c,d,e,f,h,i;return b=a.find(".day").val(),f=a.find(".month").val(),i=a.find(".year").val(),d=a.find(".hours").val(),e=a.find(".minutes").val(),b=parseInt(b),d=parseInt(d),e=parseInt(e),h=f.substr(0,4),c=(new Date).getMonth(),f=_.find(g.month_names,function(a,b){return-1!==h.indexOf(a.substr(0,4))?c=b:void 0}),i=parseInt(i),new Date(i,c,b,d,e)},c.on("keyup","input",function(a){return 13===a.which?angular.element(".month").focus():void 0}),c.on("blur","input",function(){var a;return a=h(c),_.isDate(a)?b.$apply(function(){return e.$setViewValue(new Date(a))}):void 0}),f=2,c.on("keyup",".day",function(b){8===b.which&&0===this.value.length||$.inArray(b.which,g.keys)>=0||(this.value.length>=f&&this.value<=31&&!b.shiftKey&&16!==b.which&&9!==b.which?(angular.element(".month").focus(),a(function(){return angular.element(".month").select()})):b.shiftKey||b.which<=48||b.which>=58)}),c.on("keydown","input",function(a){var c,d;return a.keyCode===g.key_code.up&&(a.preventDefault(),a.stopPropagation(),c=e.$modelValue,$(this).hasClass("day")&&(d=new Date(c).getTime(),b.$apply(function(){return e.$setViewValue(new Date(d+864e5))})),$(this).hasClass("month")&&(d=new Date(c),b.$apply(function(){return e.$setViewValue(new Date(d.setMonth(d.getMonth()+1)))})),$(this).hasClass("year")&&(d=new Date(c),b.$apply(function(){return e.$setViewValue(new Date(d.setFullYear(d.getFullYear()+1)))})),$(this).hasClass("hours")&&(d=new Date(c),b.$apply(function(){return e.$setViewValue(new Date(d.setHours(d.getHours()+1)))})),$(this).hasClass("minutes")&&(d=new Date(c),b.$apply(function(){return e.$setViewValue(new Date(d.setMinutes(d.getMinutes()+1)))}))),a.keyCode===g.key_code.down&&(a.preventDefault(),a.stopPropagation(),c=e.$modelValue,$(this).hasClass("day")&&(d=new Date(c).getTime(),b.$apply(function(){return e.$setViewValue(new Date(d-864e5))})),$(this).hasClass("month")&&(d=new Date(c),b.$apply(function(){return e.$setViewValue(new Date(d.setMonth(d.getMonth()-1)))})),$(this).hasClass("year")&&(d=new Date(c),b.$apply(function(){return e.$setViewValue(new Date(d.setFullYear(d.getFullYear()-1)))})),$(this).hasClass("hours")&&(d=new Date(c),b.$apply(function(){return e.$setViewValue(new Date(d.setHours(d.getHours()-1)))})),$(this).hasClass("minutes"))?(d=new Date(c),b.$apply(function(){return e.$setViewValue(new Date(d.setMinutes(d.getMinutes()-1)))})):void 0})}}}])}.call(this),function(){angular.module("4treeApp").directive("ngRightClick",["$parse",function(a){return function(b,c,d){var e;e=a(d.ngRightClick),c.bind("contextmenu",function(a){b.$apply(function(){a.preventDefault(),e(b,{$event:a})})})}}])}.call(this),function(){}.call(this);